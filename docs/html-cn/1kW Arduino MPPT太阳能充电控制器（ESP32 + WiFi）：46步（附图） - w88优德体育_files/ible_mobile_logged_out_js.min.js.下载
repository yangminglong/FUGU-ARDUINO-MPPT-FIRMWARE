Ibles.package("Ibles.mixins"),Ibles.mixins.SelectOneCollection={getSelected:function(){return this.findWhere({selected:!0})},select:function(e){this.forEach((function(e){e.set({selected:!1},{silent:!0})})),e.set({selected:!0})},deselect:function(e){e.set({selected:!1})}},Ibles.mixins.SelectManyCollection={getSelected:function(){return this.where({selected:!0})},select:function(e){e.set({selected:!0})},deselect:function(e){e.set({selected:!1})},deselectAll:function(){this.invoke("set",{selected:!1})},selectOnly:function(e,t){this.deselectAll(),this.forEach((function(n){_.contains(t,n.get(e))&&n.set({selected:!0})}))}},Ibles.mixins.SelectableModel={mergedAttributes:{selected:!1},select:function(e){return this.collection.select(this,e),this},deselect:function(e){return this.collection.deselect(this,e),this},toggleSelected:function(e){return this.get("selected")?this.deselect(e):this.select(e),this}},Ibles.package("Ibles.models"),Ibles.models.ChannelModel=Backbone.Model.extend({idAttribute:"name",defaults:{name:null,title:null,type:null,category:null,following:!1},toggleFollowing:function(){var e=this,t=_.extend(this.getFollowedParams(),{following:!this.get("following")});return Ibles.API.post({url:Ibles.apiUrl("setFollowing"),data:$.param(t,!0),processData:!1,success:function(t){e.set({following:t.following})}})},getFollowedParams:function(){var e={};return Ibles.setFollowChannelParams(e,this.get("category"),this.get("name")),e},isFollowing:function(){var e=this,t=this.getFollowedParams();return Ibles.API.getRequest("isFollowing",t,{success:function(t){e.set({following:t.isFollowing})}})}}),Ibles.package("Ibles.collections"),Ibles.collections.ChannelCollection=Backbone.Collection.extend({initialize:function(){this.makeMultiSelectable()},makeMultiSelectable:function(){Ibles.applyMixin(this,Ibles.mixins.SelectManyCollection)},model:function(e,t){return Ibles.makeModelSelectable(new Ibles.models.ChannelModel(e,t))},modelId:function(e){return e.name},getChannel:function(e){return this.get(e)}}),Ibles.package("Ibles.models"),Ibles.models.CategoryModel=Backbone.Model.extend({idAttribute:"name",defaults:function(){return{name:null,title:null,type:null,channels:[]}},initialize:function(e){var t=e||{};this.channelsCollection=new Ibles.collections.ChannelCollection(t.channels||[],{parse:!0})},getDisplayTitle:function(){return this.get("title")}}),Ibles.package("Ibles.models"),Ibles.models.TeacherCategoryModel=Ibles.models.CategoryModel.fullExtend({defaults:function(){return{name:null,title:null,type:null,channels:[],grades:[],gradeGroups:[],subjects:[]}},initialize:function(e,t){var n=e||{},i=n.grades||[],s=n.gradeGroups||[],r=n.subjects||[],o=i.concat(r);this._super(_.extend(n,{channels:o}),t),this.gradesCollection=new Ibles.collections.GradeCollection(i,{parse:!0}),this.gradeGroupsCollection=new Ibles.collections.GradeGroupCollection(s,{parse:!0}),this.subjectsCollection=new Ibles.collections.SubjectCollection(r,{parse:!0})},reset:function(e){var t=e||{};this.gradesCollection.reset(t.grades||[]),this.gradeGroupsCollection.reset(t.gradeGroups||[]),this.subjectsCollection.reset(t.subjects||[]),this.channelsCollection.reset((t.grades||[]).concat(t.subjects||[])),this.set({name:t.name,title:t.title,type:t.type})}}),Ibles.package("Ibles.collections"),Ibles.collections.CategoryCollection=Backbone.Collection.extend({initialize:function(){Ibles.applyMixin(this,Ibles.mixins.SelectOneCollection)},model:function(e,t){var n;return n="teachers"===e.name?new Ibles.models.TeacherCategoryModel(e,t):new Ibles.models.CategoryModel(e,t),Ibles.applyMixin(n,Ibles.mixins.SelectableModel),n},modelId:function(e){return e.name},getCategoryModel:function(e){return this.get(e)},getChannelsInCategory:function(e){var t=this.getCategoryModel(e);return t&&t.channelsCollection}}),Ibles.package("Ibles.models"),Ibles.models.SubjectModel=Ibles.models.ChannelModel.fullExtend({defaults:function(){return{type:"subject",category:"teachers"}}}),Ibles.package("Ibles.collections"),Ibles.collections.SubjectCollection=Ibles.collections.ChannelCollection.extend({model:function(e,t){return Ibles.makeModelSelectable(new Ibles.models.SubjectModel(e,t))},getSelectedSubjectNames:function(){var e=this.getSelected();return _.map(e,(function(e){return e.get("name")}))},getSelectedSubjectTitles:function(){var e=this.getSelected();return _.map(e,(function(e){return e.get("title")}))}}),Ibles.package("Ibles.models"),Ibles.models.GradeModel=Ibles.models.ChannelModel.fullExtend({defaults:function(){return{type:"grade",category:"teachers",gradeGroup:null}}}),Ibles.package("Ibles.collections"),Ibles.collections.GradeCollection=Ibles.collections.ChannelCollection.extend({model:function(e,t){return Ibles.makeModelSelectable(new Ibles.models.GradeModel(e,t))},getSelectedGradeGroupNames:function(){var e=this.getSelected(),t=_.map(e,(function(e){return e.get("gradeGroup")}));return _.uniq(t)}}),Ibles.package("Ibles.models"),Ibles.models.GradeGroupModel=Ibles.models.ChannelModel.fullExtend({defaults:function(){return{name:"",title:"",type:"gradeGroup",category:"teachers",grades:[]}},getFollowedParams:function(){return{grade:this.get("grades")}}}),Ibles.package("Ibles.collections"),Ibles.collections.GradeGroupCollection=Ibles.collections.ChannelCollection.extend({model:function(e,t){return Ibles.makeModelSelectable(new Ibles.models.GradeGroupModel(e,t))},initialize:function(e){if(this._super(e),!e){var t=Ibles.pageContext.gradeGroups;_.isEmpty(t)||this.reset(Ibles.pageContext.gradeGroups);var n=Ibles.pageContext.taxonomy,i=n&&_.findWhere(n,{name:"teachers"});_.isEmpty(i)||_.isEmpty(i.gradeGroups)||this.reset(i.gradeGroups)}},getGradeGroupContainingGrade:function(e){return this.find((function(t){return _.contains(t.get("grades"),e)}))},getSelectedNames:function(){return _.map(this.getSelected(),(function(e){return e.get("title")}))},getSelectedGrades:function(){var e=[];return _.each(this.getSelected(),(function(t){e=e.concat(t.get("grades"))})),e}}),Ibles.package("Ibles.models"),Ibles.models.Taxonomy=Backbone.Model.fullExtend({initialize:function(){this.categoryCollection=new Ibles.collections.CategoryCollection(Ibles.pageContext.taxonomy||[]),this.originalData=[]},clone:function(){var e=new Ibles.models.Taxonomy;return e.categoryCollection.reset(this.originalData,{parse:!0}),e},fetch:function(){var e=this;return this.fetchPromise().done((function(t){e.originalData=t,e.categoryCollection.reset(t,{parse:!0}),e.trigger("taxonomyLoaded")}))},fetchPromise:function(){return Ibles.taxonomyPromise||(Ibles.taxonomyPromise=Ibles.API.get({url:Ibles.reverseUrls.getTaxonomyUrl()})),Ibles.taxonomyPromise},getChannelsInCategory:function(e){return this.categoryCollection.getChannelsInCategory(e)},getChannelInCategory:function(e,t){var n=this.getChannelsInCategory(e);return n&&n.getChannel(t)},hasChannelInCategory:function(e,t){return!!this.getChannelInCategory(e,t)},getCategory:function(e){return this.categoryCollection.get(e)},getTeachersCategory:function(){return this.categoryCollection.get("teachers")},getSubjectsCollection:function(){return this.getTeachersCategory().subjectsCollection},getSubject:function(e){return this.getSubjectsCollection().get(e)},getGradesCollection:function(){return this.getTeachersCategory().gradesCollection},getGrade:function(e){return this.getGradesCollection().get(e)},getGradeGroupForGrade:function(e){return this.getTeachersCategory().gradeGroupsCollection.find((function(t){return _.contains(t.get("grades"),e)}))},toFlatBrowsableChannelsList:function(){var e=[];return this.categoryCollection.each((function(t){"teachers"===t.get("name")?(e.push.apply(e,t.get("gradeGroups")),e.push.apply(e,_.filter(t.get("channels"),(function(e){return"subject"===e.type})))):e.push.apply(e,t.get("channels"))})),e}}),Ibles.package("Ibles.models"),Ibles.models.Classifier=Backbone.Model.extend({defaults:{classifiable:null,updatePrimary:!0},save:function(){var e=this,t=this.getParams(e.get("classifiable"));return this.trigger("status",{name:"loading"}),Ibles.API.jsonPostRequest("setClassifications",t).done((function(){e.trigger("status",{name:"success"})})).fail((function(){e.trigger("status",{name:"error"})}))},getParams:function(e){var t=this.get("updatePrimary"),n={id:e.get("id"),type:this.getTypeParam(e)};return Ibles.setClassificationsPostParam(e,n,t),n},getTypeParam:function(e){var t=e.get("type");return"Guide"==t?"collection":"Step by Step"==t?"project":"topic"}}),Ibles.package("Ibles.models","Ibles.collections"),Ibles.models.MemberModel=Backbone.Model.extend({defaults:function(){return{id:null,screenName:null,downloadUrl:null,following:!1,views:0,commentCount:0,discussionCount:0,featuredCount:0,favoritesCount:0,instructablesCount:0,draftsCount:0,publishedCollectionsCount:0,publishedProjectCount:0,draftCollectionsCount:0,collaborationsCount:0,followersCount:0,subscriptionsCount:0,occupations:[],images:[]}},initialize:function(e,t){t=t||{},this.userDataFetched=!1,this.profileImageCollection=new Ibles.collections.FileCollection(this.get("images")),t.fetchAuthorStats&&this.fetchAuthorStats(),t.fetchUserData&&this.fetchUserData()},getUrl:function(){return Ibles.reverseUrls.memberUrl(this.get("screenName"))},getAvatarFile:function(){return Ibles.fileFromDict(this.attributes)},getProfileImageUrls:function(){return this.profileImageCollection.map((function(e){return e.getMediumUrl()}))},fetch:function(){var e=this;return Ibles.API.getRequest("showAuthorModel",{screenName:this.get("screenName")}).done((function(t){e.set(t)}))},fetchAuthorStats:function(){var e=this;Ibles.API.getRequest("showAuthorStats",{screenName:this.get("screenName")}).done((function(t){e.set(t)})).always((function(){e.trigger("authorStatsSynced")}))},fetchUserData:function(){var e=this;Ibles.session.authenticated()&&(Ibles.session.isAdmin()||Ibles.session.get("screenName")===this.get("screenName"))&&Ibles.API.getRequest("showAuthorUserData",{screenName:this.get("screenName"),cb:Date.now()}).done((function(t){e.set(t),e.profileImageCollection.reset(t.images||[])})).error((function(e,t){401===t.status&&Ibles.API.post({url:Ibles.reverseUrls.logoutProxyUrl(),success:function(){Ibles.session.clear(),Ibles.locationAssign(window.location.href)}})})).always((function(){e.trigger("userDataSynced"),e.userDataFetched=!0}))},toggleFollowing:function(){var e=this;return Ibles.API.postRequest("setFollowing",{memberId:this.get("id"),following:!this.get("following")},{success:function(t){e.set({following:t.following})}})},isFollowing:function(){var e=this;return Ibles.API.getRequest("isFollowing",{screenName:this.get("screenName"),cb:Date.now()},{success:function(t){e.set({following:t.isFollowing||!1})}})},purgeFromCache:function(){return Ibles.API.jsonPostRequest("purgeCaches",{ids:[this.get("id")]})},sendPrivateMessage:function(e,t,n){var i={posted:(new Date).getTime(),body:Ibles.paragraphize(t.replace(/<\/?[^>]+(>|$)/g,"")),subject:e.replace(/<\/?[^>]+(>|$)/g,""),recipientId:this.get("id")},s=this;return _.isEmpty(n)||(i.inReplyToId=n),Ibles.API.jsonPostRequest("privateMessage",i,{success:function(){s.trigger("privateMessageSent")},error:function(){s.trigger("privateMessageError")}})},updateProfile:function(e){var t=this;return Ibles.API.jsonPost(Ibles.URLS.updateProfileUrl(),e).done((function(){Ibles.session.resetForCurrentUser((function(){t.trigger("updateProfileSuccess")}))})).fail((function(){t.trigger("updateProfileError")}))},updateSettings:function(e){var t=e||{};return Ibles.API.post({url:Ibles.URLS.updateSettingsUrl(),data:t})}}),Ibles.collections.MemberCollection=Backbone.Collection.extend({model:Ibles.models.MemberModel}),Ibles.package("Ibles.models"),Ibles.models.BaseInstructableModel=Backbone.Model.extend({defaults:function(){return{id:null,title:null,urlString:null,fullUrl:null,author:null,type:null,status:null,classifications:[],suppliesFiles:[],category:null,channel:null,publishDate:null,favorite:!1,flagged:!1,fetchUserData:!1,fetchStats:!1,resourceType:null,collaborators:[],indexTags:[],submissions:[],coverImage:null}},initialize:function(e){this.author=new Ibles.models.MemberModel(this.get("author")),this.set({favorite:e&&e.favorite}),this.get("fetchUserData")&&this.fetchUserData(),this.get("fetchStats")&&this.fetchStats()},fetch:function(){var e=this;return Ibles.API.getRequest("showInstructableModel",{id:this.get("id")}).done((function(t){e.set(e.parse(t)),t.author&&e.author.set(t.author)}))},parse:function(e){return Ibles.setPrimaryClassificationDetails(e),Ibles.deepExtend(Ibles.pageContext.ibleData,e),e},fetchUserData:function(){if(Ibles.session.authenticated()){var e=this;Ibles.API.getRequest("showInstructableUserData",{id:this.get("id"),rand:Math.round((new Date).getTime()/1e3)}).done((function(t){"LIMBO"!==t.status||_.isUndefined(t.limboDate)||(t.status="SPAM"),e.set(e.parse(t)),e.author.set({following:t.following})})).always((function(){e.trigger("userDataSynced")}))}},fetchStats:function(){var e=this;return Ibles.API.getRequest("getIbleStats",{id:this.get("id")},{success:function(t){e.set(t)}},["views","favorites","comments"])},flagAction:function(){var e=this;return Ibles.API.ajaxRequest("flag/",{entryID:this.get("id"),action:"SET",flag:this.get("flaggedAs")},{success:function(){e.set({flagged:!0})}})},favoriteAction:function(){var e=this;return Ibles.API.ajaxRequest("favorite/",{entryId:this.get("id")},{success:function(){e.set({favorite:!e.get("favorite")})}})},isFavorite:function(){var e=this;return Ibles.API.getRequest("isFavorite",{id:this.get("id")},{success:function(t){e.set({favorite:t.isFavorite})}})},isOwner:function(e){return this.author.get("id")===e},currentUserIsOwner:function(){var e=Ibles.session;return e.authenticated()&&this.isOwner(e.get("id"))},isCollaborator:function(){var e=this.get("collaborators");return!_.isEmpty(e)&&!_.isEmpty(_.findWhere(e,{id:Ibles.session.get("id")}))},isEditableByCurrentUser:function(){var e=Ibles.session,t=e.get("id");return e.isAdmin()||this.isOwner(t)||this.isCollaborator(t)||e.canEditMakeyMakeyResource()||e.canSetIndexTags()||e.canEditKeywords()||e.canEditClassifications()},getNonInternalIndexTags:function(){return _.without(this.get("indexTags")||[],"internal")},toJSON:function(){var e=Backbone.Model.prototype.toJSON.apply(this,arguments);return e.url=Ibles.reverseUrls.ibleUrl(e.id),e},getPdfUrl:function(){return`/json-api/viewPdf?id=${this.get("id")}`},getEditUrl:function(){return"Guide"===this.get("type")?Ibles.reverseUrls.collectionEditUrl(this.get("id")):Ibles.reverseUrls.ibleEditUrl(this.get("id"))},getFiles:function(){var e=$.Deferred();return this.getFilesPromise||("Step by Step"!==this.get("type")?e.resolve([]):Ibles.API.getRequest("getFiles",{instructableId:this.get("id")},{success:function(t){var n=t.files.map((function(e){return new Ibles.collections.FileCollection(e||[])}));e.resolve(n)}}),this.getFilesPromise=e.promise()),this.getFilesPromise},getPhotosetFiles:function(){var e=$.Deferred();return this.getFiles().done((function(t){var n=[];_.each(t,(function(e){if(e.length){var t=e.filter((function(e){return e.get("image")}));t.length&&n.push(new Ibles.collections.FileCollection(t))}})),e.resolve(n)})),e.promise()},getNonImageFileCollection:function(){var e=$.Deferred();return this.getFiles().done((function(t){var n=new Ibles.collections.FileCollection([]);_.each(t,(function(e){e.length&&n.add(e.filter((function(e){return!e.get("image")})))})),e.resolve(n)})),e.promise()},fetchPdfAsBinary:function(){var e=this.get("urlString")+".pdf",t=$.Deferred();return window.JSZipUtils.getBinaryContent(this.getPdfUrl(),(function(n,i){t.resolve({fileName:e,error:n,data:i})})),t.promise()},fetchAttachmentsAsBinary:function(){var e=$.Deferred();return this.getNonImageFileCollection().done((function(t){var n=[];t.each((function(e){var t=$.Deferred(),i=e.getDownloadUrl(),s=e.get("name");n.push(t),window.JSZipUtils.getBinaryContent(i,(function(e,n){t.resolve({fileName:s,error:e,data:n})}))})),$.when.apply($,n).always((function(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);e.resolve(t)}))})),e.promise()},downloadZipBundle:function(){var e=this,t=$.Deferred();return e.fetchPdfAsBinary().done((function(n){n.error?t.reject(n.error):e.fetchAttachmentsAsBinary().done((function(i){var s=new window.JSZip,r=s.folder(e.get("urlString"));r.file(n.fileName,n.data,{binary:!0}),_.each(i,(function(e){e.error||r.file(e.fileName,e.data,{binary:!0})})),s.generateAsync({type:"blob"}).then((function(n){saveAs(n,e.get("urlString")+".zip"),t.resolve()}))}))})),t.promise()}}),Ibles.package("Ibles.models"),Ibles.models.InstructableModel=Ibles.models.BaseInstructableModel.fullExtend({defaults:function(){return{disableComments:!1,allSteps:!1,currentStepIndex:0}},initialize:function(e,t){this._super(e,t),this.set({fullUrl:Ibles.pageContext.remoteHost+this.getUrl()})},getUrl:function(){var e=Ibles.reverseUrls;return"UNPUBLISHED"===this.get("status")?e.previewUrl(this.get("id")):e.ibleUrl(this.get("urlString")||this.get("id"))}}),Ibles.package("Ibles.collections"),Ibles.collections.InstructableCollection=Backbone.Collection.extend({model:Ibles.models.InstructableModel}),Ibles.JST["scrollable-photoset"]='<[ if (numVideos) {]>\n<div class="scrollable-videoset-wrapper">\n    <div class="js-videos"></div>\n</div>\n<[}]>\n<[ if (numImages) {]>\n<div class="scrollable-photoset-wrapper <[ if (willScroll){]>will-scroll<[}]>">\n    <div class="js-images scrollable-photoset col-<< numImages >>" <[ if (willScroll){]>style="height:<< photosetHeight >>"<[}]>></div>\n</div>\n<[}]>\n',Ibles.JST["scrollable-photoset-item"]='<div class="photoset-item <[ if (embedType === "VIDEO") {]>scrollable-photoset-video<[} else {]>scrollable-photoset-image<[}]>">\n    <[ if (embedType === "VIDEO") {]>\n        << embedHtmlCode >>\n    <[ } else if (isGif) {]>\n        <video class="gif-video" controls autoplay muted loop playsinline>\n            <source src="<< mp4Url >>" type="video/mp4">\n        </video>\n    <[ } else { ]>\n        <a class="lightbox-link << galleryId >>" data-id="<< fileId >>">\n            <[ if (!_.isEmpty(imageNotes)) { ]>\n                <i class="notes-icon"></i>\n            <[ } ]>\n            <img class="img-responsive lazyload" src="<< Ibles.staticUrl(\'img/pixel.png\') >>" data-src="<< resizedImageUrl >>" <[ if (isGif) {]>data-gif-url="<< gifUrl >>"<[}]>>\n        </a>\n    <[ } ]>\n</div>',Ibles.JST["videoset-youtube-cell"]="<iframe\n    allowfullscreen\n    src=\"https://www.youtube.com/embed/<< videoID >>?feature=oembed\"\n    srcdoc=\"\n        <style>\n        *{padding:0;margin:0;overflow:hidden}\n        html,body{height:100%}\n        img,span{position:absolute;width:100%;top:0;bottom:0;margin:auto}\n        span:hover{color:red}\n        span{height:1.5em;text-align:center;font:48px/1.5 sans-serif;color:white;text-shadow:0 0 0.5em black;}\n        .title{position:absolute;z-index:1;font-size:larger;font-family:'myriad-pro-condensed', sans-serif; padding:1em;color:white;}\n        .watchOnYT{position:absolute;z-index:1;bottom:0;left:0;padding:1em;font-family:'myriad-pro-condensed', sans-serif;color:white;background:rgba(0,0,0,0.5)}\n        .watchOnYT a{color:white;text-decoration:none}\n        .watchOnYT svg{position:relative;top:3px;}\n        </style>\n        <div class='title'><< name >></div>\n        <div class='watchOnYT'>\n            <a target='_blank' href='https://www.youtube.com/watch?v=<< videoID >>'>\n            Watch on\n            <svg height='100%' version='1.1' viewBox='0 0 110 26' fill='white' width='75'><use class='ytp-svg-shadow' xlink:href='#ytp-id-30'></use><path class='ytp-svg-fill' d='M 16.68,.99 C 13.55,1.03 7.02,1.16 4.99,1.68 c -1.49,.4 -2.59,1.6 -2.99,3 -0.69,2.7 -0.68,8.31 -0.68,8.31 0,0 -0.01,5.61 .68,8.31 .39,1.5 1.59,2.6 2.99,3 2.69,.7 13.40,.68 13.40,.68 0,0 10.70,.01 13.40,-0.68 1.5,-0.4 2.59,-1.6 2.99,-3 .69,-2.7 .68,-8.31 .68,-8.31 0,0 .11,-5.61 -0.68,-8.31 -0.4,-1.5 -1.59,-2.6 -2.99,-3 C 29.11,.98 18.40,.99 18.40,.99 c 0,0 -0.67,-0.01 -1.71,0 z m 72.21,.90 0,21.28 2.78,0 .31,-1.37 .09,0 c .3,.5 .71,.88 1.21,1.18 .5,.3 1.08,.40 1.68,.40 1.1,0 1.99,-0.49 2.49,-1.59 .5,-1.1 .81,-2.70 .81,-4.90 l 0,-2.40 c 0,-1.6 -0.11,-2.90 -0.31,-3.90 -0.2,-0.89 -0.5,-1.59 -1,-2.09 -0.5,-0.4 -1.10,-0.59 -1.90,-0.59 -0.59,0 -1.18,.19 -1.68,.49 -0.49,.3 -1.01,.80 -1.21,1.40 l 0,-7.90 -3.28,0 z m -49.99,.78 3.90,13.90 .18,6.71 3.31,0 0,-6.71 3.87,-13.90 -3.37,0 -1.40,6.31 c -0.4,1.89 -0.71,3.19 -0.81,3.99 l -0.09,0 c -0.2,-1.1 -0.51,-2.4 -0.81,-3.99 l -1.37,-6.31 -3.40,0 z m 29.59,0 0,2.71 3.40,0 0,17.90 3.28,0 0,-17.90 3.40,0 c 0,0 .00,-2.71 -0.09,-2.71 l -9.99,0 z m -53.49,5.12 8.90,5.18 -8.90,5.09 0,-10.28 z m 89.40,.09 c -1.7,0 -2.89,.59 -3.59,1.59 -0.69,.99 -0.99,2.60 -0.99,4.90 l 0,2.59 c 0,2.2 .30,3.90 .99,4.90 .7,1.1 1.8,1.59 3.5,1.59 1.4,0 2.38,-0.3 3.18,-1 .7,-0.7 1.09,-1.69 1.09,-3.09 l 0,-0.5 -2.90,-0.21 c 0,1 -0.08,1.6 -0.28,2 -0.1,.4 -0.5,.62 -1,.62 -0.3,0 -0.61,-0.11 -0.81,-0.31 -0.2,-0.3 -0.30,-0.59 -0.40,-1.09 -0.1,-0.5 -0.09,-1.21 -0.09,-2.21 l 0,-0.78 5.71,-0.09 0,-2.62 c 0,-1.6 -0.10,-2.78 -0.40,-3.68 -0.2,-0.89 -0.71,-1.59 -1.31,-1.99 -0.7,-0.4 -1.48,-0.59 -2.68,-0.59 z m -50.49,.09 c -1.09,0 -2.01,.18 -2.71,.68 -0.7,.4 -1.2,1.12 -1.49,2.12 -0.3,1 -0.5,2.27 -0.5,3.87 l 0,2.21 c 0,1.5 .10,2.78 .40,3.78 .2,.9 .70,1.62 1.40,2.12 .69,.5 1.71,.68 2.81,.78 1.19,0 2.08,-0.28 2.78,-0.68 .69,-0.4 1.09,-1.09 1.49,-2.09 .39,-1 .49,-2.30 .49,-3.90 l 0,-2.21 c 0,-1.6 -0.2,-2.87 -0.49,-3.87 -0.3,-0.89 -0.8,-1.62 -1.49,-2.12 -0.7,-0.5 -1.58,-0.68 -2.68,-0.68 z m 12.18,.09 0,11.90 c -0.1,.3 -0.29,.48 -0.59,.68 -0.2,.2 -0.51,.31 -0.81,.31 -0.3,0 -0.58,-0.10 -0.68,-0.40 -0.1,-0.3 -0.18,-0.70 -0.18,-1.40 l 0,-10.99 -3.40,0 0,11.21 c 0,1.4 .18,2.39 .68,3.09 .49,.7 1.21,1 2.21,1 1.4,0 2.48,-0.69 3.18,-2.09 l .09,0 .31,1.78 2.59,0 0,-14.99 c 0,0 -3.40,.00 -3.40,-0.09 z m 17.31,0 0,11.90 c -0.1,.3 -0.29,.48 -0.59,.68 -0.2,.2 -0.51,.31 -0.81,.31 -0.3,0 -0.58,-0.10 -0.68,-0.40 -0.1,-0.3 -0.21,-0.70 -0.21,-1.40 l 0,-10.99 -3.40,0 0,11.21 c 0,1.4 .21,2.39 .71,3.09 .5,.7 1.18,1 2.18,1 1.39,0 2.51,-0.69 3.21,-2.09 l .09,0 .28,1.78 2.62,0 0,-14.99 c 0,0 -3.40,.00 -3.40,-0.09 z m 20.90,2.09 c .4,0 .58,.11 .78,.31 .2,.3 .30,.59 .40,1.09 .1,.5 .09,1.21 .09,2.21 l 0,1.09 -2.5,0 0,-1.09 c 0,-1 -0.00,-1.71 .09,-2.21 0,-0.4 .11,-0.8 .31,-1 .2,-0.3 .51,-0.40 .81,-0.40 z m -50.49,.12 c .5,0 .8,.18 1,.68 .19,.5 .28,1.30 .28,2.40 l 0,4.68 c 0,1.1 -0.08,1.90 -0.28,2.40 -0.2,.5 -0.5,.68 -1,.68 -0.5,0 -0.79,-0.18 -0.99,-0.68 -0.2,-0.5 -0.31,-1.30 -0.31,-2.40 l 0,-4.68 c 0,-1.1 .11,-1.90 .31,-2.40 .2,-0.5 .49,-0.68 .99,-0.68 z m 39.68,.09 c .3,0 .61,.10 .81,.40 .2,.3 .27,.67 .37,1.37 .1,.6 .12,1.51 .12,2.71 l .09,1.90 c 0,1.1 .00,1.99 -0.09,2.59 -0.1,.6 -0.19,1.08 -0.49,1.28 -0.2,.3 -0.50,.40 -0.90,.40 -0.3,0 -0.51,-0.08 -0.81,-0.18 -0.2,-0.1 -0.39,-0.29 -0.59,-0.59 l 0,-8.5 c .1,-0.4 .29,-0.7 .59,-1 .3,-0.3 .60,-0.40 .90,-0.40 z' id='ytp-id-30'></path></svg>\n            </a>\n        </div>\n        <a href='https://www.youtube.com/embed/<< videoID >>?feature=oembed&autoplay=1'>\n            <img src='https://img.youtube.com/vi/<< videoID >>/hqdefault.jpg' alt='<< name >>' />\n            <span>\n            <svg height='100%' version='1.1' viewBox='0 0 68 48' width='100%'><path class='ytp-large-play-button-bg' d='M66.52,7.74c-0.78-2.93-2.49-5.41-5.42-6.19C55.79,.13,34,0,34,0S12.21,.13,6.9,1.55 C3.97,2.33,2.27,4.81,1.48,7.74C0.06,13.05,0,24,0,24s0.06,10.95,1.48,16.26c0.78,2.93,2.49,5.41,5.42,6.19 C12.21,47.87,34,48,34,48s21.79-0.13,27.1-1.55c2.93-0.78,4.64-3.26,5.42-6.19C67.94,34.95,68,24,68,24S67.94,13.05,66.52,7.74z' fill='#f00'></path><path d='M 45,24 27,14 27,34' fill='#fff'></path></svg>\n            </span>\n        </a>\"\n    width=\"1024\"\n    height=\"576\"\n    loading=\"lazy\"\n    frameborder=\"0\">\n</iframe>",Ibles.package("Ibles.views"),Ibles.views.MobileLightboxTouchLoader=Backbone.View.extend({initialize:function(e){e=e||{};var t=_.uniqueId("lightbox");this.elementsSelector="."+t,this.elements=e.elements,this.elements.addClass(t),this.lightboxOptions=_.pick(e,"imageKey","imageSet","navbarPosition"),this.lightboxOptions.staticUrl=Ibles.staticUrl(),this.enableLightBoxOnFirstTouch()},enableLightBoxOnFirstTouch:function(){var e=!1,t=this.elementsSelector,n=this;$("body").on("touchmove.mlightbox",t,(function(){e=!0})),$("body").on("touchend.mlightbox",t,(function(i){e||("boolean"!=typeof i.cancelable||i.cancelable)&&(i.preventDefault(),n.loadLightbox(i),$("body").off(".mlightbox",t))})),$("body").on("touchstart.mlightbox",t,(function(){e=!1}))},loadLightbox:function(e){var t=this.lightboxOptions,n=this.elements,i=e?$(e.target):n.eq(0);Ibles.loadJsBundle("lightbox_js",(function(){n.ibleLightbox(t),i.click()}))},showLightbox:function(){this.elements.eq(0).click()}}),Ibles.package("Ibles.views"),Ibles.views.ScrollablePhotosetView=Backbone.View.extend({template:_.template(Ibles.JST["scrollable-photoset"]),photosetHeightInVW:57,initialize:function(e){var t=e||{},n=t.fileCollection;this.galleryId=_.uniqueId("sphotoset"),this.title=t.title,this.photosetWidth=t.photosetWidth||$("#article").width(),this.photosetHeight=t.photosetHeight||Math.round($(window).width()*this.photosetHeightInVW/100),this.render(n),Ibles.isMobile()&&this.setupLightbox(n)},setupLightbox:function(e){var t=e.map((function(e){return{id:e.get("id"),imageUrl:e.getLargeUrl()}}));new Ibles.views.MobileLightboxTouchLoader({elements:this.$("."+this.galleryId),navbarPosition:"top",imageSet:t})},render:function(e){var t=this,n=e.groupBy((function(e){return"VIDEO"==e.getEmbedType()?"videoFiles":"imageFiles"})),i=n.imageFiles||[],s=n.videoFiles||[],r=i.length,o=s.length,a=r>1,l=$(t.template({numImages:r,numVideos:o,willScroll:a,photosetHeight:t.photosetHeight+"px"}));t.renderCells(s,l.find(".js-videos"),a),t.renderCells(i,l.find(".js-images"),a),t.$el.append(l)},renderCells:function(e,t,n){var i=this;_.each(e,(function(e){var s=new Ibles.views.ScrollablePhotosetCell({model:e,title:i.title,galleryId:i.galleryId,willScroll:n});t.append(s.render().$el)}))}}),Ibles.views.ScrollablePhotosetCell=Backbone.View.extend({template:_.template(Ibles.JST["scrollable-photoset-item"]),minAspect:{ratio:2/3,ratioRnded:.7,cropParam:"2:3"},maxAspect:{ratio:1.5,ratioRnded:1.5,cropParam:"3:2"},maxImageWidthsByType:{small:320,medium:620,large:1024},initialize:function(e){var t=e||{};this.galleryId=t.galleryId,this.title=t.title,this.willScroll=t.willScroll,this.aspectRatio=this.model.getWidth()/this.model.getHeight(),this.cropParam=this.getCrop()},render:function(){var e=this,t=e.getTemplateContext();return e.setElement(e.template(t)),this},getTemplateContext:function(){var e=this,t=this.model,n=t.getYouTubeVideoID();return{title:e.title,galleryId:e.galleryId,fileId:t.getId(),resizedImageUrl:e.getCellImageUrl(),isGif:t.isGif(),gifUrl:t.getLargeAnimationUrl(),mp4Url:t.getMp4Url(),embedType:t.getEmbedType(),embedHtmlCode:t.isYouTubeEmbed()&&n?_.template(Ibles.JST["videoset-youtube-cell"])({name:t.get("name"),videoID:n}):Ibles.makeSafeForSSL(t.getEmbedHtmlCode()),imageNotes:t.getImageNotes()}},getCrop:function(){var e,t=this.model;if("VIDEO"!=t.getEmbedType()&&this.willScroll){var n,i=this.minAspect,s=this.maxAspect,r=t.getWidth()/t.getHeight(),o=(n=r,Math.round(10*n)/10),a=i.ratio,l=a.ratioRnded,c=s.ratio,d=s.ratioRnded;return o<l?(r=a,e=i.cropParam):o>d&&(r=c,e=s.cropParam),e}},getCellImageUrl:function(){var e=this,t=e.model,n=e.willScroll,i=e.photosetHeight,s=i*e.aspectRatio,r=Ibles.isMobile()?"small":"large",o=1*e.maxImageWidthsByType[r]/e.aspectRatio,a=e.cropParam,l={frame:!0};return Ibles.isMobile()?_.extend(l,{width:320}):_.extend(l,{width:1024,height:1024,fit:"bounds"}),a&&(l.crop=a),n?i<t.getHeight()&&i<o&&(l.height=i):(s=e.photosetWidth)<t.getWidth()&&(l.width=s),t.getOptimizedImageUrl(l)}}),Ibles.JST["comment-item"]='<article class="post js-comment <[ if (isReply) {]>reply<[}]> <[ if (!visible) {]>hide<[}]>" data-id="<< id >>" data-stepid="<< stepId >>" <[ if (isReply) {]>data-inreplyto="<< replyAuthor >>"<[}]>>\n    <div class="post-header">\n        <div class="meta">\n            <[ if (Ibles.isDesktop()) {]>\n                <div class="votes js-vote-count <[ if (!upvotingEnabled || !rating) {]>hide<[}]>"><< rating >></div>\n            <[}]>\n\n            <div class="avatar">\n                <a href="<< authorUrl >>">\n                    <img <[ if (lazyImage) {]>class="lazyload" src="<< Ibles.staticUrl(\'img/pixel.png\') >>" data-<[}]>src="<< avatar >>">\n                </a>\n            </div>\n            <div class="posted-by">\n                <a class="author" href="<< authorUrl >>"><< author >></a>\n                <[ if (isReply) {]>\n                    <i class="icon-arrow-right"></i>\n                    <button class="replied-to js-reply-parent" href="<< Ibles.reverseUrls.memberUrl(replyAuthor) >>"><< replyAuthor >></button>\n                <[}]>\n                <p class="posted-date">\n                    <[ if (isQuestion) {]>\n                    <span class="label question-label">Question</span>\n                    <[} else if (isTip) {]>\n                    <span class="label tip-label">Tip</span>\n                    <[} else if (isBestAnswer) {]>\n                    <span class="label best-answer-label">Best Answer</span>\n                    <[} else if (!isReply) {]>\n\n                    <[} else {]>\n                         <[ if (isAnswer) {]>Answer<[} else {]>Reply<[}]>\n                    <[}]>\n                    << commentTime >>\n                    <[ if (stepId){ ]>on <a class="step-link" href="#<< stepAnchorId >>"><< stepIndexLabel >></a><[}]>\n                </p>\n            </div>\n        </div>\n        <[ if (Ibles.isDesktop()) {]>\n            <div class="toolbar js-toolbar">\n                <[ if (replyEnabled) {]>\n                    <button class="btn reply-btn js-reply"><[ if (isQuestion) {]>Answer<[}else{]>Reply<[}]></button>\n                <[ } ]>\n                <[ if (upvotingEnabled) {]>\n                    <button class="btn vote-btn js-vote-btn">Upvote</button>\n                <[ } ]>\n                <[ if (isAnswer) {]>\n                    <p class="best-answer-actions">\n                        <button class="btn btn-default js-toggle-best-answer hide"><[ if (isAnswer){]>Select as Best Answer<[}else{]>Undo Best Answer<[}]></button>\n                    </p>\n                <[}]>\n            </div>\n        <[}]>\n    </div>\n\n    <div class="text js-text">\n        <p class="quarantine-message js-quarantine-message"></p>\n        << body >>\n    </div>\n\n    <div class="js-edit-container"></div>\n\n    <div class="photos js-photos"></div>\n    <div class="attachments js-attachments"></div>\n\n    <[ if (lastVisibleInThread) {]>\n        <button class="hidden-replies-link js-show-replies">\n            << numRepliesFromMe >>\n            <[ if (isQuestion || isAnswer) {]>\n                << Ibles.pluralize(numRepliesFromMe, "answer", "answers") >>\n            <[} else {]>\n                << Ibles.pluralize(numRepliesFromMe, "reply", "replies") >>\n            <[}]>\n            <i class="icon-arrow-down"></i>\n        </button>\n    <[}]>\n\n    <[ if (Ibles.isMobile()) {]>\n        <div class="toolbar js-toolbar">\n            <div class="votes js-vote-count <[ if (!upvotingEnabled || !rating) {]>hide<[}]>"><< rating >></div>\n            <button class="btn reply-btn js-reply"><[ if (isQuestion) {]>Answer<[}else{]>Reply<[}]></button>\n            <[ if (upvotingEnabled) {]>\n                <button class="btn vote-btn js-vote-btn">Upvote</button>\n            <[ } ]>\n        </div>\n        <[ if (isAnswer) {]>\n            <p class="best-answer-actions">\n                <button class="btn btn-default js-toggle-best-answer hide"><[ if (isAnswer){]>Select as Best Answer<[}else{]>Undo Best Answer<[}]></button>\n            </p>\n        <[}]>\n    <[}]>\n</article>\n',Ibles.JST["comment-toolbar"]='<div class="toolbar js-toolbar">\n    <[ if (Ibles.isMobile()) {]>\n        <div class="votes js-vote-count <[ if (!rating) {]>hide<[}]>"><< rating >></div>\n    <[}]>\n    <button class="btn reply-btn js-reply">\n        <[ if (isQuestion) {]>Answer<[}else{]>Reply<[}]>\n    </button>\n    <[ if (upvotingEnabled) {]>\n    <button class="btn vote-btn js-vote-btn">Upvote</button>\n    <[ } ]>\n<[ if (Ibles.isMobile()) {]>\n</div>\n<[ } ]>\n<[ if (isAnswer) {]>\n    <p class="best-answer-actions">\n        <a class="btn btn-default js-toggle-best-answer hide"><[ if (isAnswer){]>Select as Best Answer<[}else{]>Undo Best Answer<[}]></a>\n    </p>\n<[}]>\n<[ if (Ibles.isDesktop()) {]>\n</div>\n<[ } ]>\n',Ibles.JST["comment-posting-view"]='<div class="discuss <[ if (!typeSelected) {]>discuss-all<[}]>">\n    <[ if (isMobile) {]>\n    <div class="postbox">\n        <img class="poster" src="<< avatar >>">\n        <p class="policy">We have a <b>be nice</b> policy.<br> Be positive and constructive.</p>\n    </div>\n    <[ } ]>\n    <div class="postbox">\n        <[ if (!isMobile) {]>\n        <img class="poster" src="<< avatar >>">\n        <[ } ]>\n        <div class="field js-redactor-container">\n            <[ if (!typeSelected) {]>\n                <button class="type-btn tip-type js-type-tip"><[ if (isMobile){]>Tip<[}else{]>Add Tip<[}]></button>\n                <button class="type-btn question-type js-type-question"><[ if (isMobile){]>Question<[}else{]>Ask Question<[}]></button>\n                <button class="type-btn comment-type js-type-comment"><[ if (isMobile){]>Comment<[}else{]>Post Comment<[}]></button>\n            <[ } else { ]>\n                <div class="comment-tip redactor-tooltip" data-toggle="tooltip" data-placement="top" title="Highlight text to apply styling"></div>\n                <textarea class="body-input js-body-input redactor-textarea"><[ if (commentBody){ ]><< commentBody >><[}]></textarea>\n            <[ } ]>\n        </div>\n    </div>\n    <div class="image-bucket js-image-bucket clearfix"></div>\n    <div class="alert alert-danger alert-error"></div>\n    <[ if (isIMadeIt) { ]>\n    <div class="alert alert-info imadeit-alert">\n        Please include at least one image of what you made. Add images below.\n    </div>\n    <[ } ]>\n    <div class="actions">\n        <[ if (!isMobile) {]>\n            <p class="policy">We have a <b>be nice</b> policy.<br> Please be positive and constructive.</p>\n        <[}]>\n        <[ if (isEdit) {]>\n            <button class="btn cancel-btn">Cancel</button>\n        <[ } ]>\n        <button class="btn add-image-btn" <[ if (!typeSelected) {]> disabled<[}]>>\n            <img class="uploading-indicator" src="<< Ibles.staticUrl(\'img/ajax_loader_48px.gif\') >>"> Add Images\n        </button>\n        <button class="btn btn-yellow post-btn" <[ if (!typeSelected) {]> disabled<[}]>>\n            <img class="posting-indicator" src="<< Ibles.staticUrl(\'img/ajax_loader_48px.gif\') >>"> <[ if (!submitLabel) {]>Post<[ } else { ]><< submitLabel >><[ } ]>\n        </button>\n    </div>\n</div>\n',Ibles.JST["comment-hidden-replies-toggler"]='<a class="hidden-replies-link js-show-replies" role="button">\n    << replyCountlabel >><i class="icon-arrow-down"></i>\n</a>',Ibles.JST["comment-author-opts"]='<button class="pull-left edit-comment js-edit hide-mobile">Edit</button>\n<[ if (hasChildren){]>\n    <button class="pull-left delete-comment js-del-thread">Delete Thread</button>\n<[ } else { ]>\n    <button class="pull-left delete-comment js-del-comment">Delete</button>\n<[ } ]>\n',Ibles.JST["comment-modal"]='<div class="modal fade comment-modal << modalClass >>">\n    <div class="modal-dialog modal-sm">\n        <div class="modal-content">\n            <div class="modal-body">\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>\n                <div class="js-gallery"></div>\n                <div class="primary-comment">\n                    <div class="js-primary-comment">\n                        <div class="loader">\n                            <img class="comment-modal-loader" src="<< Ibles.staticUrl(\'img/ajax_loader_48px.gif\') >>">\n                        </div>\n                    </div>\n                </div>\n                <div class="discussions js-replies">\n                    <div class="replies js-comments"></div>\n                </div>\n            </div>\n            <[ if (!hideNavigation) { ]>\n                <a href="javascript:void(0);" title="Next" class="js-next fancybox-nav fancybox-next"><span></span></a>\n                <a href="javascript:void(0);" title="Previous" class="js-prev fancybox-nav fancybox-prev"><span></span></a>\n            <[ } ]>\n        </div>\n    </div>\n</div>\n',Ibles.JST["comment-modal-gallery"]='<div class="scrollable-cards comment-modal-gallery <[ if (willScroll){]>will-scroll<[}]>">\n    <div class="scrollable-cards-inner" <[ if (willScroll) {]>style="height:<< galleryHeight >>px"<[}]>>\n        <[ _.each(imageFiles, function(file) { ]>\n            <div class="scrollable-card ">\n                <a href="<< file.getLargeAnimationUrl() >>" target="_blank"><img src="<< file.getOptimizedImageUrl({height: galleryHeight, frame: false}) >>"></a>\n            </div>\n        <[ }); ]>\n    </div>\n    <button class="control left-control hide-mobile" title="Previous"><i class="icon icon-arrow-left"></i></button>\n    <button class="control right-control hide-mobile <[ if (willScroll){]>active<[}]>" title="Next"><i class="icon icon-arrow-right"></i></button>\n</div>\n',Ibles.JST["comment-attached-file"]='<div class="file-info">\n    <a class="thumb-wrapper" href="<< attachmentUrl >>" download="<< name >>">\n        <span class="file-thumb"><img class="tiny-img" src="<< typeThumbnail >>" alt="<< name >>"></span>\n        <span class="title"><< name >></span>\n    </a>\n    <div class="file-actions">\n        <a href="<< attachmentUrl >>" download="<< name >>" class="btn pull-right">Download</a>\n    </div>\n</div>\n',Ibles.JST["comment-delete-prompt"]='<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>\n    <h3 class="center"><< title >></h3>\n</div>\n<div class="modal-body clearfix">\n    <p class="center">Are you sure you want to delete it?</p>\n    <button class="btn btn-yellow btn-lg delete-btn pull-right"> Delete </button>\n    <button data-dismiss="modal" class="btn btn-lg pull-right cancel-btn"> Cancel </button>\n    <p class="center alert-error hide">Oops! There was a problem deleting.</p>\n</div>\n',function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(t){function n(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=Object.create(e.prototype);for(var s in n)i[s]=n[s];return i.constructor=t,t.prototype=i,t}function i(e){e=e||{},this.defaultProtocol=e.defaultProtocol||l.defaultProtocol,this.events=e.events||l.events,this.format=e.format||l.format,this.formatHref=e.formatHref||l.formatHref,this.nl2br=e.nl2br||l.nl2br,this.tagName=e.tagName||l.tagName,this.target=e.target||l.target,this.validate=e.validate||l.validate,this.ignoreTags=[],this.attributes=e.attributes||e.linkAttributes||l.attributes,this.className=e.className||e.linkClass||l.className;for(var t=e.ignoreTags||l.ignoreTags,n=0;n<t.length;n++)this.ignoreTags.push(t[n].toUpperCase())}function s(e){return e}function r(e,t,n,i){for(var s=0,r=e.length,o=t,a=[],l=void 0;s<r&&(l=o.next(e[s]));)o=l,s++;if(s>=r)return[];for(;s<r-1;)l=new u(i),a.push(l),o.on(e[s],l),o=l,s++;return l=new u(n),a.push(l),o.on(e[r-1],l),a}function o(e){return n(f,(function(e){e&&(this.v=e)}),e?{v:e}:{})}function a(e){return e instanceof m||e instanceof z}var l={defaultProtocol:"http",events:null,format:s,formatHref:s,nl2br:!1,tagName:"a",target:function(e,t){return"url"===t?"_blank":null},validate:!0,ignoreTags:[],attributes:null,className:"linkified"};i.prototype={resolve:function(e){var t=e.toHref(this.defaultProtocol);return{formatted:this.get("format",e.toString(),e),formattedHref:this.get("formatHref",t,e),tagName:this.get("tagName",t,e),className:this.get("className",t,e),target:this.get("target",t,e),events:this.getObject("events",t,e),attributes:this.getObject("attributes",t,e)}},check:function(e){return this.get("validate",e.toString(),e)},get:function(t,n,i){var s=this[t];if(!s)return s;switch(void 0===s?"undefined":e(s)){case"function":return s(n,i.type);case"object":var r=s[i.type]||l[t];return"function"==typeof r?r(n,i.type):r}return s},getObject:function(e,t,n){var i=this[e];return"function"==typeof i?i(t,n.type):i}};var c=Object.freeze({defaults:l,Options:i,contains:function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1}}),d=function(e){this.j=[],this.T=e||null};d.prototype={defaultTransition:!1,on:function(e,t){if(e instanceof Array){for(var n=0;n<e.length;n++)this.j.push([e[n],t]);return this}return this.j.push([e,t]),this},next:function(e){for(var t=0;t<this.j.length;t++){var n=this.j[t],i=n[0],s=n[1];if(this.test(e,i))return s}return this.defaultTransition},accepts:function(){return!!this.T},test:function(e,t){return e===t},emit:function(){return this.T}};var u=n(d,(function(e){this.j=[],this.T=e||null}),{test:function(e,t){return e===t||t instanceof RegExp&&t.test(e)}}),h=n(d,(function(e){this.j=[],this.T=e||null}),{jump:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.next(new e(""));return n===this.defaultTransition?(n=new this.constructor(t),this.on(e,n)):t&&(n.T=t),n},test:function(e,t){return e instanceof t}}),f=function(e){e&&(this.v=e)};f.prototype={toString:function(){return this.v+""}};var m=o(),p=o("@"),g=o(":"),b=o("."),v=o(),w=o(),y=o("\n"),_=o(),k=o("+"),I=o("#"),C=o(),x=o("mailto:"),S=o("?"),A=o("/"),T=o("_"),E=o(),z=o(),R=o(),P=o("{"),O=o("["),U=o("<"),D=o("("),B=o("}"),M=o("]"),F=o(">"),j=o(")"),N=o("&"),L=Object.freeze({Base:f,DOMAIN:m,AT:p,COLON:g,DOT:b,PUNCTUATION:v,LOCALHOST:w,NL:y,NUM:_,PLUS:k,POUND:I,QUERY:S,PROTOCOL:C,MAILTO:x,SLASH:A,UNDERSCORE:T,SYM:E,TLD:z,WS:R,OPENBRACE:P,OPENBRACKET:O,OPENANGLEBRACKET:U,OPENPAREN:D,CLOSEBRACE:B,CLOSEBRACKET:M,CLOSEANGLEBRACKET:F,CLOSEPAREN:j,AMPERSAND:N}),$="aaa|aarp|abb|abbott|abogado|ac|academy|accenture|accountant|accountants|aco|active|actor|ad|adac|ads|adult|ae|aeg|aero|af|afl|ag|agency|ai|aig|airforce|airtel|al|alibaba|alipay|allfinanz|alsace|am|amica|amsterdam|an|analytics|android|ao|apartments|app|apple|aq|aquarelle|ar|aramco|archi|army|arpa|arte|as|asia|associates|at|attorney|au|auction|audi|audio|author|auto|autos|avianca|aw|ax|axa|az|azure|ba|baidu|band|bank|bar|barcelona|barclaycard|barclays|bargains|bauhaus|bayern|bb|bbc|bbva|bcg|bcn|bd|be|beats|beer|bentley|berlin|best|bet|bf|bg|bh|bharti|bi|bible|bid|bike|bing|bingo|bio|biz|bj|black|blackfriday|bloomberg|blue|bm|bms|bmw|bn|bnl|bnpparibas|bo|boats|boehringer|bom|bond|boo|book|boots|bosch|bostik|bot|boutique|br|bradesco|bridgestone|broadway|broker|brother|brussels|bs|bt|budapest|bugatti|build|builders|business|buy|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|call|camera|camp|cancerresearch|canon|capetown|capital|car|caravan|cards|care|career|careers|cars|cartier|casa|cash|casino|cat|catering|cba|cbn|cc|cd|ceb|center|ceo|cern|cf|cfa|cfd|cg|ch|chanel|channel|chase|chat|cheap|chloe|christmas|chrome|church|ci|cipriani|circle|cisco|citic|city|cityeats|ck|cl|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|cm|cn|co|coach|codes|coffee|college|cologne|com|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cool|coop|corsica|country|coupon|coupons|courses|cr|credit|creditcard|creditunion|cricket|crown|crs|cruises|csc|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dabur|dad|dance|date|dating|datsun|day|dclk|de|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|diamonds|diet|digital|direct|directory|discount|dj|dk|dm|dnp|do|docs|dog|doha|domains|download|drive|dubai|durban|dvag|dz|earth|eat|ec|edeka|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epson|equipment|er|erni|es|esq|estate|et|eu|eurovision|eus|events|everbank|exchange|expert|exposed|express|fage|fail|fairwinds|faith|family|fan|fans|farm|fashion|fast|feedback|ferrero|fi|film|final|finance|financial|firestone|firmdale|fish|fishing|fit|fitness|fj|fk|flickr|flights|florist|flowers|flsmidth|fly|fm|fo|foo|football|ford|forex|forsale|forum|foundation|fox|fr|fresenius|frl|frogans|frontier|fund|furniture|futbol|fyi|ga|gal|gallery|gallup|game|garden|gb|gbiz|gd|gdn|ge|gea|gent|genting|gf|gg|ggee|gh|gi|gift|gifts|gives|giving|gl|glass|gle|global|globo|gm|gmail|gmbh|gmo|gmx|gn|gold|goldpoint|golf|goo|goog|google|gop|got|gov|gp|gq|gr|grainger|graphics|gratis|green|gripe|group|gs|gt|gu|gucci|guge|guide|guitars|guru|gw|gy|hamburg|hangout|haus|hdfcbank|health|healthcare|help|helsinki|here|hermes|hiphop|hitachi|hiv|hk|hm|hn|hockey|holdings|holiday|homedepot|homes|honda|horse|host|hosting|hoteles|hotmail|house|how|hr|hsbc|ht|hu|hyundai|ibm|icbc|ice|icu|id|ie|ifm|iinet|il|im|immo|immobilien|in|industries|infiniti|info|ing|ink|institute|insurance|insure|int|international|investments|io|ipiranga|iq|ir|irish|is|iselect|ist|istanbul|it|itau|iwc|jaguar|java|jcb|je|jetzt|jewelry|jlc|jll|jm|jmp|jo|jobs|joburg|jot|joy|jp|jpmorgan|jprs|juegos|kaufen|kddi|ke|kerryhotels|kerrylogistics|kerryproperties|kfh|kg|kh|ki|kia|kim|kinder|kitchen|kiwi|km|kn|koeln|komatsu|kp|kpn|kr|krd|kred|kuokgroup|kw|ky|kyoto|kz|la|lacaixa|lamborghini|lamer|lancaster|land|landrover|lanxess|lasalle|lat|latrobe|law|lawyer|lb|lc|lds|lease|leclerc|legal|lexus|lgbt|li|liaison|lidl|life|lifeinsurance|lifestyle|lighting|like|limited|limo|lincoln|linde|link|live|living|lixil|lk|loan|loans|local|locus|lol|london|lotte|lotto|love|lr|ls|lt|ltd|ltda|lu|lupin|luxe|luxury|lv|ly|ma|madrid|maif|maison|makeup|man|management|mango|market|marketing|markets|marriott|mba|mc|md|me|med|media|meet|melbourne|meme|memorial|men|menu|meo|mg|mh|miami|microsoft|mil|mini|mk|ml|mm|mma|mn|mo|mobi|mobily|moda|moe|moi|mom|monash|money|montblanc|mormon|mortgage|moscow|motorcycles|mov|movie|movistar|mp|mq|mr|ms|mt|mtn|mtpc|mtr|mu|museum|mutuelle|mv|mw|mx|my|mz|na|nadex|nagoya|name|natura|navy|nc|ne|nec|net|netbank|network|neustar|new|news|nexus|nf|ng|ngo|nhk|ni|nico|nikon|ninja|nissan|nl|no|nokia|norton|nowruz|np|nr|nra|nrw|ntt|nu|nyc|nz|obi|office|okinawa|om|omega|one|ong|onl|online|ooo|oracle|orange|org|organic|origins|osaka|otsuka|ovh|pa|page|pamperedchef|panerai|paris|pars|partners|parts|party|passagens|pe|pet|pf|pg|ph|pharmacy|philips|photo|photography|photos|physio|piaget|pics|pictet|pictures|pid|pin|ping|pink|pizza|pk|pl|place|play|playstation|plumbing|plus|pm|pn|pohl|poker|porn|post|pr|praxi|press|pro|prod|productions|prof|promo|properties|property|protection|ps|pt|pub|pw|pwc|py|qa|qpon|quebec|quest|racing|re|read|realtor|realty|recipes|red|redstone|redumbrella|rehab|reise|reisen|reit|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|ricoh|rio|rip|ro|rocher|rocks|rodeo|room|rs|rsvp|ru|ruhr|run|rw|rwe|ryukyu|sa|saarland|safe|safety|sakura|sale|salon|samsung|sandvik|sandvikcoromant|sanofi|sap|sapo|sarl|sas|saxo|sb|sbs|sc|sca|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scor|scot|sd|se|seat|security|seek|select|sener|services|seven|sew|sex|sexy|sfr|sg|sh|sharp|shell|shia|shiksha|shoes|show|shriram|si|singles|site|sj|sk|ski|skin|sky|skype|sl|sm|smile|sn|sncf|so|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|space|spiegel|spot|spreadbetting|sr|srl|st|stada|star|starhub|statefarm|statoil|stc|stcgroup|stockholm|storage|store|studio|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|swatch|swiss|sx|sy|sydney|symantec|systems|sz|tab|taipei|taobao|tatamotors|tatar|tattoo|tax|taxi|tc|tci|td|team|tech|technology|tel|telecity|telefonica|temasek|tennis|tf|tg|th|thd|theater|theatre|tickets|tienda|tiffany|tips|tires|tirol|tj|tk|tl|tm|tmall|tn|to|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|tp|tr|trade|trading|training|travel|travelers|travelersinsurance|trust|trv|tt|tube|tui|tunes|tushu|tv|tvs|tw|tz|ua|ubs|ug|uk|unicom|university|uno|uol|us|uy|uz|va|vacations|vana|vc|ve|vegas|ventures|verisign|versicherung|vet|vg|vi|viajes|video|viking|villas|vin|vip|virgin|vision|vista|vistaprint|viva|vlaanderen|vn|vodka|volkswagen|vote|voting|voto|voyage|vu|vuelos|wales|walter|wang|wanggou|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weir|wf|whoswho|wien|wiki|williamhill|win|windows|wine|wme|wolterskluwer|work|works|world|ws|wtc|wtf|xbox|xerox|xin|xperia|xxx|xyz|yachts|yahoo|yamaxun|yandex|ye|yodobashi|yoga|yokohama|youtube|yt|za|zara|zero|zip|zm|zone|zuerich|zw".split("|"),V="0123456789".split(""),q="0123456789abcdefghijklmnopqrstuvwxyz".split(""),H=[" ","\f","\r","\t","\v"," "," ","᠎"],W=[],G=function(e){return new u(e)},Z=G(),J=G(_),Q=G(m),K=G(),Y=G(R);Z.on("@",G(p)).on(".",G(b)).on("+",G(k)).on("#",G(I)).on("?",G(S)).on("/",G(A)).on("_",G(T)).on(":",G(g)).on("{",G(P)).on("[",G(O)).on("<",G(U)).on("(",G(D)).on("}",G(B)).on("]",G(M)).on(">",G(F)).on(")",G(j)).on("&",G(N)).on([",",";","!",'"',"'"],G(v)),Z.on("\n",G(y)).on(H,Y),Y.on(H,Y);for(var X=0;X<$.length;X++){var ee=r($[X],Z,z,m);W.push.apply(W,ee)}var te=r("file",Z,m,m),ne=r("ftp",Z,m,m),ie=r("http",Z,m,m),se=r("mailto",Z,m,m);W.push.apply(W,te),W.push.apply(W,ne),W.push.apply(W,ie);var re=te.pop(),oe=ne.pop(),ae=ie.pop(),le=se.pop(),ce=G(m),de=G(C),ue=G(x);oe.on("s",ce).on(":",de),ae.on("s",ce).on(":",de),W.push(ce),re.on(":",de),ce.on(":",de),le.on(":",ue);var he=r("localhost",Z,w,m);W.push.apply(W,he),Z.on(V,J),J.on("-",K).on(V,J).on(q,Q),Q.on("-",K).on(q,Q);for(var fe=0;fe<W.length;fe++)W[fe].on("-",K).on(q,Q);K.on("-",K).on(V,Q).on(q,Q),Z.defaultTransition=G(E);var me=function(e){for(var t=e.replace(/[A-Z]/g,(function(e){return e.toLowerCase()})),n=e.length,i=[],s=0;s<n;){for(var r=Z,o=null,a=0,l=null,c=-1;s<n&&(o=r.next(t[s]));)null,(r=o).accepts()?(c=0,l=r):c>=0&&c++,a++,s++;if(!(c<0)){s-=c,a-=c;var d=l.emit();i.push(new d(e.substr(s-a,a)))}}return i},pe=Z,ge=Object.freeze({State:u,TOKENS:L,run:me,start:pe}),be=function(e){e&&(this.v=e)};be.prototype={type:"token",isLink:!1,toString:function(){for(var e=[],t=0;t<this.v.length;t++)e.push(this.v[t].toString());return e.join("")},toHref:function(){return this.toString()},toObject:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http";return{type:this.type,value:this.toString(),href:this.toHref(e)}}};var ve=n(be,(function(e){e&&(this.v=e)}),{type:"email",isLink:!0}),we=n(be,(function(e){e&&(this.v=e)}),{type:"email",isLink:!0,toHref:function(){return this.v,"mailto:"+this.toString()}}),ye=n(be,(function(e){e&&(this.v=e)}),{type:"text"}),_e=n(be,(function(e){e&&(this.v=e)}),{type:"nl"}),ke=n(be,(function(e){e&&(this.v=e)}),{type:"url",isLink:!0,toHref:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http",t=!1,n=!1,i=this.v,s=[],r=0;i[r]instanceof C;)t=!0,s.push(i[r].toString().toLowerCase()),r++;for(;i[r]instanceof A;)n=!0,s.push(i[r].toString()),r++;for(;a(i[r]);)s.push(i[r].toString().toLowerCase()),r++;for(;r<i.length;r++)s.push(i[r].toString());return s=s.join(""),t||n||(s=e+"://"+s),s},hasProtocol:function(){return this.v[0]instanceof C}}),Ie=Object.freeze({Base:be,MAILTOEMAIL:ve,EMAIL:we,NL:_e,TEXT:ye,URL:ke}),Ce=function(e){return new h(e)},xe=Ce(),Se=Ce(),Ae=Ce(),Te=Ce(),Ee=Ce(),ze=Ce(),Re=Ce(),Pe=Ce(ke),Oe=Ce(),Ue=Ce(ke),De=Ce(ke),Be=Ce(),Me=Ce(),Fe=Ce(),je=Ce(),Ne=Ce(),Le=Ce(ke),$e=Ce(ke),Ve=Ce(ke),qe=Ce(ke),He=Ce(),We=Ce(),Ge=Ce(),Ze=Ce(),Je=Ce(),Qe=Ce(),Ke=Ce(we),Ye=Ce(),Xe=Ce(we),et=Ce(ve),tt=Ce(),nt=Ce(),it=Ce(),st=Ce(),rt=Ce(_e);xe.on(y,rt).on(C,Se).on(x,Ae).on(A,Te),Se.on(A,Te),Te.on(A,Ee),xe.on(z,ze).on(m,ze).on(w,Pe).on(_,ze),Ee.on(z,De).on(m,De).on(_,De).on(w,De),ze.on(b,Re),Je.on(b,Qe),Re.on(z,Pe).on(m,ze).on(_,ze).on(w,ze),Qe.on(z,Ke).on(m,Je).on(_,Je).on(w,Je),Pe.on(b,Re),Ke.on(b,Qe),Pe.on(g,Oe).on(A,De),Oe.on(_,Ue),Ue.on(A,De),Ke.on(g,Ye),Ye.on(_,Xe);var ot=[m,p,w,_,k,I,C,A,z,T,E,N],at=[g,b,S,v,B,M,F,j,P,O,U,D];De.on(P,Me).on(O,Fe).on(U,je).on(D,Ne),Be.on(P,Me).on(O,Fe).on(U,je).on(D,Ne),Me.on(B,De),Fe.on(M,De),je.on(F,De),Ne.on(j,De),Le.on(B,De),$e.on(M,De),Ve.on(F,De),qe.on(j,De),He.on(B,De),We.on(M,De),Ge.on(F,De),Ze.on(j,De),Me.on(ot,Le),Fe.on(ot,$e),je.on(ot,Ve),Ne.on(ot,qe),Me.on(at,He),Fe.on(at,We),je.on(at,Ge),Ne.on(at,Ze),Le.on(ot,Le),$e.on(ot,$e),Ve.on(ot,Ve),qe.on(ot,qe),Le.on(at,Le),$e.on(at,$e),Ve.on(at,Ve),qe.on(at,qe),He.on(ot,Le),We.on(ot,$e),Ge.on(ot,Ve),Ze.on(ot,qe),He.on(at,He),We.on(at,We),Ge.on(at,Ge),Ze.on(at,Ze),De.on(ot,De),Be.on(ot,De),De.on(at,Be),Be.on(at,Be),Ae.on(z,et).on(m,et).on(_,et).on(w,et),et.on(ot,et).on(at,tt),tt.on(ot,et).on(at,tt);var lt=[m,_,k,I,S,T,E,N,z];ze.on(lt,nt).on(p,it),Pe.on(lt,nt).on(p,it),Re.on(lt,nt),nt.on(lt,nt).on(p,it).on(b,st),st.on(lt,nt),it.on(z,Je).on(m,Je).on(w,Ke);var ct=function(e){for(var t=e.length,n=0,i=[],s=[];n<t;){for(var r=xe,o=null,a=null,l=0,c=null,d=-1;n<t&&!(o=r.next(e[n]));)s.push(e[n++]);for(;n<t&&(a=o||r.next(e[n]));)o=null,(r=a).accepts()?(d=0,c=r):d>=0&&d++,n++,l++;if(d<0)for(var u=n-l;u<n;u++)s.push(e[u]);else{s.length>0&&(i.push(new ye(s)),s=[]),n-=d,l-=d;var h=c.emit();i.push(new h(e.slice(n-l,n)))}}return s.length>0&&i.push(new ye(s)),i},dt=Object.freeze({State:h,TOKENS:Ie,run:ct,start:xe});Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)});var ut=function(e){return ct(me(e))};t.find=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=ut(e),i=[],s=0;s<n.length;s++){var r=n[s];!r.isLink||t&&r.type!==t||i.push(r.toObject())}return i},t.inherits=n,t.options=c,t.parser=dt,t.scanner=ge,t.test=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=ut(e);return 1===n.length&&n[0].isLink&&(!t||n[0].type===t)},t.tokenize=ut}(self.linkify=self.linkify||{})}(),function(e,t){var n=function(e){function t(e){this.a=e}function n(e){return m.test(e)}function i(e){return p.test(e)}function s(e,t){this.b=e,this.c=t,this.d=null,this.input=null,this.e=-1,this.f=-1,this.g=-1,this.h=-1,this.i=-1,this.j()}function r(e,t){this.k=null,this.startLine=1,this.startColumn=0,this.options=t||{},this.tokenizer=new s(this,e)}function o(t,n){for(var i=e.tokenize(t),s=[],r=0;r<i.length;r++){var o=i[r];if("nl"===o.type&&n.nl2br)s.push({type:y,tagName:"br",attributes:[],l:!0});else if(o.isLink&&n.check(o)){var a=n.resolve(o),l=(a.href,a.formatted),c=a.formattedHref,d=a.tagName,u=a.className,h=a.target,f=a.attributes,m=[["href",c]];for(var p in u&&m.push(["class",u]),h&&m.push(["target",h]),f)m.push([p,f[p]]);s.push({type:y,tagName:d,attributes:m,l:!1}),s.push({type:k,chars:l}),s.push({type:_,tagName:d})}else s.push({type:k,chars:o.toString()})}return s}function a(e,t,n,i){for(var s=1;n<t.length&&s>0;){var r=t[n];r.type===y&&r.tagName.toUpperCase()===e?s++:r.type===_&&r.tagName.toUpperCase()===e&&s--,i.push(r),n++}return i}function l(e){return e.replace(/"/g,"&quot;")}function c(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],s=i[0],r=i[1];t.push(s+'="'+l(r)+'"')}return t}var d={m:" "},u=/^#[xX]([A-Fa-f0-9]+)$/,h=/^#([0-9]+)$/,f=/^([A-Za-z0-9]+)$/;t.prototype.parse=function(e){if(e){var t=e.match(u);return t?"&#x"+t[1]+";":(t=e.match(h))?"&#"+t[1]+";":(t=e.match(f))?this.a[t[1]]||"&"+t[1]+";":void 0}};var m=/[\t\n\f ]/,p=/[A-Za-z]/,g=/\r\n?/g;s.prototype={j:function(){this.d="beforeData",this.input="",this.e=0,this.f=1,this.g=0,this.h=-1,this.i=-1,this.b.j()},tokenize:function(e){this.j(),this.tokenizePart(e),this.tokenizeEOF()},tokenizePart:function(e){for(this.input+=function(e){return e.replace(g,"\n")}(e);this.e<this.input.length;)this.n[this.d].call(this)},tokenizeEOF:function(){this.o()},o:function(){"data"===this.d&&(this.b.p(),this.d="beforeData")},q:function(){return this.input.charAt(this.e)},r:function(){var e=this.q();return this.e++,"\n"===e?(this.f++,this.g=0):this.g++,e},s:function(){var e=this.input.indexOf(";",this.e);if(-1!==e){var t=this.input.slice(this.e,e),n=this.c.parse(t);if(n){for(var i=t.length;i;)this.r(),i--;return this.r(),n}}},t:function(){this.h=this.f,this.i=this.g,this.b.tagOpen&&this.b.tagOpen()},n:{beforeData:function(){"<"===this.q()?(this.d="tagOpen",this.t(),this.r()):(this.d="data",this.b.u())},data:function(){var e=this.q();"<"===e?(this.b.p(),this.d="tagOpen",this.t(),this.r()):"&"===e?(this.r(),this.b.v(this.s()||"&")):(this.r(),this.b.v(e))},tagOpen:function(){var e=this.r();"!"===e?this.d="markupDeclaration":"/"===e?this.d="endTagOpen":i(e)&&(this.d="tagName",this.b.w(),this.b.x(e.toLowerCase()))},markupDeclaration:function(){"-"===this.r()&&"-"===this.input.charAt(this.e)&&(this.r(),this.d="commentStart",this.b.y())},commentStart:function(){var e=this.r();"-"===e?this.d="commentStartDash":">"===e?(this.b.z(),this.d="beforeData"):(this.b.A(e),this.d="comment")},commentStartDash:function(){var e=this.r();"-"===e?this.d="commentEnd":">"===e?(this.b.z(),this.d="beforeData"):(this.b.A("-"),this.d="comment")},comment:function(){var e=this.r();"-"===e?this.d="commentEndDash":this.b.A(e)},commentEndDash:function(){var e=this.r();"-"===e?this.d="commentEnd":(this.b.A("-"+e),this.d="comment")},commentEnd:function(){var e=this.r();">"===e?(this.b.z(),this.d="beforeData"):(this.b.A("--"+e),this.d="comment")},tagName:function(){var e=this.r();n(e)?this.d="beforeAttributeName":"/"===e?this.d="selfClosingStartTag":">"===e?(this.b.B(),this.d="beforeData"):this.b.x(e)},beforeAttributeName:function(){var e=this.q();return n(e)?void this.r():void("/"===e?(this.d="selfClosingStartTag",this.r()):">"===e?(this.r(),this.b.B(),this.d="beforeData"):(this.d="attributeName",this.b.C(),this.r(),this.b.D(e)))},attributeName:function(){var e=this.q();n(e)?(this.d="afterAttributeName",this.r()):"/"===e?(this.b.F(!1),this.b.G(),this.r(),this.d="selfClosingStartTag"):"="===e?(this.d="beforeAttributeValue",this.r()):">"===e?(this.b.F(!1),this.b.G(),this.r(),this.b.B(),this.d="beforeData"):(this.r(),this.b.D(e))},afterAttributeName:function(){var e=this.q();return n(e)?void this.r():void("/"===e?(this.b.F(!1),this.b.G(),this.r(),this.d="selfClosingStartTag"):"="===e?(this.r(),this.d="beforeAttributeValue"):">"===e?(this.b.F(!1),this.b.G(),this.r(),this.b.B(),this.d="beforeData"):(this.b.F(!1),this.b.G(),this.r(),this.d="attributeName",this.b.C(),this.b.D(e)))},beforeAttributeValue:function(){var e=this.q();n(e)?this.r():'"'===e?(this.d="attributeValueDoubleQuoted",this.b.F(!0),this.r()):"'"===e?(this.d="attributeValueSingleQuoted",this.b.F(!0),this.r()):">"===e?(this.b.F(!1),this.b.G(),this.r(),this.b.B(),this.d="beforeData"):(this.d="attributeValueUnquoted",this.b.F(!1),this.r(),this.b.H(e))},attributeValueDoubleQuoted:function(){var e=this.r();'"'===e?(this.b.G(),this.d="afterAttributeValueQuoted"):"&"===e?this.b.H(this.s('"')||"&"):this.b.H(e)},attributeValueSingleQuoted:function(){var e=this.r();"'"===e?(this.b.G(),this.d="afterAttributeValueQuoted"):"&"===e?this.b.H(this.s("'")||"&"):this.b.H(e)},attributeValueUnquoted:function(){var e=this.q();n(e)?(this.b.G(),this.r(),this.d="beforeAttributeName"):"&"===e?(this.r(),this.b.H(this.s(">")||"&")):">"===e?(this.b.G(),this.r(),this.b.B(),this.d="beforeData"):(this.r(),this.b.H(e))},afterAttributeValueQuoted:function(){var e=this.q();n(e)?(this.r(),this.d="beforeAttributeName"):"/"===e?(this.r(),this.d="selfClosingStartTag"):">"===e?(this.r(),this.b.B(),this.d="beforeData"):this.d="beforeAttributeName"},selfClosingStartTag:function(){">"===this.q()?(this.r(),this.b.I(),this.b.B(),this.d="beforeData"):this.d="beforeAttributeName"},endTagOpen:function(){var e=this.r();i(e)&&(this.d="tagName",this.b.J(),this.b.x(e.toLowerCase()))}}},r.prototype={tokenize:function(e){return this.K=[],this.tokenizer.tokenize(e),this.K},tokenizePart:function(e){return this.K=[],this.tokenizer.tokenizePart(e),this.K},tokenizeEOF:function(){return this.K=[],this.tokenizer.tokenizeEOF(),this.K[0]},j:function(){this.k=null,this.startLine=1,this.startColumn=0},L:function(){this.options.M&&(this.k.M={start:{f:this.startLine,g:this.startColumn},N:{f:this.tokenizer.f,g:this.tokenizer.g}}),this.startLine=this.tokenizer.f,this.startColumn=this.tokenizer.g},u:function(){this.k={type:"Chars",chars:""},this.K.push(this.k)},v:function(e){this.k.chars+=e},p:function(){this.L()},y:function(){this.k={type:"Comment",chars:""},this.K.push(this.k)},A:function(e){this.k.chars+=e},z:function(){this.L()},w:function(){this.k={type:"StartTag",tagName:"",attributes:[],l:!1},this.K.push(this.k)},J:function(){this.k={type:"EndTag",tagName:""},this.K.push(this.k)},B:function(){this.L()},I:function(){this.k.l=!0},x:function(e){this.k.tagName+=e},C:function(){this._currentAttribute=["","",null],this.k.attributes.push(this._currentAttribute)},D:function(e){this._currentAttribute[0]+=e},F:function(e){this._currentAttribute[2]=e},H:function(e){this._currentAttribute[1]=this._currentAttribute[1]||"",this._currentAttribute[1]+=e},G:function(){}};var b={HTML5NamedCharRefs:d,EntityParser:t,EventedTokenizer:s,Tokenizer:r,tokenize:function(e,n){return new r(new t(d),n).tokenize(e)}},v=e.options,w=v.Options,y="StartTag",_="EndTag",k="Chars",I="Comment";return function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=b.tokenize(e),s=[],r=[];for(n=new w(n),t=0;t<i.length;t++){var l=i[t];if(l.type!==y)if(l.type===k){var d=o(l.chars,n);s.push.apply(s,d)}else s.push(l);else{s.push(l);var u=l.tagName.toUpperCase(),h="A"===u||v.contains(n.ignoreTags,u);if(!h)continue;var f=s.length;a(u,i,++t,s),t+=s.length-f-1}}for(t=0;t<s.length;t++){var m=s[t];switch(m.type){case y:var p="<"+m.tagName;if(m.attributes.length>0){var g=c(m.attributes);p+=" "+g.join(" ")}p+=">",r.push(p);break;case _:r.push("</"+m.tagName+">");break;case k:r.push(m.chars);break;case I:r.push("\x3c!--"+m.chars+"--\x3e")}}return r.join("")}}(linkify);e.linkifyHtml=n}(window),Ibles.package("Ibles.views"),Ibles.views.RedactorTextAreaView=Backbone.View.extend({initialize:function(e){_.bindAll(this,"redactorLoaded","sync"),e=e||{},this.enableHtml=e.enableHtml||!1,this.textArea=e.textArea||this.$(".redactor-textarea"),this.toolTip=e.tooltip||this.$(".redactor-tooltip"),this.redactorOptions=e.redactorOptions||{},this.addAirOptions(),this.enableHtml&&this.addHtmlOptions(),this.redactorLoadedCallback=e.redactorLoadedCallback,this.addRedactorAirMode()},addAirOptions:function(){this.redactorOptions=_.extend(this.redactorOptions,{air:!0,plugins:["instructables","instructablesAir"],airButtons:["bold","italic","heading","link_ibles","quote"],convertVideoLinks:!0,convertLinks:!0,buttonsCustom:{link_ibles:{title:"Link",callback:function(e){this.ibles_makeLink(e)}},heading:{title:"Heading",callback:function(e){this.ibles_makeheader(e)}},quote:{title:"Blockquote",func:"formatQuote"}}})},addHtmlOptions:function(){this.redactorOptions=_.extend(this.redactorOptions,{airButtons:["bold","italic","heading","link_ibles","quote","html"],convertDivs:!1,deniedTags:[],syncBeforeCallback:function(e){return!0===this.editedCode?this.get():e},textareaKeydownCallback:function(){this.editedCode=!0},keydownCallback:function(){this.editedCode=!1}})},addRedactorAirMode:function(){var e=this,t=Ibles.pageContext.commitInfo&&Ibles.pageContext.commitInfo.git_hash||"",n=_.map(["editor/desktop/dependencies/redactor916/redactor/redactor.css","editor/desktop/dependencies/redactorInstructables/airmode.css","editor/desktop/dependencies/redactor916/redactor/redactor.min.js","js/RedactorAirPlugin.js"],(function(e){return`${Ibles.pageContext.staticRoot}${e}?cb=${t}`}));head.load(n,(function(){e.textArea.redactor(e.redactorOptions||{}),e.redactorLoaded()}))},redactorLoaded:function(){this.trigger("redactorLoaded"),"function"==typeof this.redactorLoadedCallback&&this.redactorLoadedCallback()},sync:function(){return this.textArea.redactor("sync"),this.textArea.redactor("get")},hideToolTip:function(){this.toolTip.tooltip("hide"),this.$(".redactor_redactor-textarea").off("click")},reset:function(){this.$(".redactor_editor").empty(),this.textArea.val("")}}),Ibles.package("Ibles.views"),Ibles.views.ScrollableCardsView=Backbone.View.fullExtend({events:{"click .left-control":"scrollBack","click .right-control":"scrollForward"},initialize:function(){_.bindAll(this,"scroll"),this.$scrollable=this.$(".scrollable-cards-inner"),this.$scrollable.scroll(_.debounce(this.scroll,250))},scrollBack:function(e){if(e.preventDefault(),$(e.currentTarget).hasClass("active")){var t=this.$(".carousel-items").scrollLeft();this.$scrollable.animate({scrollLeft:t-this.$scrollable.width()},800)}},scrollForward:function(e){if(e.preventDefault(),$(e.currentTarget).hasClass("active")){var t=this.$scrollable.scrollLeft();this.$scrollable.animate({scrollLeft:t+this.$scrollable.width()},800)}},scroll:function(){var e=this.$scrollable,t=this.$(".right-control"),n=this.$(".left-control"),i=e.children(".scrollable-card").last(),s=e.width();e.scrollLeft()>0?n.addClass("active"):n.removeClass("active"),i.position().left+i.width()<=s?t.removeClass("active"):t.addClass("active")}}),Ibles.package("Ibles.models"),Ibles.models.CommentModel=Backbone.Model.extend({defaults:function(){return{id:null,instructableId:null,topicId:null,author:Ibles.session.get("screenName"),authorId:Ibles.session.get("id"),authorUrl:null,avatar:Ibles.session.getAvatarUrl(),avatarDownload:null,files:[],fileSet:new Ibles.collections.FileCollection,IMadeIt:!1,inReplyTo:null,replyAuthor:null,quarantine:!1,limbo:!1,status:null,commentable:null,commentableId:null,body:"",stepId:null,stepAnchorId:null,stepIndexLabel:null,designations:[],voted:!1,rating:0,sticky:!1,visible:!0,lastVisibleInThread:!1,indexInReplyThread:null,numRepliesFromMe:null}},designations:["tip","topic","review","answer","bestAnswer","comment","question"],initialize:function(){_.bindAll(this,"onSaveError","onSaveSuccess","onEditSuccess","onDeleteSuccess"),_.isUndefined(this.get("publishDate"))||this.set({commentTime:dayjs(Ibles.addServerTimeZone(this.get("publishDate"))).fromNow()}),_.isEmpty(this.get("authorUrl"))&&this.set({authorUrl:Ibles.reverseUrls.memberUrl(this.get("author"))}),_.isEmpty(this.get("files"))||this.get("fileSet").add(this.get("files")),"DELETED"===this.get("status")&&this.setDeletedBody(),window.linkify&&(window.linkify.options.defaults.className=null),this.listenTo(this,"change:body",(function(){this.set({body:linkifyHtml(this.get("body"))},{silent:!0})})),this.listenTo(this,"change:designations",(function(){this.updateDesignatedProps()})),this.updateDesignatedProps()},updateDesignatedProps:function(){this.set({designatedQuestion:this.isQuestion(),designatedTip:this.isTip(),designatedAnswer:this.isAnswer(),designatedBestAnswer:this.isBestAnswer(),designatedComment:this.isDesignatedComment()})},isReply:function(){return!!this.get("inReplyTo")},isVisible:function(){return this.get("visible")},hasDesignation:function(){return!_.isEmpty(this.get("designations"))},hasChildren:function(){var e=this,t=e.collection,n=t&&t.at(t.indexOf(e)+1);return n&&n.get("inReplyTo")==e.get("id")},isDesignated:function(e){return _.contains(this.get("designations"),e)},isQuestion:function(){return this.isDesignated("question")},isAnswer:function(){return this.isDesignated("answer")},isBestAnswer:function(){return this.isDesignated("bestAnswer")},isTip:function(){return this.isDesignated("tip")},isDesignatedComment:function(){return this.isDesignated("comment")},isIMadeIt:function(){return this.get("IMadeIt")},voted:function(){return!!this.get("voted")},votes:function(){return this.get("rating")},votableByCurrentUser:function(){var e=Ibles.session,t=e.get("screenName"),n=this.get("author");return e.authenticated()&&t!=n},currentUserIsOwner:function(){return this.currentUserIsAuthor()},currentUserIsAuthor:function(){var e=Ibles.session,t=e.get("screenName"),n=this.get("author");return e.authenticated()&&t==n},authorIsProjectOwner:function(e){var t=e.get("author");return _.isObject(t)&&(t=t.screenName),this.get("author")===t},getAuthorAvatarUrl:function(){var e=this.get("avatarDownload");return e?Ibles.fileFromOriginalUrl(e,{isUserFile:!0}).getTinyUrl():Ibles.session.getAvatarUrl()},setDesignations:function(e,t){var n={commentId:this.get("id"),designations:e},i=this;return t&&(n.threadDesignations=t),Ibles.API.jsonPostRequest("setDesignations",n).done((function(){i.set({designations:e})}))},setDeletedBody:function(){this.set({body:Ibles.T("(removed by author or community request)")})},setReplyAuthor:function(){var e=this,t=e.collection;if(t&&!_.isUndefined(e.get("inReplyTo"))&&_.isNull(e.get("replyAuthor"))){var n=t.get(e.get("inReplyTo"));_.isEmpty(n)||e.set({replyAuthor:n.get("author")})}},getImagesParam:function(){var e=this.get("fileSet"),t=[];return e.isEmpty()||(t=_.isFunction(e.idArray)?e.idArray():e.map((function(e){return{id:e.get("id")}}))),t},editRequest:function(){var e=this,t={id:e.get("id"),body:e.get("body"),images:e.getImagesParam()};return Ibles.API.jsonPostRequest("editComment",t,{success:e.onEditSuccess,error:e.onSaveError})},onEditSuccess:function(){var e=this;e.trigger("change"),e.trigger("comment.postSuccess",e)},save:function(){var e=this,t=_.omit(_.pick(e.toJSON(),"instructableId","topicId","author","IMadeIt","body","inReplyTo","stepId","designations"),_.isNull);return t.images=e.getImagesParam(),Ibles.API.jsonPostRequest("addComment",t,{success:e.onSaveSuccess,error:e.onSaveError},"id")},onSaveSuccess:function(e){var t=this,n=t.collection;if(t.set({id:e.id,commentTime:"a few seconds ago",publishDate:dayjs().fromNow()}),t.trigger("comment.postSuccess",t),_.isUndefined(t.get("inReplyTo")))n.add(t,{at:0});else{var i=n.indexOf(n.findWhere({id:t.get("inReplyTo")}));n.add(t,{at:i+1}),n.dirtyTree=!0}},onSaveError:function(e){var t;if(e&&e.responseJSON&&(e=e.responseJSON),e&&e.validationErrors){var n=Object.keys(e.validationErrors);t=n.length>1?Ibles.text.errors.incompleteFormError:e.validationErrors[n[0]]}else t=Ibles.extractErrorMessage(e,Ibles.text.errors.somethingWentWrong);this.trigger("comment.postError",t)},toggleVote:function(){var e=this,t={commentId:e.get("id")},n=e.get("voted");return t.value=n?0:1,Ibles.API.jsonPostRequest("addRating",t,{success:function(){var t=e.get("rating");n=!n,e.set({voted:n,rating:n?++t:--t})}})},toggleBestAnswer:function(){var e=this,t=e.isBestAnswer()?["answer"]:["answer","bestAnswer"];return Ibles.API.jsonPostRequest("setDesignations",{commentId:e.get("id"),designations:t}).done((function(){e.set({designations:t})}))},deleteComment:function(){return Ibles.API.postRequest("deleteComment",{id:this.get("id")},{success:this.onDeleteSuccess})},onDeleteSuccess:function(){var e=this;e.collection.getChildrenArray(e).length>0?e.setDeletedBody():e.collection.remove(e)},deleteThread:function(){var e=this;return Ibles.API.postRequest("deleteThread",{id:this.get("id")},{success:function(){e.collection.deleteThread(e)}})},setIMadeIt:function(e){var t={id:this.get("id"),value:e};return $.ajax({url:"/json-api/setIMadeIt",dataType:"json",type:"POST",data:t})},flagComment:function(e){var t={id:this.get("id"),flag:e};return Ibles.API.postRequest("setFlag",t)},limbo:function(){var e=this;return Ibles.API.jsonPostRequest("adminComment",{id:this.get("id"),status:"LIMBO"}).done((function(){e.set({limbo:!0,quarantined:!1,status:"LIMBO"})}))},quarantine:function(){var e=this;return Ibles.API.jsonPostRequest("adminComment",{id:this.get("id"),status:"QUARANTINED"}).done((function(){e.set({quarantine:!0,limbo:!1,status:"QUARANTINED"})}))},publish:function(){var e=this;return Ibles.API.jsonPostRequest("adminComment",{id:this.get("id"),status:"PUBLISHED"}).done((function(){e.set({limbo:!1,quarantine:!1,status:"PUBLISHED"})}))},toggleStickyComment:function(e){var t=this;return Ibles.API.jsonPostRequest("adminComment",{id:this.get("id"),sticky:e}).done((function(){t.set({sticky:e})}))},toggleApproval:function(e){var t=this;return Ibles.API.jsonPostRequest("adminComment",{id:this.get("id"),approved:e}).done((function(){t.set({approved:e})}))},cloneWithoutUserSuppliedData:function(){var e=this.clone();return e.set({id:null,fileSet:new Ibles.collections.FileCollection,IMadeIt:!1,body:""}),e},toJSON:function(){var e=this;return _.extend(_.clone(e.attributes),{isTip:e.isTip(),isQuestion:e.isQuestion(),isAnswer:e.isAnswer(),isBestAnswer:e.isBestAnswer(),isReply:e.isReply(),avatar:e.getAuthorAvatarUrl()})}}),function(e){e.package("Ibles.collections"),e.collections.CommentCollection=Backbone.Collection.extend({model:e.models.CommentModel,dirtyTree:!1,apiEndPoint:"getComments",defaultFetchParams:{offset:0,limit:50,sort:"RECENT"},fetchOptions:["limit","offset","sort","instructableId","topicId","commentId","designation","IMadeIt","includeQuarantine"],additionOptions:["modelOptions","ratingOptions","numVisibleReplies","fetchRatings"],initialize:function(t,n){var i=n||{},s=this.fetchOptions;this.options=_.pick(i,s.concat(this.additionOptions)),this.fetchParams=_.extend(_.clone(this.defaultFetchParams),_.omit(_.pick(i,s,_.isUndefined))),this.modelProps=_.pick(i,i.modelOptions),i.fetchRatings&&e.session.isEmailVerified()&&(this.userRatingsPromise=this.fetchUserRatings())},deleteThread:function(e){var t=this.getChildrenArray(e),n=this.getParents(e);this.remove(t),this.remove(e),this.remove(n)},getLastThreadInfo:function(){var e=this,t=e.length,n=e.reloadingTree||!t,i=n?-1:_.findLastIndex(e.models,(function(e){return!e.get("inReplyTo")})),s=-1!==(s=n?-1:_.findLastIndex(e.models.slice(i),(function(e){return e.get("lastVisibleInThread")})))?s+i:-1;return{lastComment:n?null:e.models[t-1],lastVisibleInThread:s>=0?e.at(s):null,repliesCount:n||-1===i?0:t-i-1}},parseComments:function(e){var t=this,n=t.options.numVisibleReplies,i=_.isNumber(n),s=i?t.getLastThreadInfo():{},r=s.lastVisibleInThread,o=s.lastComment,a=s.repliesCount,l=e.comments,c=t.userRatingsPromise;return l.forEach((function(e){_.extend(e,this.modelProps),_.isUndefined(e.author)&&(e.author=null,e.authorUrl="/"),c&&c.done((function(t){e.voted=!!t[e.id]})),i&&(_.extend(e,{visible:!0,lastVisibleInThread:!1}),e.inReplyTo?(a+=1)>n&&(e.visible=!1,o&&t.isVisible(o)&&(t.setLastVisibleInThread(o,a),r=o)):(r&&(t.setNumberOfRepliesFromComment(r,a),r=null),a=0)),o=e}),this),i&&r&&t.setNumberOfRepliesFromComment(r,a),l},isVisible:function(e){return e.visible||e.cid&&e.get("visible")},setLastVisibleInThread:function(e,t){var n=t-1;e.cid?e.set({lastVisibleInThread:!0,indexInReplyThread:n},{silent:!0}):(e.lastVisibleInThread=!0,e.indexInReplyThread=n)},setNumberOfRepliesFromComment:function(e,t){var n;e.cid?(n=e.get("inReplyTo")?t-1-e.get("indexInReplyThread"):t,e.set({numRepliesFromMe:n})):(n=e.inReplyTo?t-1-e.indexInReplyThread:t,e.numRepliesFromMe=n)},fetch:function(e){var t=this;return this.dirtyTree?this.reloadCommentTree():this.fetchRequest(_.extend({offset:this.fetchParams.offset+this.length},e),(function(e){t.add(e),e.length<t.fetchParams.limit&&t.trigger("noMoreComments")}))},fetchRequest:function(t,n){var i=this,s=i.fetchParams,r=i.userRatingsPromise,o=i.apiEndPoint,a=function(){return e.API.getRequest(o,_.extend({},s,t),{success:function(e){n(i.parseComments(e))}})};return r?r.then(a):a()},reloadCommentTree:function(){var e=this,t=this.length+this.fetchParams.limit;return this.reloadingTree=!0,this.dirtyTree=!1,this.fetchRequest({offset:0,limit:t},(function(n){e.reset(n),n.length<t&&e.trigger("noMoreComments"),e.reloadingTree=!1}))},getParents:function(e){var t=this,n=[],i=function(e){var s=e.get("inReplyTo");if(_.isUndefined(s))return n;n.push(s),_.isUndefined(t.get(s))||i(t.get(s))};return i(e)},getChildrenArray:function(e){var t=this,n=[],i=function(e){var s=t.where({inReplyTo:e.get("id")});s.length>0&&(n=n.concat(_.pluck(s,"id")),_.each(s,i))};return i(e),n},getRatingsParams:function(){var t=this.options;return _.extend({screenName:e.session.get("screenName")},_.pick(t,t.ratingOptions))},fetchUserRatings:function(){var t,n,i,s=e.commentRatingsPromises,r=this.getRatingsParams();return _.isUndefined(s)&&(e.commentRatingsPromises=s={}),i=s[n=_.flatten(_.pairs(r)).join("-")],_.isEmpty(i)?(t=$.Deferred(),e.API.getRequest("getRatings",r).then((function(e){var n={};_.each(e.ratings,(function(e){n[e.id]=!0})),t.resolve(n)})),s[n]=t.promise()):i}})}(Ibles),function(e,t,n){n.package("Ibles.views"),n.views.BaseCommentView=Backbone.View.extend({photosSelector:".js-photos",attachmentsSelector:".js-attachments",bodySelector:".js-body",htmlPreRendered:!1,showPhotos:!0,showAttachments:!0,upvotingEnabled:!0,replyEnabled:!0,lazyImage:!0,manager:null,imageTemplate:null,fileTemplate:_.template(n.JST["comment-attached-file"]),template:_.template(n.JST["comment-item"]),showRepliesTemplate:_.template(n.JST["comment-hidden-replies-toggler"]),authorOptsTemplate:_.template(n.JST["comment-author-opts"]),events:{"click .js-reply":"onClickReply","click .js-reply-parent":"scrollToParent","click .js-vote-btn, .js-vote-count":"toggleVote","click .js-show-replies":"showRemainingRepliesInThread","click .js-toggle-best-answer":"toggleBestAnswer","click .js-del-comment":"deleteComment","click .js-del-thread":"deleteThread"},initialize:function(e){var t=this;_.extend(t,_.pick(e,["manager","htmlPreRendered","showPhotos","showAttachments","upvotingEnabled","replyEnabled","lazyImage"])),!t.model&&t.htmlPreRendered&&(t.model=t.makeCommentModelFromEl(),t.collection.add(t.model)),t.listenTo(t.model,"change:numRepliesFromMe",t.updateNumRepliesFromMe),t.listenTo(t.model,"change:visible",t.toggleVisibility),t.listenTo(t.model,"remove",t.remove)},makeCommentModelFromEl:function(){var e=this,t=e.$el,i=e.manager,s=t.data(),r=t.find(".js-show-replies"),o=!!r.length,a=o?r.data("num-hidden"):null;return new n.models.CommentModel({id:s.id,stepId:s.stepid,inReplyTo:s.inreplyto,body:t.find(".text").text(),author:t.find(".user").text(),authorId:s.authorid,approved:!!s.approved,visible:!t.hasClass("hide"),lastVisibleInThread:o,numRepliesFromMe:a,instructableId:i.model.get("id")},{collection:e.collection})},getTemplateContext:function(){var e=this,t=e.model,n=e.manager.additionalCommentContext;return _.extend(e.model.toJSON(),{upvotingEnabled:e.upvotingEnabled,replyEnabled:e.replyEnabled,lazyImage:e.lazyImage,hasChildren:t.hasChildren()},n?n(t):{})},afterFilesRendered:function(){},scrollToParent:function(e){e.preventDefault(),this.manager.scrollToComment(this.model.get("inReplyTo"))},toggleVisibility:function(){this.$el[this.model.get("visible")?"removeClass":"addClass"]("hide")},showRemainingRepliesInThread:function(){var e=this,t=e.model;e.$(".js-show-replies").hide(),e.manager.showRepliesStartingFromModel(this.model),t.set({lastVisibleInThread:!1},{silent:!0})},updateNumRepliesFromMe:function(){var e,t,n=this,i=n.showRepliesTemplate,s=n.model.get("numRepliesFromMe"),r=n.$(".js-show-replies"),o=i({replyCountlabel:n.getReplyCountLabel(s)});r.length?r.replaceWith(o):(e=[n.attachmentsSelector,n.photosSelector,n.bodySelector],_.find(e,(function(e){return!!(t=n.$(e)).length})),t.after(o))},getReplyCountLabel:function(e){return this.model.isQuestion()?`${e} answer${e>1?"s":""}`:`${e} ${e>1?"replies":"reply"}`},render:function(){var e=this,t=e.$el;if(e.model.setReplyAuthor(),!e.htmlPreRendered){var n=e.getTemplateContext();e.setElement(e.template(n)),t[0].parentNode&&t.replaceWith(e.$el)}return e.renderAuthorIndicator(),e.showVoting(),e.showBestAnswerToggle(),e.renderFiles(),this},renderFiles:function(){this.renderPhotos(),this.renderAttachments(),this.afterFilesRendered()},renderPhotos:function(){var e=this;if(e.showPhotos){var t=e.model,i=e.imageTemplate,s=e.$(e.photosSelector),r=t.get("fileSet").getImages();_.each(r,(function(r){s.append(i(_.extend(r.toJSON(),{commentId:t.get("id"),imageLink:r.getLargeAnimationUrl(),imageSrc:n.isMobile()?r.getSquareAnimationUrl():r.getSquare3AnimationUrl(),lazyImage:e.lazyImage})))}))}},renderAttachments:function(){var e=this;if(e.showAttachments){var t=e.model,n=e.fileTemplate,i=e.$(e.attachmentsSelector),s=t.get("fileSet").getAttachments();_.each(s,(function(e){i.append(n(_.extend(e.toJSON(),{commentId:t.get("id"),typeThumbnail:e.getTypeThumbnailUrl(),attachmentUrl:e.getDownloadUrl()})))}))}},renderAuthorIndicator:function(){var e=this,t=e.model,n=e.manager,i=e.$(".author"),s="owner";if(!i.hasClass(s)){var r=n.model.get("author");_.isObject(r)&&(r=r.screenName),t.get("author")===r&&i.addClass(s)}},onClickReply:function(e){e.preventDefault();var t=this;n.requireLogin((function(){t.renderReplyView($(e.target),t.createReplyPostingView(t.model))}),{sourcea:"comments:reply"})},createReplyPostingView:function(e){return this.manager.makeReplyPostingView(e)},renderReplyView:function(e,t,i){if(e.hide(),t.render(),this.$el.append(t.$el),i){var s,r,o=n.isMobile()?$(".modal.in"):$(".modal-container");o.length?(s=o,r=t.$el.offset().top-s.offset().top+s.scrollTop()):(s=$("html, body"),r=t.$el.offset().top),_.delay((function(){s.animate({scrollTop:r},1e3)}),250)}this.listenToOnce(t,"posted destroyed",(function(){e.show()}))},showVoting:function(){var e=this,t=e.model;t.currentUserIsAuthor()?e.$(".js-vote").addClass("hide"):t.votableByCurrentUser()&&t.voted()&&e.$(".js-vote-btn").text("Upvoted").addClass("voted")},toggleVote:function(){var e=this,t=e.model;n.requireEmailVerification((function(){t.votableByCurrentUser()&&t.toggleVote().done((function(){e.$(".js-vote-count").text(t.votes()).removeClass("hide"),e.$(".js-vote-btn").text(t.voted()?"Upvoted":"Upvote").toggleClass("voted")}))}),{sourcea:"upvote"})},showBestAnswerToggle:function(){(this.manager.model.currentUserIsOwner()||n.session.isAdmin())&&this.$(".js-toggle-best-answer").removeClass("hide")},toggleBestAnswer:function(){var e=this,t=e.model;t.toggleBestAnswer().done((function(){e.$(".js-toggle-best-answer").html(t.isBestAnswer()?"Undo Best Answer":"Select as Best Answer")}))},deleteComment:function(){new n.views.CommentDeletePrompt({model:this.model,title:"Delete Comment",deleteThread:!1}).render()},deleteThread:function(){new n.views.CommentDeletePrompt({model:this.model,title:"Delete Comment Thread",deleteThread:!0}).render()},destroy:function(){this.stopListening(),this.undelegateEvents(),this.$el.removeData().unbind(),this.manager=null,this.model=null,this.collection=null}})}(window,document,Ibles),function(e,t){t.package("Ibles.views"),t.views.CommentTypeSelector=Backbone.View.extend({template:_.template(t.JST["comment-posting-view"]),events:{"click .js-type-tip":"renderTipPoster","click .js-type-question":"renderQuestionPoster","click .js-type-comment":"renderCommentPoster"},initialize:function(e){_.extend(this,_.pick(e,["manager"]))},scrollToMe:function(){e.location="#discuss"},renderPoster:function(e){var n=this,i=n.manager,s=e.modelProps;t.requireLogin((function(){var r=new t.views.CommentPostingView({model:i.makeCommentModel(s||{})}),o=e.callback;n.$el.html(r.render().$el),n.listenToOnce(r,"posted destroyed",(function(){n.render()})),o&&o()}),{sourcea:"comments:selecttype"})},renderPosterForType:function(e){this.renderPoster({modelProps:{designations:[e]}})},renderTipPoster:function(){this.renderPosterForType("tip")},renderQuestionPoster:function(){this.renderPosterForType("question")},renderCommentPoster:function(){this.renderPosterForType("comment")},render:function(){var e=this;return e.$el.html(e.template({commentBody:"",submitLabel:"Post",isEdit:!1,isIMadeIt:!1,typeSelected:!1,isMobile:t.isMobile(),avatar:t.session.getAvatarUrl()})),e}})}(window,Ibles),function(e,t,n){n.package("Ibles.views"),n.views.CommentPostingView=Backbone.View.extend({template:_.template(n.JST["comment-posting-view"]),skipUploaderModal:!1,hideOnBlur:!0,recreateOnPost:!1,submitLabel:"",events:{"click .post-btn":"submitPost","click .add-image-btn":"addImages","click .cancel-btn":"onCancel"},initialize:function(e){var t=this;e=e||{},_.bindAll(t,"onSend"),_.extend(t,_.pick(e,["recreateOnPost","hideOnBlur","skipUploaderModal","isEdit"])),t.listenTo(t.model,"comment.postError",t.renderError),t.manager=e.manager,t.hideOnBlur&&setTimeout((function(){t.setupHideOnBlur()}),0)},setupHideOnBlur:function(){var e=`click.${_.uniqueId("outside")}`,n=$(t),i=this;n.on(e,(function(t){i.$(".js-body-input").val().length||0!=$(t.target).closest([".js-comment-poster",".discuss",".modal",".modal-backdrop",".dropdown-backdrop"].join(",")).length||(n.off(e),i.destroyAndRemove(),i.trigger("canceled"))}))},getTemplateContext:function(){var e=this.model,t=e.hasDesignation(),i=e.isIMadeIt();return _.extend(e.toJSON(),{commentBody:e.get("body"),submitLabel:this.submitLabel,isMobile:n.isMobile(),isIMadeIt:i,isEdit:!!this.isEdit,typeSelected:t||i})},render:function(){var e=this,t=e.getTemplateContext(),i=n.session.authenticated(),s=n.isMobile();(e.$el.html(e.template(t)),i&&e.createImageBucket(),!s&&i&&e.enableRedactorToolbar(),s)&&e.$(".js-body-input").on("change keyup keydown paste cut",(function(){$(this).height(0).height(this.scrollHeight)}));return e},renderError:function(e){this.$(".alert-error").text(e).show()},createImageBucket:function(){var e=this,t=e.model.get("fileSet"),i=e.$(".uploading-indicator");e.imageBucket=new n.views.ImageBucketView({el:e.$(".image-bucket"),collection:t,skipUploaderModal:e.skipUploaderModal,multiple:!0}),e.listenTo(e.imageBucket,"imagebucket:uploading imagebucket:uploadcomplete",(function(){i.toggle()}))},enableRedactorToolbar:function(){this.redactorView=new n.views.RedactorTextAreaView({el:this.$(".js-redactor-container"),redactorOptions:{focus:!0,plugins:["instructablesAir"],linebreaks:!0}})},validate:function(){var e=this,t=!0;return e.$(".js-body-input").val()&&!e.$(".redactor_placeholder").length||(e.renderError("Please type your comment before posting."),t=!1),e.model.get("IMadeIt")&&!e.imageBucket.collection.models.length&&(e.renderError("Please attach images to show what you made!"),t=!1),t},submitPost:function(){var e=this,t=e.model;n.requireLogin((function(){if(e.$(".alert-error").hide(),e.validate()){var i=e.$(".post-btn");i.prop("disabled",!0),t.set({body:e.$(".js-body-input").val().replace(/\n/g,"<br/>")}),t.set({fileSet:new n.collections.FileCollection(e.imageBucket.collection.models)}),e.sendRequest().done(e.onSend).always((function(){i.prop("disabled",!1)}))}}),{sourcea:"comments:post"})},sendRequest:function(){return this.model.save()},addImages:function(){var e=this;n.requireLogin((function(){e.imageBucket.addImages()}),{sourcea:"comments:addImages"})},onSend:function(){var e=this;if($(".redactor_air").hide(),e.recreateOnPost){var t=e.model,n=t.cloneWithoutUserSuppliedData();n.collection=t.collection,e.destroy(),new e.constructor({el:e.$el,recreateOnPost:!0,model:n}).render()}else e.destroyAndRemove();e.trigger("posted")},onCancel:function(){$(".redactor_air").hide(),this.destroyAndRemove(),this.trigger("canceled")},destroy:function(){var e=this;e.$(".js-body-input").off().val(""),e.stopListening(),e.undelegateEvents(),e.$el.removeData().unbind(),e.model=null,e.imageBucket&&(e.imageBucket.destroy(),e.imageBucket=null),e.redactorView&&e.redactorView.reset(),e.manager=null,e.trigger("destroyed")},destroyAndRemove:function(){this.destroy(),this.$el.remove()}})}(window,document,Ibles),function(e){e.package("Ibles.views"),e.views.CommentReplyPostingView=e.views.CommentPostingView.fullExtend({hideOnBlur:!1,submitLabel:"Reply"})}(Ibles),function(e){e.package("Ibles.views"),e.views.CommentEditView=e.views.CommentPostingView.fullExtend({submitLabel:"Save",sendRequest:function(){return this.model.editRequest()},getTemplateContext:function(){return _.extend(this._super(),{isEdit:!0,typeSelected:!0})}})}(Ibles),function(e,t,n){n.package("Ibles.views"),n.views.CommentsManager=Backbone.View.extend({listSelector:".js-comments",itemSelector:".js-comment",moreSelector:".js-more-comments",model:null,numCommentsToLoad:50,numVisibleReplies:0,fetchIMadeItsOnly:!1,saveIMadeItsOnly:!1,skipUploaderModal:!1,fetchRatings:!1,includeQuarantine:!1,events:{"click .js-more-comments":"addComments","click .js-show-poster":"renderPoster"},initialize:function(e){var t=this,i=n.session.authenticated();_.bindAll(t,"renderComment","renderAllComments","onCommentAdded","showCommentFromUrl"),_.extend(t,_.pick(e,["fetchIMadeItsOnly","saveIMadeItsOnly","skipUploaderModal","fetchRatings","numVisibleReplies","numCommentsToLoad","additionalCommentContext"])),t.setSubviewClasses(),t.setCommentModelClasses(),t.setCommentCollection(),i||t.createCommentViewsFromDOM();var s=t.collection;t.listenTo(s,"add",t.onCommentAdded),t.listenTo(s,"reset",t.onCommentsLoaded),t.listenToOnce(s,"noMoreComments",t.noMoreComments),this.shouldReloadCommentTree()?this.reloadCommentTree(t.showCommentFromUrl):t.showCommentFromUrl()},shouldReloadCommentTree:function(){return n.session.authenticated()},reloadCommentTree:function(e){this.collection&&this.collection.reloadCommentTree().done(e)},setSubviewClasses:function(){this.postingView=n.views.CommentPostingView,this.commentView=n.views.CommentView,this.editView=n.views.CommentEditView,this.replyPostingView=n.views.CommentReplyPostingView},createCommentViewsFromDOM:function(){var e=[],t=this;t.$(t.listSelector).children(t.itemSelector).each((function(){var n=$(this),i=t.makeCommentView({el:n,htmlPreRendered:!0});i.render(),e.push(i)})),t.commentItemViews=e},setCommentModelClasses:function(){this.commentModelClass=n.models.CommentModel,this.commentCollectionClass=n.collections.CommentCollection},setCommentCollection:function(){var e=this;e.collection||(e.collection=new this.commentCollectionClass([],_.extend({limit:e.numCommentsToLoad,numVisibleReplies:e.numVisibleReplies,IMadeIt:e.fetchIMadeItsOnly,fetchRatings:e.fetchRatings,includeQuarantine:e.includeQuarantine},e.getExtraCollectionProps())))},getExtraCollectionProps:function(){return{instructableId:this.model.get("id"),ratingOptions:["instructableId"],modelOptions:["instructableId"]}},makeCommentModel:function(e){var t=this;return new this.commentModelClass(_.extend({},{instructableId:t.model.get("id"),IMadeIt:t.saveIMadeItsOnly},e),{collection:t.collection})},makeCommentView:function(e){return new this.commentView(_.extend({},{collection:this.collection,manager:this},e))},makeReplyPostingModel:function(e){return this.makeCommentModel({inReplyTo:e.get("id"),replyAuthor:e.get("author"),designations:e.isQuestion()?["answer"]:["comment"]})},makeReplyPostingView:function(e){return new this.replyPostingView({skipUploaderModal:this.skipUploaderModal,model:this.makeReplyPostingModel(e)})},makeEditView:function(e){return new(this.editView||this.postingView)({model:e,manager:this,collection:this.collection,skipUploaderModal:this.skipUploaderModal,isEdit:!0})},addComments:function(){this.collection.fetch()},noMoreComments:function(){this.$(this.moreSelector).hide()},onCommentAdded:function(e,t){this.renderComment(e,t)},onCommentsLoaded:function(){this.renderAllComments()},renderComment:function(e){var t=this,i=t.makeCommentView({model:e}).render().$el,s=t.$(t.itemSelector),r=e.collection.indexOf(e),o=t.listSelector;if(0===r?t.$(o).prepend(i):r===s.length?t.$(o).append(i):s.eq(r).before(i),n.user&&n.user.admin){var a=i.find("h3");e.get("quarantine")?a.text("[QUARANTINED] "+a.text()):e.get("limbo")&&a.text("[LIMBO] "+a.text())}t.$el.removeClass("hide")},renderAllComments:function(){var e=this.$(this.listSelector);_.each(this.commentItemViews,(function(e){e.destroy()})),e.css({"min-height":e.outerHeight()}),e.empty(),this.collection.each(this.renderComment),e.css({"min-height":"initial"})},renderPoster:function(e){var t=this;e.preventDefault(),n.requireLogin((function(){var n=new t.postingView({model:t.makeCommentModel({designations:["comment"]}),skipUploaderModal:t.skipUploaderModal,manager:t}),i=n.render().$el.hide(),s=$(e.target);t.$el.append(i),i.show("slow"),s.attr("disabled",!0),t.listenToOnce(n,"posted destroyed",(function(){s.attr("disabled",!1)})),t.listenToOnce(n,"posted",(function(){var e=t.$el;e.removeClass("hide"),$("body,html").animate({scrollTop:e.offset().top},"slow")}))}),{sourcea:"comments:showPoster"})},getCommentIdFromUrl:function(){return e.location.hash.slice(1).replace("comment-","")||n.Q("commentId")},hasCommentId:function(e){return!!this.collection.get(e)},showAllComments:function(){this.$(".js-show-replies").click()},showCommentFromUrl:function(){var t=this,n=t.getCommentIdFromUrl();n&&t.hasCommentId(n)&&(t.showAllComments(),e.setTimeout((function(){t.scrollToComment(n)}),100))},scrollToComment:function(e){var i=e&&$('[data-id="'+e+'"]');if(i){var s=i.offset().top-$("#ible-header").outerHeight()-50,r="true"===n.Q("reply");$(t).scrollTop(s),r&&i.find(".js-reply").click()}},showRepliesStartingFromModel:function(e){for(var t,n=this.collection,i=n.indexOf(e)+1,s=n.length-1,r=n.models;i<=s&&(t=r[i]).isReply();i++)t.set("visible","true")}})}(window,document,Ibles),function(e){e.package("Ibles.views"),e.views.CommentDeletePrompt=e.views.BaseModalView.fullExtend({events:{"click .delete-btn":"deleteComment"},initialize:function(e){this._super(_.extend({wrapContent:!0,modalClass:"delete-prompt"},e))},getTemplate:function(){return _.template(e.JST["comment-delete-prompt"])},deleteComment:function(e){e.preventDefault(),$(e.currentTarget).html($("<span class='spinner'></span>")[0]).addClass("disabled"),this.showDeleteAction(this.options.deleteThread?this.model.deleteThread():this.model.deleteComment())},showDeleteAction:function(e){var t=this;e.then((function(){t.dismiss()})).fail((function(){t.$(".cancel-btn").remove(),t.$(".delete-btn").remove(),t.$(".alert-error").removeClass("hide")}))}})}(Ibles),Ibles.package("Ibles.views"),Ibles.views.CommentRepliesManager=Ibles.views.CommentsManager.fullExtend({model:null,collection:null,initialize:function(e){this._super(e),this.comment=e.comment},shouldReloadCommentTree:function(){return!0},onCommentsLoaded:function(){this.hydratePrimaryCommentModel(),this.renderAllComments()},makeCommentView:function(e){return this._super(_.extend({lazyImage:!1},e))},hydratePrimaryCommentModel:function(){var e=this.comment,t=e.get("id"),n=this.collection.get(t);n&&e.set(n.attributes,{silent:!0})},renderAllComments:function(){var e=this,t=e.collection;t.each((function(n){e.renderComment(n,t)}))}}),Ibles.package("Ibles.views"),Ibles.views.CommentModal=Ibles.views.BaseModalView.fullExtend({template:_.template(Ibles.JST["comment-modal"]),model:null,modalEventNamespace:"CommentModal",browserScrollable:!0,events:{"click .js-next":"nextComment","click .js-prev":"previousComment"},initialize:function(e){this._super(e),this.repliesCollection=this.createRepliesCollection(),this.repliesView=this.createRepliesView(),this.listenTo(this.repliesCollection,"reset",this.renderComponents)},createRepliesCollection:function(){return new Ibles.collections.CommentCollection([],{commentId:this.model.get("id"),instructableId:this.options.instructableModel.get("id")})},createRepliesView:function(){var e=this;return new Ibles.views.CommentRepliesManager({el:this.$(".js-replies"),model:e.options.instructableModel,comment:e.model,collection:e.repliesCollection,skipUploaderModal:!0})},nextComment:function(){var e=this.model,t=e.collection,n=t.indexOf(e),i=n===t.length-1?0:n+1;Ibles.Events.trigger(`${this.modalEventNamespace}:next`,i)},previousComment:function(){var e=this.model,t=e.collection,n=t.indexOf(e),i=0===n?t.length-1:n-1;Ibles.Events.trigger(`${this.modalEventNamespace}:prev`,i)},getTemplateContext:function(){var e=this.model;return _.extend(this._super(),e.toJSON(),{hideNavigation:1===e.collection.length})},modalHidden:function(){this.model=null,this.repliesCollection=null,this.repliesView=null},renderComponents:function(){this.renderPrimaryComment(),this.model.get("fileSet").hasImages()&&this.renderCommentGallery()},renderPrimaryComment:function(){this.repliesView.makeCommentView({model:this.model,el:this.$(".js-primary-comment"),showPhotos:!1,lazyImage:!1}).render()},renderCommentGallery:function(){var e=_.template(Ibles.JST["comment-modal-gallery"]),t=Ibles.isMobile()?175:450,n=this.$(".modal-body").width(),i=this.model.get("fileSet").getImages(),s=this.galleryWillScroll(i,n,t);this.$(".js-gallery").append(e({galleryHeight:s?t:void 0,imageFiles:i,willScroll:s})),new Ibles.views.ScrollableCardsView({el:this.$(".js-gallery").children().first()})},galleryWillScroll:function(e,t,n){var i,s=e&&e.length>1,r=n;return s&&(i=_.reduce(e,(function(e,t){return e+r*(t.get("width")/t.get("height"))}),0)),s&&i>t}}),Ibles.JST["mobile-comment-image"]='<div class="comment-image js-comment-image" data-id="<< id >>">\n    <img class="lazyload" src="<< Ibles.staticUrl(\'img/pixel.png\') >>" data-src="<< imageSrc >>"/>\n</div>\n',Ibles.package("Ibles.views"),Ibles.views.FileUploader=Backbone.View.extend({defaults:{multiple:!1,uploadField:null,validFileTypes:[],singleFileUploads:!0,sequentialUploads:!0,autoUpload:!0,replaceFileInput:!1,imageOrientation:!0,disableImageResize:!1,imageMaxWidth:null,imageMaxHeight:null,imageMinWidth:null,imageMinHeight:null},initialize:function(e){this.options=_.extend(this.defaults,e||{}),this.enableUploader()},showUploader:function(){this.uploadField.click()},isValidFiles:function(e,t){return _.every(e,(function(e){var n=e.name.split(".").pop().toLowerCase();return _.contains(t,n)}))},getUploadField:function(){var e=this.options;return e.uploadField?e.uploadField:e.multiple?$('<input type="file" name="files[]" multiple>'):$('<input type="file" name="files[]">')},enableUploader:function(){var e=this,t=this.options,n=0;Ibles.loadJsBundle("ible_uploader_js",(function(){e.uploadField=e.getUploadField(),e.uploadWidget=e.uploadField.fileupload(_.extend({url:Ibles.Settings.uploadUrl()},t)).on("fileuploadchange",(function(n,i){if(!_.isEmpty(t.validFileTypes)&&!e.isValidFiles(i.files,t.validFileTypes))return e.trigger("upload:invalid",i),!1})).on("fileuploadprocessfail",(function(t,n){e.trigger("upload:error",n)})).on("fileuploaddone",(function(t,n){var i=n.result;$.isArray(i.loaded)?e.trigger("upload:success",i.loaded[0]):e.trigger("upload:error",n)})).on("fileuploadsubmit",(function(t,n){e.trigger("upload:start",n)})).on("fileuploadalways",(function(t,i){n++,i.originalFiles.length===n&&e.trigger("upload:complete")})).on("fileuploadfail",(function(t,n){e.trigger("upload:error",n)}))}))}}),function(e){e.package("Ibles.views"),e.views.CommentView=e.views.BaseCommentView.fullExtend({imageTemplate:_.template(e.JST["mobile-comment-image"]),initialize:function(e){this._super(e)},render:function(){var e=this,t=e.model,n=e.manager,i=t.currentUserIsAuthor();return e._super(),t.get("author")===n.model.get("author")&&e.$(".author-link").append(" (author)"),i&&e.$(".posted-by").after(e.authorOptsTemplate(e.getTemplateContext())),e},afterFilesRendered:function(){var t=this.model.get("fileSet").map((function(e){return{id:e.get("id"),imageUrl:e.getLargeUrl()}}));t.length&&new e.views.MobileLightboxTouchLoader({elements:this.$(".js-comment-image"),navbarPosition:"top",imageSet:t})},destroy:function(){this.stopListening(),this.undelegateEvents(),this.$el.removeData().unbind(),this.manager=null,this.model=null,this.collection=null}}),e.views.MobileCommentView=e.views.CommentView}(Ibles),Ibles.JST["imadeit-item"]='<li data-id="<< id >>" class="imadeit js-comment <[ if (typeof hidden != \'undefined\' && hidden) {]>hide<[}]>">\n    <[ if (fileSet.models.length && fileSet.models[0].isImage()) { ]>\n        <img class="lazyload" src="<< Ibles.staticUrl(\'img/pixel.png\') >>" data-src="<< fileSet.models[0].getSquare3AnimationUrl() >>">\n    <[ } else if (fileSet.models.length && fileSet.models[0].isVideo()) { ]>\n        <img src="<< Ibles.staticUrl(\'img/placeholder-video.png\') >>" />\n    <[ } else { ]>\n        <img src="<< Ibles.staticUrl(\'img/placeholder-file.png\') >>" />\n    <[ } ]>\n    <h3 class="made-by"><a class="user" href="<< Ibles.reverseUrls.memberUrl(author) >>"><< author >></a> made it!</h3>\n</li>\n',Ibles.JST["imadeit-seemore"]='<li class="see-more">\n    <div class="see-more-inner">\n        <p>See << hiddenCount >> more that made it</p>\n    </div>\n</li>',Ibles.package("Ibles.views"),Ibles.views.ImadeItsManager=Ibles.views.CommentsManager.fullExtend({fetchIMadeItsOnly:!0,saveIMadeItsOnly:!0,includeQuarantine:!0,events:{"click .see-more":"showHiddenItems"},initialize:function(e){this._super(e),this.listenTo(Ibles.Events,"iMadeItModal:next iMadeItModal:prev",this.onImadeItModalNav)},setSubviewClasses:function(){this._super(),this.commentView=Ibles.views.ImadeItItemView},setCommentModelClasses:function(){this.commentModelClass=Ibles.models.CommentModel,this.commentCollectionClass=Ibles.collections.ImadeItCollection},onCommentsLoaded:function(){this.filterQuarantineModels(),this.setHiddenModels(),this.renderAllComments(),this.renderSeeMoreToggler()},onImadeItModalNav:function(e){new Ibles.views.ImadeItModal({model:this.collection.at(e),instructableModel:this.model}).render()},renderSeeMoreToggler:function(){var e,t=this.getHiddenCount();t>0&&(e=_.template(Ibles.JST["imadeit-seemore"]),this.$(this.listSelector).append(e({hiddenCount:t})))},showHiddenItems:function(){var e=this;Ibles.requireLogin((function(){e.$(".see-more").hide(),e.$("li.hide").removeClass("hide")}),{sourcea:"imadeitSeeMore"})},showAllComments:function(){this.showHiddenItems()},getHiddenCount:function(){var e=this.collection.length,t=0;return e>9?t=e-9:e>4&&9!=e&&(t=e-4),t},filterQuarantineModels:function(){this.collection.models=this.collection.models.reduce((function(e,t){return t.get("quarantine")||t.get("limbo")?(Ibles.user.admin||Ibles.user.screenName===t.get("author"))&&e.push(t):e.push(t),e}),[])},setHiddenModels:function(){var e=this.collection,t=e.length-this.getHiddenCount();e.each((function(e,n){e.set("hidden",n>=t)}))}}),Ibles.package("Ibles.views"),Ibles.views.ImadeItItemView=Ibles.views.CommentView.fullExtend({template:_.template(Ibles.JST["imadeit-item"]),events:{click:"renderModal"},makeCommentModelFromEl:function(){var e=this.$el,t=(e.find("img").attr("src")||"").split("?")[0];return this.manager.makeCommentModel({id:e.data().id,author:e.find(".user").text(),files:[{originalUrl:t}]})},renderModal:function(){new Ibles.views.ImadeItModal({model:this.model,instructableModel:this.manager.model}).render()},onEditViewPosted:function(){this.manager.reloadCommentTree()}}),Ibles.package("Ibles.collections"),Ibles.collections.ImadeItCollection=Ibles.collections.CommentCollection.extend({apiEndPoint:"searchComments",getExtraCollectionProps:function(){return _.extend(this.super(),{IMadeIt:!0})}}),Ibles.package("Ibles.views"),Ibles.views.ImadeItModal=Ibles.views.CommentModal.fullExtend({modalClass:"imadeit-modal",modalEventNamespace:"iMadeItModal"}),Ibles.JST["sticky-header-mobile"]='<div class="sticky-header" data-location="stickyNavMobile">\n    <span class="ible-actions">\n        <[ if (type == "Step by Step") {]>\n        <span class="left">\n            <button class="imadeit-btn"><i class="icon icon-imadeit"></i><span class="imadeit-txt">I Made It</span></button>\n        </span>\n        <[ } ]>\n        <span class="right">\n            <button class="favorite-btn"><i class="svg-icon svg-favorite"></i><span class="favorite-txt">Favorite</span></button>\n            <[ if (type == "Step by Step") {]>\n            <button class="view-comments-btn"><a href="#discuss"><i class="svg-icon svg-comments"></i><span class="sr-only">View Comments</span></a></button>\n            <[ } ]>\n            <button class="share-menu-btn"><i class="svg-icon svg-share"></i><span class="sr-only">Share</span></button>\n            <button class="more-menu-btn"><i class="svg-icon svg-ellipsis"></i><span class="sr-only">More Options</span></button>\n        </span>\n    </span>\n    <div class="dropdown share-menu">\n        <button class="btn btn-facebook fb-btn"><i class="svg-icon svg-facebook"></i> Facebook</button>\n        <button class="btn btn-twitter twit-btn"><i class="svg-icon svg-twitter"></i> Twitter</button>\n        <button class="btn btn-danger pin-btn"><i class="svg-icon svg-pinterest"></i> Pinterest</button>\n        <button class="btn google-classroom-btn"><i class="icon-google-classroom"></i> Google Classroom</button>\n    </div>\n    <div class="dropdown more-menu">\n        <button class="btn flag-menu-btn">Flag</button>\n        <ul class="flag-menu unstyled hide">\n            <li><a class="flag-btn" data-as="wrong-category">Wrong Category</a></li>\n            <li><a class="flag-btn" data-as="inappropriate">Inappropriate</a></li>\n            <li><a class="flag-btn" data-as="incomplete">Incomplete</a></li>\n            <li><a class="flag-btn" data-as="spam">Spam</a></li>\n            <div class="flag-confirmation hide">\n                <p>\n                    Are you sure you want to flag this instructable as <strong class="flag-confirmation-reason"></strong>?\n                </p>\n                <button class="btn btn-default btn-flag-cancel">Cancel</button>\n                <button class="btn btn-danger btn-flag-confirm">Confirm</button>\n            </div>\n        </ul>\n        <button class="btn edit-btn author-action">Edit</button>\n    </div>\n</div>\n',Ibles.views.StickyHeaderBase=Backbone.View.extend({template:null,initialize:function(){this.render(),this.setupScrollFix()},hide:function(){},render:function(){var e=this,t=e.model,n=t.author;e.$el.append(e.template({title:t.get("title"),screenName:n.get("screenName"),authorUrl:n.getUrl(),authorAvatar:n.getAvatarFile().getTinyUrl(),type:t.get("type")}))},setupScrollFix:function(){var e=this,t=e.$(".sticky-header"),n=e.$(".article-header"),i=n.offset().top+n.height();$(window).scroll(_.throttle((function(){$(window).scrollTop()>=i?(t.addClass("affix"),Ibles.Events.trigger("fixHeaderShown",{headerHeight:50})):(t.removeClass("affix"),e.$(".more-menu").hide(),Ibles.Events.trigger("fixHeaderHidden"))}),250))}}),Ibles.package("Ibles.views"),Ibles.views.StickyHeader=Ibles.views.StickyHeaderBase.fullExtend({template:_.template(Ibles.JST["sticky-header-mobile"]),events:{"click .flag-menu-btn":"toggleFlagMenu","click .flag-btn":"attemptFlag","click .edit-btn":"editBtnClicked","click .share-menu-btn":"toggleShareMenu","click .more-menu-btn":"toggleMoreMenu","click .btn-flag-confirm":"flag","click .btn-flag-cancel":"flagCancel"},initialize:function(){this.model.get("flagged")&&this.$(".flag-menu-btn").attr("disabled",!0).text("Flagged"),this.render(),this.setupScrollFix()},setupScrollFix:function(){var e=this.$(".sticky-header");Ibles.Events.on("mobileNavHidden",(function(){e.addClass("affix")})),Ibles.Events.on("mobileNavShown",(function(){e.removeClass("affix")}))},editBtnClicked:function(){window.location=this.model.getEditUrl()},toggleShareMenu:function(e){this.toggleDropdownMenu(e,$(".share-menu-btn"),$(".share-menu"))},toggleMoreMenu:function(e){this.toggleDropdownMenu(e,$(".more-menu-btn"),$(".more-menu"))},toggleDropdownMenu:function(e,t,n){n.is(":visible")?(n.hide(),$(document).off("click.outside-menu")):(n.show(),setTimeout((function(){$(document).on("click.outside-menu",(function(e){var i=$(e.target),s=i.is(t),r=!!i.closest(".dropdown").length;s||r||($(document).off("click.outside-menu"),n.hide())}))})))},toggleFlagMenu:function(){Ibles.requireLogin((function(){this.$(".flag-menu").toggleClass("hide")}),{sourcea:"flag"})},attemptFlag:function(e){e.preventDefault();var t=$(e.target);this.$(".flag-confirmation-reason").html(t.text()),this.$(".btn-flag-confirm").attr("data-reason",t.attr("data-as")),this.$(".flag-confirmation").removeClass("hide")},flag:function(e){var t=this.model,n=this.$(".btn-flag-confirm").attr("data-reason"),i=this.$(".flag-menu-btn");e.preventDefault(),t.set("flaggedAs",n),t.flagAction().success((function(){i.attr("disabled",!0).text("Flagged")})),this.toggleFlagMenu(),this.$(".flag-confirmation").addClass("hide")},flagCancel:function(e){e.preventDefault(),this.$(".flag-confirmation").addClass("hide"),this.toggleFlagMenu(),this.toggleDropdownMenu(e,$(".more-menu-btn"),$(".more-menu"))}}),
/*!

JSZip v3.7.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/master/LICENSE
*/
function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JSZip=e()}}((function(){return function e(t,n,i){function s(o,a){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(r)return r(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[o]={exports:{}};t[o][0].call(d.exports,(function(e){var n=t[o][1][e];return s(n||e)}),d,d.exports,e,t,n,i)}return n[o].exports}for(var r="function"==typeof require&&require,o=0;o<i.length;o++)s(i[o]);return s}({1:[function(e,t,n){"use strict";var i=e("./utils"),s=e("./support"),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(e){for(var t,n,s,o,a,l,c,d=[],u=0,h=e.length,f=h,m="string"!==i.getTypeOf(e);u<e.length;)f=h-u,m?(t=e[u++],n=u<h?e[u++]:0,s=u<h?e[u++]:0):(t=e.charCodeAt(u++),n=u<h?e.charCodeAt(u++):0,s=u<h?e.charCodeAt(u++):0),o=t>>2,a=(3&t)<<4|n>>4,l=f>1?(15&n)<<2|s>>6:64,c=f>2?63&s:64,d.push(r.charAt(o)+r.charAt(a)+r.charAt(l)+r.charAt(c));return d.join("")},n.decode=function(e){var t,n,i,o,a,l,c=0,d=0,u="data:";if(e.substr(0,u.length)===u)throw new Error("Invalid base64 input, it looks like a data url.");var h,f=3*(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(e.charAt(e.length-1)===r.charAt(64)&&f--,e.charAt(e.length-2)===r.charAt(64)&&f--,f%1!=0)throw new Error("Invalid base64 input, bad content length.");for(h=s.uint8array?new Uint8Array(0|f):new Array(0|f);c<e.length;)t=r.indexOf(e.charAt(c++))<<2|(o=r.indexOf(e.charAt(c++)))>>4,n=(15&o)<<4|(a=r.indexOf(e.charAt(c++)))>>2,i=(3&a)<<6|(l=r.indexOf(e.charAt(c++))),h[d++]=t,64!==a&&(h[d++]=n),64!==l&&(h[d++]=i);return h}},{"./support":30,"./utils":32}],2:[function(e,t,n){"use strict";var i=e("./external"),s=e("./stream/DataWorker"),r=e("./stream/Crc32Probe"),o=e("./stream/DataLengthProbe");function a(e,t,n,i,s){this.compressedSize=e,this.uncompressedSize=t,this.crc32=n,this.compression=i,this.compressedContent=s}a.prototype={getContentWorker:function(){var e=new s(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),t=this;return e.on("end",(function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),e},getCompressedWorker:function(){return new s(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},a.createWorkerFrom=function(e,t,n){return e.pipe(new r).pipe(new o("uncompressedSize")).pipe(t.compressWorker(n)).pipe(new o("compressedSize")).withStreamInfo("compression",t)},t.exports=a},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,n){"use strict";var i=e("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(e){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},n.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,n){"use strict";var i=e("./utils");var s=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function(e,t){return void 0!==e&&e.length?"string"!==i.getTypeOf(e)?function(e,t,n,i){var r=s,o=i+n;e^=-1;for(var a=i;a<o;a++)e=e>>>8^r[255&(e^t[a])];return-1^e}(0|t,e,e.length,0):function(e,t,n,i){var r=s,o=i+n;e^=-1;for(var a=i;a<o;a++)e=e>>>8^r[255&(e^t.charCodeAt(a))];return-1^e}(0|t,e,e.length,0):0}},{"./utils":32}],5:[function(e,t,n){"use strict";n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(e,t,n){"use strict";var i=null;i="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:i}},{lie:37}],7:[function(e,t,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,s=e("pako"),r=e("./utils"),o=e("./stream/GenericWorker"),a=i?"uint8array":"array";function l(e,t){o.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}n.magic="\b\0",r.inherits(l,o),l.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(r.transformTo(a,e.data),!1)},l.prototype.flush=function(){o.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},n.compressWorker=function(e){return new l("Deflate",e)},n.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,n){"use strict";var i=e("../utils"),s=e("../stream/GenericWorker"),r=e("../utf8"),o=e("../crc32"),a=e("../signature"),l=function(e,t){var n,i="";for(n=0;n<t;n++)i+=String.fromCharCode(255&e),e>>>=8;return i},c=function(e,t,n,s,c,d){var u,h,f=e.file,m=e.compression,p=d!==r.utf8encode,g=i.transformTo("string",d(f.name)),b=i.transformTo("string",r.utf8encode(f.name)),v=f.comment,w=i.transformTo("string",d(v)),y=i.transformTo("string",r.utf8encode(v)),_=b.length!==f.name.length,k=y.length!==v.length,I="",C="",x="",S=f.dir,A=f.date,T={crc32:0,compressedSize:0,uncompressedSize:0};t&&!n||(T.crc32=e.crc32,T.compressedSize=e.compressedSize,T.uncompressedSize=e.uncompressedSize);var E=0;t&&(E|=8),p||!_&&!k||(E|=2048);var z,R,P,O=0,U=0;S&&(O|=16),"UNIX"===c?(U=798,O|=(z=f.unixPermissions,R=S,P=z,z||(P=R?16893:33204),(65535&P)<<16)):(U=20,O|=63&(f.dosPermissions||0)),u=A.getUTCHours(),u<<=6,u|=A.getUTCMinutes(),u<<=5,u|=A.getUTCSeconds()/2,h=A.getUTCFullYear()-1980,h<<=4,h|=A.getUTCMonth()+1,h<<=5,h|=A.getUTCDate(),_&&(C=l(1,1)+l(o(g),4)+b,I+="up"+l(C.length,2)+C),k&&(x=l(1,1)+l(o(w),4)+y,I+="uc"+l(x.length,2)+x);var D="";return D+="\n\0",D+=l(E,2),D+=m.magic,D+=l(u,2),D+=l(h,2),D+=l(T.crc32,4),D+=l(T.compressedSize,4),D+=l(T.uncompressedSize,4),D+=l(g.length,2),D+=l(I.length,2),{fileRecord:a.LOCAL_FILE_HEADER+D+g+I,dirRecord:a.CENTRAL_FILE_HEADER+l(U,2)+D+l(w.length,2)+"\0\0\0\0"+l(O,4)+l(s,4)+g+I+w}},d=function(e){return a.DATA_DESCRIPTOR+l(e.crc32,4)+l(e.compressedSize,4)+l(e.uncompressedSize,4)};function u(e,t,n,i){s.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=n,this.encodeFileName=i,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}i.inherits(u,s),u.prototype.push=function(e){var t=e.meta.percent||0,n=this.entriesCount,i=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,s.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:n?(t+100*(n-i-1))/n:100}}))},u.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var n=c(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,n=c(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(n.dirRecord),t)this.push({data:d(e),meta:{percent:100}});else for(this.push({data:n.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var n=this.bytesWritten-e,s=function(e,t,n,s,r){var o=i.transformTo("string",r(s));return a.CENTRAL_DIRECTORY_END+"\0\0\0\0"+l(e,2)+l(e,2)+l(t,4)+l(n,4)+l(o.length,2)+o}(this.dirRecords.length,n,e,this.zipComment,this.encodeFileName);this.push({data:s,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()})),e.on("error",(function(e){t.error(e)})),this},u.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(e){var t=this._sources;if(!s.prototype.error.call(this,e))return!1;for(var n=0;n<t.length;n++)try{t[n].error(e)}catch(e){}return!0},u.prototype.lock=function(){s.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=u},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,n){"use strict";var i=e("../compressions"),s=e("./ZipFileWorker");n.generateWorker=function(e,t,n){var r=new s(t.streamFiles,n,t.platform,t.encodeFileName),o=0;try{e.forEach((function(e,n){o++;var s=function(e,t){var n=e||t,s=i[n];if(!s)throw new Error(n+" is not a valid compression method !");return s}(n.options.compression,t.compression),a=n.options.compressionOptions||t.compressionOptions||{},l=n.dir,c=n.date;n._compressWorker(s,a).withStreamInfo("file",{name:e,dir:l,date:c,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(r)})),r.entriesCount=o}catch(e){r.error(e)}return r}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,n){"use strict";function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var e=new i;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}i.prototype=e("./object"),i.prototype.loadAsync=e("./load"),i.support=e("./support"),i.defaults=e("./defaults"),i.version="3.7.1",i.loadAsync=function(e,t){return(new i).loadAsync(e,t)},i.external=e("./external"),t.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,n){"use strict";var i=e("./utils"),s=e("./external"),r=e("./utf8"),o=e("./zipEntries"),a=e("./stream/Crc32Probe"),l=e("./nodejsUtils");function c(e){return new s.Promise((function(t,n){var i=e.decompressed.getContentWorker().pipe(new a);i.on("error",(function(e){n(e)})).on("end",(function(){i.streamInfo.crc32!==e.decompressed.crc32?n(new Error("Corrupted zip : CRC32 mismatch")):t()})).resume()}))}t.exports=function(e,t){var n=this;return t=i.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:r.utf8decode}),l.isNode&&l.isStream(e)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then((function(e){var n=new o(t);return n.load(e),n})).then((function(e){var n=[s.Promise.resolve(e)],i=e.files;if(t.checkCRC32)for(var r=0;r<i.length;r++)n.push(c(i[r]));return s.Promise.all(n)})).then((function(e){for(var i=e.shift(),s=i.files,r=0;r<s.length;r++){var o=s[r];n.file(o.fileNameStr,o.decompressed,{binary:!0,optimizedBinaryString:!0,date:o.date,dir:o.dir,comment:o.fileCommentStr.length?o.fileCommentStr:null,unixPermissions:o.unixPermissions,dosPermissions:o.dosPermissions,createFolders:t.createFolders})}return i.zipComment.length&&(n.comment=i.zipComment),n}))}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,n){"use strict";var i=e("../utils"),s=e("../stream/GenericWorker");function r(e,t){s.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}i.inherits(r,s),r.prototype._bindStream=function(e){var t=this;this._stream=e,e.pause(),e.on("data",(function(e){t.push({data:e,meta:{percent:0}})})).on("error",(function(e){t.isPaused?this.generatedError=e:t.error(e)})).on("end",(function(){t.isPaused?t._upstreamEnded=!0:t.end()}))},r.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},r.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=r},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,n){"use strict";var i=e("readable-stream").Readable;function s(e,t,n){i.call(this,t),this._helper=e;var s=this;e.on("data",(function(e,t){s.push(e)||s._helper.pause(),n&&n(t)})).on("error",(function(e){s.emit("error",e)})).on("end",(function(){s.push(null)}))}e("../utils").inherits(s,i),s.prototype._read=function(){this._helper.resume()},t.exports=s},{"../utils":32,"readable-stream":16}],14:[function(e,t,n){"use strict";t.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(e,t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(e,t);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new Buffer(e,t)},allocBuffer:function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,n){"use strict";var i=e("./utf8"),s=e("./utils"),r=e("./stream/GenericWorker"),o=e("./stream/StreamHelper"),a=e("./defaults"),l=e("./compressedObject"),c=e("./zipObject"),d=e("./generate"),u=e("./nodejsUtils"),h=e("./nodejs/NodejsStreamInputAdapter"),f=function(e,t,n){var i,o=s.getTypeOf(t),d=s.extend(n||{},a);d.date=d.date||new Date,null!==d.compression&&(d.compression=d.compression.toUpperCase()),"string"==typeof d.unixPermissions&&(d.unixPermissions=parseInt(d.unixPermissions,8)),d.unixPermissions&&16384&d.unixPermissions&&(d.dir=!0),d.dosPermissions&&16&d.dosPermissions&&(d.dir=!0),d.dir&&(e=p(e)),d.createFolders&&(i=m(e))&&g.call(this,i,!0);var f="string"===o&&!1===d.binary&&!1===d.base64;n&&void 0!==n.binary||(d.binary=!f),(t instanceof l&&0===t.uncompressedSize||d.dir||!t||0===t.length)&&(d.base64=!1,d.binary=!0,t="",d.compression="STORE",o="string");var b=null;b=t instanceof l||t instanceof r?t:u.isNode&&u.isStream(t)?new h(e,t):s.prepareContent(e,t,d.binary,d.optimizedBinaryString,d.base64);var v=new c(e,b,d);this.files[e]=v},m=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},p=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},g=function(e,t){return t=void 0!==t?t:a.createFolders,e=p(e),this.files[e]||f.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function b(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,n,i;for(t in this.files)i=this.files[t],(n=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(n,i)},filter:function(e){var t=[];return this.forEach((function(n,i){e(n,i)&&t.push(i)})),t},file:function(e,t,n){if(1===arguments.length){if(b(e)){var i=e;return this.filter((function(e,t){return!t.dir&&i.test(e)}))}var s=this.files[this.root+e];return s&&!s.dir?s:null}return e=this.root+e,f.call(this,e,t,n),this},folder:function(e){if(!e)return this;if(b(e))return this.filter((function(t,n){return n.dir&&e.test(t)}));var t=this.root+e,n=g.call(this,t),i=this.clone();return i.root=n.name,i},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var n=this.filter((function(t,n){return n.name.slice(0,e.length)===e})),i=0;i<n.length;i++)delete this.files[n[i].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,n={};try{if((n=s.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw new Error("No output type specified.");s.checkSupport(n.type),"darwin"!==n.platform&&"freebsd"!==n.platform&&"linux"!==n.platform&&"sunos"!==n.platform||(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS");var a=n.comment||this.comment||"";t=d.generateWorker(this,n,a)}catch(e){(t=new r("error")).error(e)}return new o(t,n.type||"string",n.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=v},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,n){t.exports=e("stream")},{stream:void 0}],17:[function(e,t,n){"use strict";var i=e("./DataReader");function s(e){i.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(s,i),s.prototype.byteAt=function(e){return this.data[this.zero+e]},s.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),i=e.charCodeAt(2),s=e.charCodeAt(3),r=this.length-4;r>=0;--r)if(this.data[r]===t&&this.data[r+1]===n&&this.data[r+2]===i&&this.data[r+3]===s)return r-this.zero;return-1},s.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1),i=e.charCodeAt(2),s=e.charCodeAt(3),r=this.readData(4);return t===r[0]&&n===r[1]&&i===r[2]&&s===r[3]},s.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=s},{"../utils":32,"./DataReader":18}],18:[function(e,t,n){"use strict";var i=e("../utils");function s(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,n=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)n=(n<<8)+this.byteAt(t);return this.index+=e,n},readString:function(e){return i.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=s},{"../utils":32}],19:[function(e,t,n){"use strict";var i=e("./Uint8ArrayReader");function s(e){i.call(this,e)}e("../utils").inherits(s,i),s.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,n){"use strict";var i=e("./DataReader");function s(e){i.call(this,e)}e("../utils").inherits(s,i),s.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},s.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},s.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},s.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=s},{"../utils":32,"./DataReader":18}],21:[function(e,t,n){"use strict";var i=e("./ArrayReader");function s(e){i.call(this,e)}e("../utils").inherits(s,i),s.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,n){"use strict";var i=e("../utils"),s=e("../support"),r=e("./ArrayReader"),o=e("./StringReader"),a=e("./NodeBufferReader"),l=e("./Uint8ArrayReader");t.exports=function(e){var t=i.getTypeOf(e);return i.checkSupport(t),"string"!==t||s.uint8array?"nodebuffer"===t?new a(e):s.uint8array?new l(i.transformTo("uint8array",e)):new r(i.transformTo("array",e)):new o(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,n){"use strict";n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,n){"use strict";var i=e("./GenericWorker"),s=e("../utils");function r(e){i.call(this,"ConvertWorker to "+e),this.destType=e}s.inherits(r,i),r.prototype.processChunk=function(e){this.push({data:s.transformTo(this.destType,e.data),meta:e.meta})},t.exports=r},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,n){"use strict";var i=e("./GenericWorker"),s=e("../crc32");function r(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(r,i),r.prototype.processChunk=function(e){this.streamInfo.crc32=s(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=r},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,n){"use strict";var i=e("../utils"),s=e("./GenericWorker");function r(e){s.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}i.inherits(r,s),r.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}s.prototype.processChunk.call(this,e)},t.exports=r},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,n){"use strict";var i=e("../utils"),s=e("./GenericWorker");function r(e){s.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then((function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=i.getTypeOf(e),t.isPaused||t._tickAndRepeat()}),(function(e){t.error(e)}))}i.inherits(r,s),r.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=r},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,n){"use strict";function i(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var n=0;n<this._listeners[e].length;n++)this._listeners[e][n].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.end()})),e.on("error",(function(e){t.error(e)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var e=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=i},{}],29:[function(e,t,n){"use strict";var i=e("../utils"),s=e("./ConvertWorker"),r=e("./GenericWorker"),o=e("../base64"),a=e("../support"),l=e("../external"),c=null;if(a.nodestream)try{c=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}function d(e,t){return new l.Promise((function(n,s){var r=[],a=e._internalType,l=e._outputType,c=e._mimeType;e.on("data",(function(e,n){r.push(e),t&&t(n)})).on("error",(function(e){r=[],s(e)})).on("end",(function(){try{var e=function(e,t,n){switch(e){case"blob":return i.newBlob(i.transformTo("arraybuffer",t),n);case"base64":return o.encode(t);default:return i.transformTo(e,t)}}(l,function(e,t){var n,i=0,s=null,r=0;for(n=0;n<t.length;n++)r+=t[n].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(s=new Uint8Array(r),n=0;n<t.length;n++)s.set(t[n],i),i+=t[n].length;return s;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(a,r),c);n(e)}catch(e){s(e)}r=[]})).resume()}))}function u(e,t,n){var o=t;switch(t){case"blob":case"arraybuffer":o="uint8array";break;case"base64":o="string"}try{this._internalType=o,this._outputType=t,this._mimeType=n,i.checkSupport(o),this._worker=e.pipe(new s(o)),e.lock()}catch(e){this._worker=new r("error"),this._worker.error(e)}}u.prototype={accumulate:function(e){return d(this,e)},on:function(e,t){var n=this;return"data"===e?this._worker.on(e,(function(e){t.call(n,e.data,e.meta)})):this._worker.on(e,(function(){i.delay(t,arguments,n)})),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(i.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new c(this,{objectMode:"nodebuffer"!==this._outputType},e)}},t.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,n){"use strict";if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer="undefined"!=typeof Buffer,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var i=new ArrayBuffer(0);try{n.blob=0===new Blob([i],{type:"application/zip"}).size}catch(e){try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(i),n.blob=0===s.getBlob("application/zip").size}catch(e){n.blob=!1}}}try{n.nodestream=!!e("readable-stream").Readable}catch(e){n.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,n){"use strict";for(var i=e("./utils"),s=e("./support"),r=e("./nodejsUtils"),o=e("./stream/GenericWorker"),a=new Array(256),l=0;l<256;l++)a[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;a[254]=a[254]=1;function c(){o.call(this,"utf-8 decode"),this.leftOver=null}function d(){o.call(this,"utf-8 encode")}n.utf8encode=function(e){return s.nodebuffer?r.newBufferFrom(e,"utf-8"):function(e){var t,n,i,r,o,a=e.length,l=0;for(r=0;r<a;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<a&&56320==(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=s.uint8array?new Uint8Array(l):new Array(l),o=0,r=0;o<l;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<a&&56320==(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t}(e)},n.utf8decode=function(e){return s.nodebuffer?i.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,n,s,r,o=e.length,l=new Array(2*o);for(n=0,t=0;t<o;)if((s=e[t++])<128)l[n++]=s;else if((r=a[s])>4)l[n++]=65533,t+=r-1;else{for(s&=2===r?31:3===r?15:7;r>1&&t<o;)s=s<<6|63&e[t++],r--;r>1?l[n++]=65533:s<65536?l[n++]=s:(s-=65536,l[n++]=55296|s>>10&1023,l[n++]=56320|1023&s)}return l.length!==n&&(l.subarray?l=l.subarray(0,n):l.length=n),i.applyFromCharCode(l)}(e=i.transformTo(s.uint8array?"uint8array":"array",e))},i.inherits(c,o),c.prototype.processChunk=function(e){var t=i.transformTo(s.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var r=t;(t=new Uint8Array(r.length+this.leftOver.length)).set(this.leftOver,0),t.set(r,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var o=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+a[e[n]]>t?n:t}(t),l=t;o!==t.length&&(s.uint8array?(l=t.subarray(0,o),this.leftOver=t.subarray(o,t.length)):(l=t.slice(0,o),this.leftOver=t.slice(o,t.length))),this.push({data:n.utf8decode(l),meta:e.meta})},c.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=c,i.inherits(d,o),d.prototype.processChunk=function(e){this.push({data:n.utf8encode(e.data),meta:e.meta})},n.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,n){"use strict";var i=e("./support"),s=e("./base64"),r=e("./nodejsUtils"),o=e("set-immediate-shim"),a=e("./external");function l(e){return e}function c(e,t){for(var n=0;n<e.length;++n)t[n]=255&e.charCodeAt(n);return t}n.newBlob=function(e,t){n.checkSupport("blob");try{return new Blob([e],{type:t})}catch(n){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return i.append(e),i.getBlob(t)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(e,t,n){var i=[],s=0,r=e.length;if(r<=n)return String.fromCharCode.apply(null,e);for(;s<r;)"array"===t||"nodebuffer"===t?i.push(String.fromCharCode.apply(null,e.slice(s,Math.min(s+n,r)))):i.push(String.fromCharCode.apply(null,e.subarray(s,Math.min(s+n,r)))),s+=n;return i.join("")},stringifyByChar:function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&1===String.fromCharCode.apply(null,r.allocBuffer(1)).length}catch(e){return!1}}()}};function u(e){var t=65536,i=n.getTypeOf(e),s=!0;if("uint8array"===i?s=d.applyCanBeUsed.uint8array:"nodebuffer"===i&&(s=d.applyCanBeUsed.nodebuffer),s)for(;t>1;)try{return d.stringifyByChunk(e,i,t)}catch(e){t=Math.floor(t/2)}return d.stringifyByChar(e)}function h(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}n.applyFromCharCode=u;var f={};f.string={string:l,array:function(e){return c(e,new Array(e.length))},arraybuffer:function(e){return f.string.uint8array(e).buffer},uint8array:function(e){return c(e,new Uint8Array(e.length))},nodebuffer:function(e){return c(e,r.allocBuffer(e.length))}},f.array={string:u,array:l,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return r.newBufferFrom(e)}},f.arraybuffer={string:function(e){return u(new Uint8Array(e))},array:function(e){return h(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:l,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return r.newBufferFrom(new Uint8Array(e))}},f.uint8array={string:u,array:function(e){return h(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:l,nodebuffer:function(e){return r.newBufferFrom(e)}},f.nodebuffer={string:u,array:function(e){return h(e,new Array(e.length))},arraybuffer:function(e){return f.nodebuffer.uint8array(e).buffer},uint8array:function(e){return h(e,new Uint8Array(e.length))},nodebuffer:l},n.transformTo=function(e,t){if(t||(t=""),!e)return t;n.checkSupport(e);var i=n.getTypeOf(t);return f[i][e](t)},n.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":i.nodebuffer&&r.isBuffer(e)?"nodebuffer":i.uint8array&&e instanceof Uint8Array?"uint8array":i.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(e){if(!i[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(e){var t,n,i="";for(n=0;n<(e||"").length;n++)i+="\\x"+((t=e.charCodeAt(n))<16?"0":"")+t.toString(16).toUpperCase();return i},n.delay=function(e,t,n){o((function(){e.apply(n||null,t||[])}))},n.inherits=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n},n.extend=function(){var e,t,n={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===n[t]&&(n[t]=arguments[e][t]);return n},n.prepareContent=function(e,t,r,o,l){return a.Promise.resolve(t).then((function(e){return i.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new a.Promise((function(t,n){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.onerror=function(e){n(e.target.error)},i.readAsArrayBuffer(e)})):e})).then((function(t){var d,u=n.getTypeOf(t);return u?("arraybuffer"===u?t=n.transformTo("uint8array",t):"string"===u&&(l?t=s.decode(t):r&&!0!==o&&(t=c(d=t,i.uint8array?new Uint8Array(d.length):new Array(d.length)))),t):a.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(e,t,n){"use strict";var i=e("./reader/readerFor"),s=e("./utils"),r=e("./signature"),o=e("./zipEntry"),a=(e("./utf8"),e("./support"));function l(e){this.files=[],this.loadOptions=e}l.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(t)+", expected "+s.pretty(e)+")")}},isSignature:function(e,t){var n=this.reader.index;this.reader.setIndex(e);var i=this.reader.readString(4)===t;return this.reader.setIndex(n),i},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=a.uint8array?"uint8array":"array",n=s.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,n,i=this.zip64EndOfCentralSize-44;0<i;)e=this.reader.readInt(2),t=this.reader.readInt(4),n=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(r.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(r.CENTRAL_FILE_HEADER);)(e=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(r.CENTRAL_DIRECTORY_END);if(e<0)throw!this.isSignature(0,r.LOCAL_FILE_HEADER)?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory");this.reader.setIndex(e);var t=e;if(this.checkSignature(r.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,r.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var i=t-n;if(i>0)this.isSignature(t,r.CENTRAL_FILE_HEADER)||(this.reader.zero=i);else if(i<0)throw new Error("Corrupted zip: missing "+Math.abs(i)+" bytes.")},prepareReader:function(e){this.reader=i(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(e,t,n){"use strict";var i=e("./reader/readerFor"),s=e("./utils"),r=e("./compressedObject"),o=e("./crc32"),a=e("./utf8"),l=e("./compressions"),c=e("./support");function d(e,t){this.options=e,this.loadOptions=t}d.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,n;if(e.skip(22),this.fileNameLength=e.readInt(2),n=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in l)if(l.hasOwnProperty(t)&&l[t].magic===e)return l[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new r(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===e&&(this.dosPermissions=63&this.externalFileAttributes),3===e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=i(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,n,i,s=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<s;)t=e.readInt(2),n=e.readInt(2),i=e.readData(n),this.extraFields[t]={id:t,length:n,value:i};e.setIndex(s)},handleUTF8:function(){var e=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var n=s.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var i=this.findExtraFieldUnicodeComment();if(null!==i)this.fileCommentStr=i;else{var r=s.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(r)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=i(e.value);return 1!==t.readInt(1)||o(this.fileName)!==t.readInt(4)?null:a.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=i(e.value);return 1!==t.readInt(1)||o(this.fileComment)!==t.readInt(4)?null:a.utf8decode(t.readData(e.length-5))}return null}},t.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,n){"use strict";var i=e("./stream/StreamHelper"),s=e("./stream/DataWorker"),r=e("./utf8"),o=e("./compressedObject"),a=e("./stream/GenericWorker"),l=function(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=t,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}};l.prototype={internalStream:function(e){var t=null,n="string";try{if(!e)throw new Error("No output type specified.");var s="string"===(n=e.toLowerCase())||"text"===n;"binarystring"!==n&&"text"!==n||(n="string"),t=this._decompressWorker();var o=!this._dataBinary;o&&!s&&(t=t.pipe(new r.Utf8EncodeWorker)),!o&&s&&(t=t.pipe(new r.Utf8DecodeWorker))}catch(e){(t=new a("error")).error(e)}return new i(t,n,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof o&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new r.Utf8EncodeWorker)),o.createWorkerFrom(n,e,t)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof a?this._data:new s(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<c.length;u++)l.prototype[c[u]]=d;t.exports=l},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,t,n){(function(e){"use strict";var n,i,s=e.MutationObserver||e.WebKitMutationObserver;if(s){var r=0,o=new s(d),a=e.document.createTextNode("");o.observe(a,{characterData:!0}),n=function(){a.data=r=++r%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){d(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(d,0)};else{var l=new e.MessageChannel;l.port1.onmessage=d,n=function(){l.port2.postMessage(0)}}var c=[];function d(){var e,t;i=!0;for(var n=c.length;n;){for(t=c,c=[],e=-1;++e<n;)t[e]();n=c.length}i=!1}t.exports=function(e){1!==c.push(e)||i||n()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(e,t,n){"use strict";var i=e("immediate");function s(){}var r={},o=["REJECTED"],a=["FULFILLED"],l=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,e!==s&&f(this,e)}function d(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function u(e,t,n){i((function(){var i;try{i=t(n)}catch(t){return r.reject(e,t)}i===e?r.reject(e,new TypeError("Cannot resolve promise with itself")):r.resolve(e,i)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function i(t){n||(n=!0,r.reject(e,t))}function s(t){n||(n=!0,r.resolve(e,t))}var o=m((function(){t(s,i)}));"error"===o.status&&i(o.value)}function m(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}t.exports=c,c.prototype.finally=function(e){if("function"!=typeof e)return this;var t=this.constructor;return this.then((function(n){return t.resolve(e()).then((function(){return n}))}),(function(n){return t.resolve(e()).then((function(){throw n}))}))},c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(s);this.state!==l?u(n,this.state===a?e:t,this.outcome):this.queue.push(new d(n,e,t));return n},d.prototype.callFulfilled=function(e){r.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){r.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},r.resolve=function(e,t){var n=m(h,t);if("error"===n.status)return r.reject(e,n.value);var i=n.value;if(i)f(e,i);else{e.state=a,e.outcome=t;for(var s=-1,o=e.queue.length;++s<o;)e.queue[s].callFulfilled(t)}return e},r.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,i=e.queue.length;++n<i;)e.queue[n].callRejected(t);return e},c.resolve=function(e){if(e instanceof this)return e;return r.resolve(new this(s),e)},c.reject=function(e){var t=new this(s);return r.reject(t,e)},c.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);var o=new Array(n),a=0,l=-1,c=new this(s);for(;++l<n;)d(e[l],l);return c;function d(e,s){t.resolve(e).then((function(e){o[s]=e,++a!==n||i||(i=!0,r.resolve(c,o))}),(function(e){i||(i=!0,r.reject(c,e))}))}},c.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);var o=-1,a=new this(s);for(;++o<n;)l=e[o],t.resolve(l).then((function(e){i||(i=!0,r.resolve(a,e))}),(function(e){i||(i=!0,r.reject(a,e))}));var l;return a}},{immediate:36}],38:[function(e,t,n){"use strict";var i={};(0,e("./lib/utils/common").assign)(i,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,n){"use strict";var i=e("./zlib/deflate"),s=e("./utils/common"),r=e("./utils/strings"),o=e("./zlib/messages"),a=e("./zlib/zstream"),l=Object.prototype.toString;function c(e){if(!(this instanceof c))return new c(e);this.options=s.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var n=i.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==n)throw new Error(o[n]);if(t.header&&i.deflateSetHeader(this.strm,t.header),t.dictionary){var d;if(d="string"==typeof t.dictionary?r.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(n=i.deflateSetDictionary(this.strm,d)))throw new Error(o[n]);this._dict_set=!0}}function d(e,t){var n=new c(t);if(n.push(e,!0),n.err)throw n.msg||o[n.err];return n.result}c.prototype.push=function(e,t){var n,o,a=this.strm,c=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?a.input=r.string2buf(e):"[object ArrayBuffer]"===l.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new s.Buf8(c),a.next_out=0,a.avail_out=c),1!==(n=i.deflate(a,o))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==a.avail_out&&(0!==a.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(r.buf2binstring(s.shrinkBuf(a.output,a.next_out))):this.onData(s.shrinkBuf(a.output,a.next_out)))}while((a.avail_in>0||0===a.avail_out)&&1!==n);return 4===o?(n=i.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==o||(this.onEnd(0),a.avail_out=0,!0)},c.prototype.onData=function(e){this.chunks.push(e)},c.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=c,n.deflate=d,n.deflateRaw=function(e,t){return(t=t||{}).raw=!0,d(e,t)},n.gzip=function(e,t){return(t=t||{}).gzip=!0,d(e,t)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,n){"use strict";var i=e("./zlib/inflate"),s=e("./utils/common"),r=e("./utils/strings"),o=e("./zlib/constants"),a=e("./zlib/messages"),l=e("./zlib/zstream"),c=e("./zlib/gzheader"),d=Object.prototype.toString;function u(e){if(!(this instanceof u))return new u(e);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var n=i.inflateInit2(this.strm,t.windowBits);if(n!==o.Z_OK)throw new Error(a[n]);this.header=new c,i.inflateGetHeader(this.strm,this.header)}function h(e,t){var n=new u(t);if(n.push(e,!0),n.err)throw n.msg||a[n.err];return n.result}u.prototype.push=function(e,t){var n,a,l,c,u,h,f=this.strm,m=this.options.chunkSize,p=this.options.dictionary,g=!1;if(this.ended)return!1;a=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?f.input=r.binstring2buf(e):"[object ArrayBuffer]"===d.call(e)?f.input=new Uint8Array(e):f.input=e,f.next_in=0,f.avail_in=f.input.length;do{if(0===f.avail_out&&(f.output=new s.Buf8(m),f.next_out=0,f.avail_out=m),(n=i.inflate(f,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&p&&(h="string"==typeof p?r.string2buf(p):"[object ArrayBuffer]"===d.call(p)?new Uint8Array(p):p,n=i.inflateSetDictionary(this.strm,h)),n===o.Z_BUF_ERROR&&!0===g&&(n=o.Z_OK,g=!1),n!==o.Z_STREAM_END&&n!==o.Z_OK)return this.onEnd(n),this.ended=!0,!1;f.next_out&&(0!==f.avail_out&&n!==o.Z_STREAM_END&&(0!==f.avail_in||a!==o.Z_FINISH&&a!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(l=r.utf8border(f.output,f.next_out),c=f.next_out-l,u=r.buf2string(f.output,l),f.next_out=c,f.avail_out=m-c,c&&s.arraySet(f.output,f.output,l,c,0),this.onData(u)):this.onData(s.shrinkBuf(f.output,f.next_out)))),0===f.avail_in&&0===f.avail_out&&(g=!0)}while((f.avail_in>0||0===f.avail_out)&&n!==o.Z_STREAM_END);return n===o.Z_STREAM_END&&(a=o.Z_FINISH),a===o.Z_FINISH?(n=i.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===o.Z_OK):a!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),f.avail_out=0,!0)},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=u,n.inflate=h,n.inflateRaw=function(e,t){return(t=t||{}).raw=!0,h(e,t)},n.ungzip=h},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var s={arraySet:function(e,t,n,i,s){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),s);else for(var r=0;r<i;r++)e[s+r]=t[n+r]},flattenChunks:function(e){var t,n,i,s,r,o;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(o=new Uint8Array(i),s=0,t=0,n=e.length;t<n;t++)r=e[t],o.set(r,s),s+=r.length;return o}},r={arraySet:function(e,t,n,i,s){for(var r=0;r<i;r++)e[s+r]=t[n+r]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,s)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,r))},n.setTyped(i)},{}],42:[function(e,t,n){"use strict";var i=e("./common"),s=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(e){s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){r=!1}for(var o=new i.Buf8(256),a=0;a<256;a++)o[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;function l(e,t){if(t<65537&&(e.subarray&&r||!e.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var n="",o=0;o<t;o++)n+=String.fromCharCode(e[o]);return n}o[254]=o[254]=1,n.string2buf=function(e){var t,n,s,r,o,a=e.length,l=0;for(r=0;r<a;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<a&&56320==(64512&(s=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(s-56320),r++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=new i.Buf8(l),o=0,r=0;o<l;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<a&&56320==(64512&(s=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(s-56320),r++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},n.buf2binstring=function(e){return l(e,e.length)},n.binstring2buf=function(e){for(var t=new i.Buf8(e.length),n=0,s=t.length;n<s;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,i,s,r,a=t||e.length,c=new Array(2*a);for(i=0,n=0;n<a;)if((s=e[n++])<128)c[i++]=s;else if((r=o[s])>4)c[i++]=65533,n+=r-1;else{for(s&=2===r?31:3===r?15:7;r>1&&n<a;)s=s<<6|63&e[n++],r--;r>1?c[i++]=65533:s<65536?c[i++]=s:(s-=65536,c[i++]=55296|s>>10&1023,c[i++]=56320|1023&s)}return l(c,i)},n.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+o[e[n]]>t?n:t}},{"./common":41}],43:[function(e,t,n){"use strict";t.exports=function(e,t,n,i){for(var s=65535&e|0,r=e>>>16&65535|0,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{r=r+(s=s+t[i++]|0)|0}while(--o);s%=65521,r%=65521}return s|r<<16|0}},{}],44:[function(e,t,n){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,n){"use strict";var i=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function(e,t,n,s){var r=i,o=s+n;e^=-1;for(var a=s;a<o;a++)e=e>>>8^r[255&(e^t[a])];return-1^e}},{}],46:[function(e,t,n){"use strict";var i,s=e("../utils/common"),r=e("./trees"),o=e("./adler32"),a=e("./crc32"),l=e("./messages"),c=-2,d=258,u=262,h=103,f=113,m=666;function p(e,t){return e.msg=l[t],t}function g(e){return(e<<1)-(e>4?9:0)}function b(e){for(var t=e.length;--t>=0;)e[t]=0}function v(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(s.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function w(e,t){r._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,v(e.strm)}function y(e,t){e.pending_buf[e.pending++]=t}function _(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function k(e,t){var n,i,s=e.max_chain_length,r=e.strstart,o=e.prev_length,a=e.nice_match,l=e.strstart>e.w_size-u?e.strstart-(e.w_size-u):0,c=e.window,h=e.w_mask,f=e.prev,m=e.strstart+d,p=c[r+o-1],g=c[r+o];e.prev_length>=e.good_match&&(s>>=2),a>e.lookahead&&(a=e.lookahead);do{if(c[(n=t)+o]===g&&c[n+o-1]===p&&c[n]===c[r]&&c[++n]===c[r+1]){r+=2,n++;do{}while(c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&r<m);if(i=d-(m-r),r=m-d,i>o){if(e.match_start=t,o=i,i>=a)break;p=c[r+o-1],g=c[r+o]}}}while((t=f[t&h])>l&&0!=--s);return o<=e.lookahead?o:e.lookahead}function I(e){var t,n,i,r,l,c,d,h,f,m,p=e.w_size;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-u)){s.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=n=e.hash_size;do{i=e.head[--t],e.head[t]=i>=p?i-p:0}while(--n);t=n=p;do{i=e.prev[--t],e.prev[t]=i>=p?i-p:0}while(--n);r+=p}if(0===e.strm.avail_in)break;if(c=e.strm,d=e.window,h=e.strstart+e.lookahead,f=r,m=void 0,(m=c.avail_in)>f&&(m=f),n=0===m?0:(c.avail_in-=m,s.arraySet(d,c.input,c.next_in,m,h),1===c.state.wrap?c.adler=o(c.adler,d,m,h):2===c.state.wrap&&(c.adler=a(c.adler,d,m,h)),c.next_in+=m,c.total_in+=m,m),e.lookahead+=n,e.lookahead+e.insert>=3)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+3-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<u&&0!==e.strm.avail_in)}function C(e,t){for(var n,i;;){if(e.lookahead<u){if(I(e),e.lookahead<u&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-u&&(e.match_length=k(e,n)),e.match_length>=3)if(i=r._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=r._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(w(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(w(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(w(e,!1),0===e.strm.avail_out)?1:2}function x(e,t){for(var n,i,s;;){if(e.lookahead<u){if(I(e),e.lookahead<u&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-u&&(e.match_length=k(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,i=r._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=s&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(w(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((i=r._tr_tally(e,0,e.window[e.strstart-1]))&&w(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=r._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(w(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(w(e,!1),0===e.strm.avail_out)?1:2}function S(e,t,n,i,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=s}function A(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(1146),this.dyn_dtree=new s.Buf16(122),this.bl_tree=new s.Buf16(78),b(this.dyn_ltree),b(this.dyn_dtree),b(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(16),this.heap=new s.Buf16(573),b(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(573),b(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function T(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:f,e.adler=2===t.wrap?0:1,t.last_flush=0,r._tr_init(t),0):p(e,c)}function E(e){var t,n=T(e);return 0===n&&((t=e.state).window_size=2*t.w_size,b(t.head),t.max_lazy_match=i[t.level].max_lazy,t.good_match=i[t.level].good_length,t.nice_match=i[t.level].nice_length,t.max_chain_length=i[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function z(e,t,n,i,r,o){if(!e)return c;var a=1;if(-1===t&&(t=6),i<0?(a=0,i=-i):i>15&&(a=2,i-=16),r<1||r>9||8!==n||i<8||i>15||t<0||t>9||o<0||o>4)return p(e,c);8===i&&(i=9);var l=new A;return e.state=l,l.strm=e,l.wrap=a,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=r+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new s.Buf8(2*l.w_size),l.head=new s.Buf16(l.hash_size),l.prev=new s.Buf16(l.w_size),l.lit_bufsize=1<<r+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new s.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=n,E(e)}i=[new S(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(I(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,w(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-u&&(w(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(w(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(w(e,!1),e.strm.avail_out),1)})),new S(4,4,8,4,C),new S(4,5,16,8,C),new S(4,6,32,32,C),new S(4,4,16,16,x),new S(8,16,32,32,x),new S(8,16,128,128,x),new S(8,32,128,256,x),new S(32,128,258,1024,x),new S(32,258,258,4096,x)],n.deflateInit=function(e,t){return z(e,t,8,15,8,0)},n.deflateInit2=z,n.deflateReset=E,n.deflateResetKeep=T,n.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?c:(e.state.gzhead=t,0):c},n.deflate=function(e,t){var n,s,o,l;if(!e||!e.state||t>5||t<0)return e?p(e,c):c;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||s.status===m&&4!==t)return p(e,0===e.avail_out?-5:c);if(s.strm=e,n=s.last_flush,s.last_flush=t,42===s.status)if(2===s.wrap)e.adler=0,y(s,31),y(s,139),y(s,8),s.gzhead?(y(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),y(s,255&s.gzhead.time),y(s,s.gzhead.time>>8&255),y(s,s.gzhead.time>>16&255),y(s,s.gzhead.time>>24&255),y(s,9===s.level?2:s.strategy>=2||s.level<2?4:0),y(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(y(s,255&s.gzhead.extra.length),y(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=a(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69):(y(s,0),y(s,0),y(s,0),y(s,0),y(s,0),y(s,9===s.level?2:s.strategy>=2||s.level<2?4:0),y(s,3),s.status=f);else{var u=8+(s.w_bits-8<<4)<<8;u|=(s.strategy>=2||s.level<2?0:s.level<6?1:6===s.level?2:3)<<6,0!==s.strstart&&(u|=32),u+=31-u%31,s.status=f,_(s,u),0!==s.strstart&&(_(s,e.adler>>>16),_(s,65535&e.adler)),e.adler=1}if(69===s.status)if(s.gzhead.extra){for(o=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>o&&(e.adler=a(e.adler,s.pending_buf,s.pending-o,o)),v(e),o=s.pending,s.pending!==s.pending_buf_size));)y(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>o&&(e.adler=a(e.adler,s.pending_buf,s.pending-o,o)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=73)}else s.status=73;if(73===s.status)if(s.gzhead.name){o=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>o&&(e.adler=a(e.adler,s.pending_buf,s.pending-o,o)),v(e),o=s.pending,s.pending===s.pending_buf_size)){l=1;break}l=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,y(s,l)}while(0!==l);s.gzhead.hcrc&&s.pending>o&&(e.adler=a(e.adler,s.pending_buf,s.pending-o,o)),0===l&&(s.gzindex=0,s.status=91)}else s.status=91;if(91===s.status)if(s.gzhead.comment){o=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>o&&(e.adler=a(e.adler,s.pending_buf,s.pending-o,o)),v(e),o=s.pending,s.pending===s.pending_buf_size)){l=1;break}l=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,y(s,l)}while(0!==l);s.gzhead.hcrc&&s.pending>o&&(e.adler=a(e.adler,s.pending_buf,s.pending-o,o)),0===l&&(s.status=h)}else s.status=h;if(s.status===h&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&v(e),s.pending+2<=s.pending_buf_size&&(y(s,255&e.adler),y(s,e.adler>>8&255),e.adler=0,s.status=f)):s.status=f),0!==s.pending){if(v(e),0===e.avail_out)return s.last_flush=-1,0}else if(0===e.avail_in&&g(t)<=g(n)&&4!==t)return p(e,-5);if(s.status===m&&0!==e.avail_in)return p(e,-5);if(0!==e.avail_in||0!==s.lookahead||0!==t&&s.status!==m){var k=2===s.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(I(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=r._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(w(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(w(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(w(e,!1),0===e.strm.avail_out)?1:2}(s,t):3===s.strategy?function(e,t){for(var n,i,s,o,a=e.window;;){if(e.lookahead<=d){if(I(e),e.lookahead<=d&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=a[s=e.strstart-1])===a[++s]&&i===a[++s]&&i===a[++s]){o=e.strstart+d;do{}while(i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&s<o);e.match_length=d-(o-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=r._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=r._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(w(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(w(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(w(e,!1),0===e.strm.avail_out)?1:2}(s,t):i[s.level].func(s,t);if(3!==k&&4!==k||(s.status=m),1===k||3===k)return 0===e.avail_out&&(s.last_flush=-1),0;if(2===k&&(1===t?r._tr_align(s):5!==t&&(r._tr_stored_block(s,0,0,!1),3===t&&(b(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),v(e),0===e.avail_out))return s.last_flush=-1,0}return 4!==t?0:s.wrap<=0?1:(2===s.wrap?(y(s,255&e.adler),y(s,e.adler>>8&255),y(s,e.adler>>16&255),y(s,e.adler>>24&255),y(s,255&e.total_in),y(s,e.total_in>>8&255),y(s,e.total_in>>16&255),y(s,e.total_in>>24&255)):(_(s,e.adler>>>16),_(s,65535&e.adler)),v(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?0:1)},n.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==h&&t!==f&&t!==m?p(e,c):(e.state=null,t===f?p(e,-3):0):c},n.deflateSetDictionary=function(e,t){var n,i,r,a,l,d,u,h,f=t.length;if(!e||!e.state)return c;if(2===(a=(n=e.state).wrap)||1===a&&42!==n.status||n.lookahead)return c;for(1===a&&(e.adler=o(e.adler,t,f,0)),n.wrap=0,f>=n.w_size&&(0===a&&(b(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new s.Buf8(n.w_size),s.arraySet(h,t,f-n.w_size,n.w_size,0),t=h,f=n.w_size),l=e.avail_in,d=e.next_in,u=e.input,e.avail_in=f,e.next_in=0,e.input=t,I(n);n.lookahead>=3;){i=n.strstart,r=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+3-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++}while(--r);n.strstart=i,n.lookahead=2,I(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=d,e.input=u,e.avail_in=l,n.wrap=a,0},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,n){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,n){"use strict";t.exports=function(e,t){var n,i,s,r,o,a,l,c,d,u,h,f,m,p,g,b,v,w,y,_,k,I,C,x,S;n=e.state,i=e.next_in,x=e.input,s=i+(e.avail_in-5),r=e.next_out,S=e.output,o=r-(t-e.avail_out),a=r+(e.avail_out-257),l=n.dmax,c=n.wsize,d=n.whave,u=n.wnext,h=n.window,f=n.hold,m=n.bits,p=n.lencode,g=n.distcode,b=(1<<n.lenbits)-1,v=(1<<n.distbits)-1;e:do{m<15&&(f+=x[i++]<<m,m+=8,f+=x[i++]<<m,m+=8),w=p[f&b];t:for(;;){if(f>>>=y=w>>>24,m-=y,0===(y=w>>>16&255))S[r++]=65535&w;else{if(!(16&y)){if(0==(64&y)){w=p[(65535&w)+(f&(1<<y)-1)];continue t}if(32&y){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}_=65535&w,(y&=15)&&(m<y&&(f+=x[i++]<<m,m+=8),_+=f&(1<<y)-1,f>>>=y,m-=y),m<15&&(f+=x[i++]<<m,m+=8,f+=x[i++]<<m,m+=8),w=g[f&v];n:for(;;){if(f>>>=y=w>>>24,m-=y,!(16&(y=w>>>16&255))){if(0==(64&y)){w=g[(65535&w)+(f&(1<<y)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(k=65535&w,m<(y&=15)&&(f+=x[i++]<<m,(m+=8)<y&&(f+=x[i++]<<m,m+=8)),(k+=f&(1<<y)-1)>l){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=y,m-=y,k>(y=r-o)){if((y=k-y)>d&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(I=0,C=h,0===u){if(I+=c-y,y<_){_-=y;do{S[r++]=h[I++]}while(--y);I=r-k,C=S}}else if(u<y){if(I+=c+u-y,(y-=u)<_){_-=y;do{S[r++]=h[I++]}while(--y);if(I=0,u<_){_-=y=u;do{S[r++]=h[I++]}while(--y);I=r-k,C=S}}}else if(I+=u-y,y<_){_-=y;do{S[r++]=h[I++]}while(--y);I=r-k,C=S}for(;_>2;)S[r++]=C[I++],S[r++]=C[I++],S[r++]=C[I++],_-=3;_&&(S[r++]=C[I++],_>1&&(S[r++]=C[I++]))}else{I=r-k;do{S[r++]=S[I++],S[r++]=S[I++],S[r++]=S[I++],_-=3}while(_>2);_&&(S[r++]=S[I++],_>1&&(S[r++]=S[I++]))}break}}break}}while(i<s&&r<a);i-=_=m>>3,f&=(1<<(m-=_<<3))-1,e.next_in=i,e.next_out=r,e.avail_in=i<s?s-i+5:5-(i-s),e.avail_out=r<a?a-r+257:257-(r-a),n.hold=f,n.bits=m}},{}],49:[function(e,t,n){"use strict";var i=e("../utils/common"),s=e("./adler32"),r=e("./crc32"),o=e("./inffast"),a=e("./inftrees"),l=-2,c=12,d=30;function u(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function h(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new i.Buf32(852),t.distcode=t.distdyn=new i.Buf32(592),t.sane=1,t.back=-1,0):l}function m(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,f(e)):l}function p(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?l:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,m(e))):l}function g(e,t){var n,i;return e?(i=new h,e.state=i,i.window=null,0!==(n=p(e,t))&&(e.state=null),n):l}var b,v,w=!0;function y(e){if(w){var t;for(b=new i.Buf32(512),v=new i.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(a(1,e.lens,0,288,b,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;a(2,e.lens,0,32,v,0,e.work,{bits:5}),w=!1}e.lencode=b,e.lenbits=9,e.distcode=v,e.distbits=5}function _(e,t,n,s){var r,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new i.Buf8(o.wsize)),s>=o.wsize?(i.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((r=o.wsize-o.wnext)>s&&(r=s),i.arraySet(o.window,t,n-s,r,o.wnext),(s-=r)?(i.arraySet(o.window,t,n-s,s,0),o.wnext=s,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0}n.inflateReset=m,n.inflateReset2=p,n.inflateResetKeep=f,n.inflateInit=function(e){return g(e,15)},n.inflateInit2=g,n.inflate=function(e,t){var n,h,f,m,p,g,b,v,w,k,I,C,x,S,A,T,E,z,R,P,O,U,D,B,M=0,F=new i.Buf8(4),j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return l;(n=e.state).mode===c&&(n.mode=13),p=e.next_out,f=e.output,b=e.avail_out,m=e.next_in,h=e.input,g=e.avail_in,v=n.hold,w=n.bits,k=g,I=b,U=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;w<16;){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}if(2&n.wrap&&35615===v){n.check=0,F[0]=255&v,F[1]=v>>>8&255,n.check=r(n.check,F,2,0),v=0,w=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&v)<<8)+(v>>8))%31){e.msg="incorrect header check",n.mode=d;break}if(8!=(15&v)){e.msg="unknown compression method",n.mode=d;break}if(w-=4,O=8+(15&(v>>>=4)),0===n.wbits)n.wbits=O;else if(O>n.wbits){e.msg="invalid window size",n.mode=d;break}n.dmax=1<<O,e.adler=n.check=1,n.mode=512&v?10:c,v=0,w=0;break;case 2:for(;w<16;){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}if(n.flags=v,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=d;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=d;break}n.head&&(n.head.text=v>>8&1),512&n.flags&&(F[0]=255&v,F[1]=v>>>8&255,n.check=r(n.check,F,2,0)),v=0,w=0,n.mode=3;case 3:for(;w<32;){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}n.head&&(n.head.time=v),512&n.flags&&(F[0]=255&v,F[1]=v>>>8&255,F[2]=v>>>16&255,F[3]=v>>>24&255,n.check=r(n.check,F,4,0)),v=0,w=0,n.mode=4;case 4:for(;w<16;){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}n.head&&(n.head.xflags=255&v,n.head.os=v>>8),512&n.flags&&(F[0]=255&v,F[1]=v>>>8&255,n.check=r(n.check,F,2,0)),v=0,w=0,n.mode=5;case 5:if(1024&n.flags){for(;w<16;){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}n.length=v,n.head&&(n.head.extra_len=v),512&n.flags&&(F[0]=255&v,F[1]=v>>>8&255,n.check=r(n.check,F,2,0)),v=0,w=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((C=n.length)>g&&(C=g),C&&(n.head&&(O=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),i.arraySet(n.head.extra,h,m,C,O)),512&n.flags&&(n.check=r(n.check,h,C,m)),g-=C,m+=C,n.length-=C),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===g)break e;C=0;do{O=h[m+C++],n.head&&O&&n.length<65536&&(n.head.name+=String.fromCharCode(O))}while(O&&C<g);if(512&n.flags&&(n.check=r(n.check,h,C,m)),g-=C,m+=C,O)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===g)break e;C=0;do{O=h[m+C++],n.head&&O&&n.length<65536&&(n.head.comment+=String.fromCharCode(O))}while(O&&C<g);if(512&n.flags&&(n.check=r(n.check,h,C,m)),g-=C,m+=C,O)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;w<16;){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}if(v!==(65535&n.check)){e.msg="header crc mismatch",n.mode=d;break}v=0,w=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=c;break;case 10:for(;w<32;){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}e.adler=n.check=u(v),v=0,w=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=p,e.avail_out=b,e.next_in=m,e.avail_in=g,n.hold=v,n.bits=w,2;e.adler=n.check=1,n.mode=c;case c:if(5===t||6===t)break e;case 13:if(n.last){v>>>=7&w,w-=7&w,n.mode=27;break}for(;w<3;){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}switch(n.last=1&v,w-=1,3&(v>>>=1)){case 0:n.mode=14;break;case 1:if(y(n),n.mode=20,6===t){v>>>=2,w-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=d}v>>>=2,w-=2;break;case 14:for(v>>>=7&w,w-=7&w;w<32;){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}if((65535&v)!=(v>>>16^65535)){e.msg="invalid stored block lengths",n.mode=d;break}if(n.length=65535&v,v=0,w=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(C=n.length){if(C>g&&(C=g),C>b&&(C=b),0===C)break e;i.arraySet(f,h,m,C,p),g-=C,m+=C,b-=C,p+=C,n.length-=C;break}n.mode=c;break;case 17:for(;w<14;){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}if(n.nlen=257+(31&v),v>>>=5,w-=5,n.ndist=1+(31&v),v>>>=5,w-=5,n.ncode=4+(15&v),v>>>=4,w-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=d;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;w<3;){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}n.lens[j[n.have++]]=7&v,v>>>=3,w-=3}for(;n.have<19;)n.lens[j[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,D={bits:n.lenbits},U=a(0,n.lens,0,19,n.lencode,0,n.work,D),n.lenbits=D.bits,U){e.msg="invalid code lengths set",n.mode=d;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;T=(M=n.lencode[v&(1<<n.lenbits)-1])>>>16&255,E=65535&M,!((A=M>>>24)<=w);){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}if(E<16)v>>>=A,w-=A,n.lens[n.have++]=E;else{if(16===E){for(B=A+2;w<B;){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}if(v>>>=A,w-=A,0===n.have){e.msg="invalid bit length repeat",n.mode=d;break}O=n.lens[n.have-1],C=3+(3&v),v>>>=2,w-=2}else if(17===E){for(B=A+3;w<B;){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}w-=A,O=0,C=3+(7&(v>>>=A)),v>>>=3,w-=3}else{for(B=A+7;w<B;){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}w-=A,O=0,C=11+(127&(v>>>=A)),v>>>=7,w-=7}if(n.have+C>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=d;break}for(;C--;)n.lens[n.have++]=O}}if(n.mode===d)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=d;break}if(n.lenbits=9,D={bits:n.lenbits},U=a(1,n.lens,0,n.nlen,n.lencode,0,n.work,D),n.lenbits=D.bits,U){e.msg="invalid literal/lengths set",n.mode=d;break}if(n.distbits=6,n.distcode=n.distdyn,D={bits:n.distbits},U=a(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,D),n.distbits=D.bits,U){e.msg="invalid distances set",n.mode=d;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(g>=6&&b>=258){e.next_out=p,e.avail_out=b,e.next_in=m,e.avail_in=g,n.hold=v,n.bits=w,o(e,I),p=e.next_out,f=e.output,b=e.avail_out,m=e.next_in,h=e.input,g=e.avail_in,v=n.hold,w=n.bits,n.mode===c&&(n.back=-1);break}for(n.back=0;T=(M=n.lencode[v&(1<<n.lenbits)-1])>>>16&255,E=65535&M,!((A=M>>>24)<=w);){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}if(T&&0==(240&T)){for(z=A,R=T,P=E;T=(M=n.lencode[P+((v&(1<<z+R)-1)>>z)])>>>16&255,E=65535&M,!(z+(A=M>>>24)<=w);){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}v>>>=z,w-=z,n.back+=z}if(v>>>=A,w-=A,n.back+=A,n.length=E,0===T){n.mode=26;break}if(32&T){n.back=-1,n.mode=c;break}if(64&T){e.msg="invalid literal/length code",n.mode=d;break}n.extra=15&T,n.mode=22;case 22:if(n.extra){for(B=n.extra;w<B;){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}n.length+=v&(1<<n.extra)-1,v>>>=n.extra,w-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;T=(M=n.distcode[v&(1<<n.distbits)-1])>>>16&255,E=65535&M,!((A=M>>>24)<=w);){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}if(0==(240&T)){for(z=A,R=T,P=E;T=(M=n.distcode[P+((v&(1<<z+R)-1)>>z)])>>>16&255,E=65535&M,!(z+(A=M>>>24)<=w);){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}v>>>=z,w-=z,n.back+=z}if(v>>>=A,w-=A,n.back+=A,64&T){e.msg="invalid distance code",n.mode=d;break}n.offset=E,n.extra=15&T,n.mode=24;case 24:if(n.extra){for(B=n.extra;w<B;){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}n.offset+=v&(1<<n.extra)-1,v>>>=n.extra,w-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=d;break}n.mode=25;case 25:if(0===b)break e;if(C=I-b,n.offset>C){if((C=n.offset-C)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=d;break}C>n.wnext?(C-=n.wnext,x=n.wsize-C):x=n.wnext-C,C>n.length&&(C=n.length),S=n.window}else S=f,x=p-n.offset,C=n.length;C>b&&(C=b),b-=C,n.length-=C;do{f[p++]=S[x++]}while(--C);0===n.length&&(n.mode=21);break;case 26:if(0===b)break e;f[p++]=n.length,b--,n.mode=21;break;case 27:if(n.wrap){for(;w<32;){if(0===g)break e;g--,v|=h[m++]<<w,w+=8}if(I-=b,e.total_out+=I,n.total+=I,I&&(e.adler=n.check=n.flags?r(n.check,f,I,p-I):s(n.check,f,I,p-I)),I=b,(n.flags?v:u(v))!==n.check){e.msg="incorrect data check",n.mode=d;break}v=0,w=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;w<32;){if(0===g)break e;g--,v+=h[m++]<<w,w+=8}if(v!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=d;break}v=0,w=0}n.mode=29;case 29:U=1;break e;case d:U=-3;break e;case 31:return-4;case 32:default:return l}return e.next_out=p,e.avail_out=b,e.next_in=m,e.avail_in=g,n.hold=v,n.bits=w,(n.wsize||I!==e.avail_out&&n.mode<d&&(n.mode<27||4!==t))&&_(e,e.output,e.next_out,I-e.avail_out)?(n.mode=31,-4):(k-=e.avail_in,I-=e.avail_out,e.total_in+=k,e.total_out+=I,n.total+=I,n.wrap&&I&&(e.adler=n.check=n.flags?r(n.check,f,I,e.next_out-I):s(n.check,f,I,e.next_out-I)),e.data_type=n.bits+(n.last?64:0)+(n.mode===c?128:0)+(20===n.mode||15===n.mode?256:0),(0===k&&0===I||4===t)&&0===U&&(U=-5),U)},n.inflateEnd=function(e){if(!e||!e.state)return l;var t=e.state;return t.window&&(t.window=null),e.state=null,0},n.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?l:(n.head=t,t.done=!1,0):l},n.inflateSetDictionary=function(e,t){var n,i=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?l:11===n.mode&&s(1,t,i,0)!==n.check?-3:_(e,t,i,i)?(n.mode=31,-4):(n.havedict=1,0):l},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,n){"use strict";var i=e("../utils/common"),s=15,r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,n,c,d,u,h,f){var m,p,g,b,v,w,y,_,k,I=f.bits,C=0,x=0,S=0,A=0,T=0,E=0,z=0,R=0,P=0,O=0,U=null,D=0,B=new i.Buf16(16),M=new i.Buf16(16),F=null,j=0;for(C=0;C<=s;C++)B[C]=0;for(x=0;x<c;x++)B[t[n+x]]++;for(T=I,A=s;A>=1&&0===B[A];A--);if(T>A&&(T=A),0===A)return d[u++]=20971520,d[u++]=20971520,f.bits=1,0;for(S=1;S<A&&0===B[S];S++);for(T<S&&(T=S),R=1,C=1;C<=s;C++)if(R<<=1,(R-=B[C])<0)return-1;if(R>0&&(0===e||1!==A))return-1;for(M[1]=0,C=1;C<s;C++)M[C+1]=M[C]+B[C];for(x=0;x<c;x++)0!==t[n+x]&&(h[M[t[n+x]]++]=x);if(0===e?(U=F=h,w=19):1===e?(U=r,D-=257,F=o,j-=257,w=256):(U=a,F=l,w=-1),O=0,x=0,C=S,v=u,E=T,z=0,g=-1,b=(P=1<<T)-1,1===e&&P>852||2===e&&P>592)return 1;for(;;){y=C-z,h[x]<w?(_=0,k=h[x]):h[x]>w?(_=F[j+h[x]],k=U[D+h[x]]):(_=96,k=0),m=1<<C-z,S=p=1<<E;do{d[v+(O>>z)+(p-=m)]=y<<24|_<<16|k|0}while(0!==p);for(m=1<<C-1;O&m;)m>>=1;if(0!==m?(O&=m-1,O+=m):O=0,x++,0==--B[C]){if(C===A)break;C=t[n+h[x]]}if(C>T&&(O&b)!==g){for(0===z&&(z=T),v+=S,R=1<<(E=C-z);E+z<A&&!((R-=B[E+z])<=0);)E++,R<<=1;if(P+=1<<E,1===e&&P>852||2===e&&P>592)return 1;d[g=O&b]=T<<24|E<<16|v-u|0}}return 0!==O&&(d[v+O]=C-z<<24|64<<16|0),f.bits=T,0}},{"../utils/common":41}],51:[function(e,t,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,t,n){"use strict";var i=e("../utils/common");function s(e){for(var t=e.length;--t>=0;)e[t]=0}var r=256,o=286,a=30,l=15,c=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],d=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],h=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],f=new Array(576);s(f);var m=new Array(60);s(m);var p=new Array(512);s(p);var g=new Array(256);s(g);var b=new Array(29);s(b);var v,w,y,_=new Array(a);function k(e,t,n,i,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=s,this.has_stree=e&&e.length}function I(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function C(e){return e<256?p[e]:p[256+(e>>>7)]}function x(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function S(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,x(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function A(e,t,n){S(e,n[2*t],n[2*t+1])}function T(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function E(e,t,n){var i,s,r=new Array(16),o=0;for(i=1;i<=l;i++)r[i]=o=o+n[i-1]<<1;for(s=0;s<=t;s++){var a=e[2*s+1];0!==a&&(e[2*s]=T(r[a]++,a))}}function z(e){var t;for(t=0;t<o;t++)e.dyn_ltree[2*t]=0;for(t=0;t<a;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function R(e){e.bi_valid>8?x(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function P(e,t,n,i){var s=2*t,r=2*n;return e[s]<e[r]||e[s]===e[r]&&i[t]<=i[n]}function O(e,t,n){for(var i=e.heap[n],s=n<<1;s<=e.heap_len&&(s<e.heap_len&&P(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!P(t,i,e.heap[s],e.depth));)e.heap[n]=e.heap[s],n=s,s<<=1;e.heap[n]=i}function U(e,t,n){var i,s,o,a,l=0;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],s=e.pending_buf[e.l_buf+l],l++,0===i?A(e,s,t):(A(e,(o=g[s])+r+1,t),0!==(a=c[o])&&S(e,s-=b[o],a),A(e,o=C(--i),n),0!==(a=d[o])&&S(e,i-=_[o],a))}while(l<e.last_lit);A(e,256,t)}function D(e,t){var n,i,s,r=t.dyn_tree,o=t.stat_desc.static_tree,a=t.stat_desc.has_stree,c=t.stat_desc.elems,d=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<c;n++)0!==r[2*n]?(e.heap[++e.heap_len]=d=n,e.depth[n]=0):r[2*n+1]=0;for(;e.heap_len<2;)r[2*(s=e.heap[++e.heap_len]=d<2?++d:0)]=1,e.depth[s]=0,e.opt_len--,a&&(e.static_len-=o[2*s+1]);for(t.max_code=d,n=e.heap_len>>1;n>=1;n--)O(e,r,n);s=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],O(e,r,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,r[2*s]=r[2*n]+r[2*i],e.depth[s]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,r[2*n+1]=r[2*i+1]=s,e.heap[1]=s++,O(e,r,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,i,s,r,o,a,c=t.dyn_tree,d=t.max_code,u=t.stat_desc.static_tree,h=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,m=t.stat_desc.extra_base,p=t.stat_desc.max_length,g=0;for(r=0;r<=l;r++)e.bl_count[r]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(r=c[2*c[2*(i=e.heap[n])+1]+1]+1)>p&&(r=p,g++),c[2*i+1]=r,i>d||(e.bl_count[r]++,o=0,i>=m&&(o=f[i-m]),a=c[2*i],e.opt_len+=a*(r+o),h&&(e.static_len+=a*(u[2*i+1]+o)));if(0!==g){do{for(r=p-1;0===e.bl_count[r];)r--;e.bl_count[r]--,e.bl_count[r+1]+=2,e.bl_count[p]--,g-=2}while(g>0);for(r=p;0!==r;r--)for(i=e.bl_count[r];0!==i;)(s=e.heap[--n])>d||(c[2*s+1]!==r&&(e.opt_len+=(r-c[2*s+1])*c[2*s],c[2*s+1]=r),i--)}}(e,t),E(r,d,e.bl_count)}function B(e,t,n){var i,s,r=-1,o=t[1],a=0,l=7,c=4;for(0===o&&(l=138,c=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)s=o,o=t[2*(i+1)+1],++a<l&&s===o||(a<c?e.bl_tree[2*s]+=a:0!==s?(s!==r&&e.bl_tree[2*s]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,r=s,0===o?(l=138,c=3):s===o?(l=6,c=3):(l=7,c=4))}function M(e,t,n){var i,s,r=-1,o=t[1],a=0,l=7,c=4;for(0===o&&(l=138,c=3),i=0;i<=n;i++)if(s=o,o=t[2*(i+1)+1],!(++a<l&&s===o)){if(a<c)do{A(e,s,e.bl_tree)}while(0!=--a);else 0!==s?(s!==r&&(A(e,s,e.bl_tree),a--),A(e,16,e.bl_tree),S(e,a-3,2)):a<=10?(A(e,17,e.bl_tree),S(e,a-3,3)):(A(e,18,e.bl_tree),S(e,a-11,7));a=0,r=s,0===o?(l=138,c=3):s===o?(l=6,c=3):(l=7,c=4)}}s(_);var F=!1;function j(e,t,n,s){S(e,0+(s?1:0),3),function(e,t,n,s){R(e),s&&(x(e,n),x(e,~n)),i.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}n._tr_init=function(e){F||(!function(){var e,t,n,i,s,r=new Array(16);for(n=0,i=0;i<28;i++)for(b[i]=n,e=0;e<1<<c[i];e++)g[n++]=i;for(g[n-1]=i,s=0,i=0;i<16;i++)for(_[i]=s,e=0;e<1<<d[i];e++)p[s++]=i;for(s>>=7;i<a;i++)for(_[i]=s<<7,e=0;e<1<<d[i]-7;e++)p[256+s++]=i;for(t=0;t<=l;t++)r[t]=0;for(e=0;e<=143;)f[2*e+1]=8,e++,r[8]++;for(;e<=255;)f[2*e+1]=9,e++,r[9]++;for(;e<=279;)f[2*e+1]=7,e++,r[7]++;for(;e<=287;)f[2*e+1]=8,e++,r[8]++;for(E(f,287,r),e=0;e<a;e++)m[2*e+1]=5,m[2*e]=T(e,5);v=new k(f,c,257,o,l),w=new k(m,d,0,a,l),y=new k(new Array(0),u,0,19,7)}(),F=!0),e.l_desc=new I(e.dyn_ltree,v),e.d_desc=new I(e.dyn_dtree,w),e.bl_desc=new I(e.bl_tree,y),e.bi_buf=0,e.bi_valid=0,z(e)},n._tr_stored_block=j,n._tr_flush_block=function(e,t,n,i){var s,o,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<r;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),D(e,e.l_desc),D(e,e.d_desc),a=function(e){var t;for(B(e,e.dyn_ltree,e.l_desc.max_code),B(e,e.dyn_dtree,e.d_desc.max_code),D(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*h[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),s=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=s&&(s=o)):s=o=n+5,n+4<=s&&-1!==t?j(e,t,n,i):4===e.strategy||o===s?(S(e,2+(i?1:0),3),U(e,f,m)):(S(e,4+(i?1:0),3),function(e,t,n,i){var s;for(S(e,t-257,5),S(e,n-1,5),S(e,i-4,4),s=0;s<i;s++)S(e,e.bl_tree[2*h[s]+1],3);M(e,e.dyn_ltree,t-1),M(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),U(e,e.dyn_ltree,e.dyn_dtree)),z(e),i&&R(e)},n._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(g[n]+r+1)]++,e.dyn_dtree[2*C(t)]++),e.last_lit===e.lit_bufsize-1},n._tr_align=function(e){S(e,2,3),A(e,256,f),function(e){16===e.bi_valid?(x(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":41}],53:[function(e,t,n){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,n){"use strict";t.exports="function"==typeof setImmediate?setImmediate:function(){var e=[].slice.apply(arguments);e.splice(1,0,0),setTimeout.apply(null,e)}},{}]},{},[10])(10)})),function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):"undefined"!=typeof window?window.JSZipUtils=e():"undefined"!=typeof global?global.JSZipUtils=e():"undefined"!=typeof self&&(self.JSZipUtils=e())}((function(){return function e(t,n,i){function s(o,a){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(r)return r(o,!0);throw new Error("Cannot find module '"+o+"'")}var c=n[o]={exports:{}};t[o][0].call(c.exports,(function(e){var n=t[o][1][e];return s(n||e)}),c,c.exports,e,t,n,i)}return n[o].exports}for(var r="function"==typeof require&&require,o=0;o<i.length;o++)s(i[o]);return s}({1:[function(e,t,n){"use strict";var i={};function s(){try{return new window.XMLHttpRequest}catch(e){}}i._getBinaryFromXHR=function(e){return e.response||e.responseText};var r="undefined"!=typeof window&&window.ActiveXObject?function(){return s()||function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}()}:s;i.getBinaryContent=function(e,t){var n,s,o,a;t||(t={}),"function"==typeof t?(a=t,t={}):"function"==typeof t.callback&&(a=t.callback),a||"undefined"==typeof Promise?(s=function(e){a(null,e)},o=function(e){a(e,null)}):n=new Promise((function(e,t){s=e,o=t}));try{var l=r();l.open("GET",e,!0),"responseType"in l&&(l.responseType="arraybuffer"),l.overrideMimeType&&l.overrideMimeType("text/plain; charset=x-user-defined"),l.onreadystatechange=function(t){if(4===l.readyState)if(200===l.status||0===l.status)try{s(i._getBinaryFromXHR(l))}catch(e){o(new Error(e))}else o(new Error("Ajax error for "+e+" : "+this.status+" "+this.statusText))},t.progress&&(l.onprogress=function(n){t.progress({path:e,originalEvent:n,percent:n.loaded/n.total*100,loaded:n.loaded,total:n.total})}),l.send()}catch(e){o(new Error(e),null)}return n},t.exports=i},{}]},{},[1])(1)}));
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
var saveAs=saveAs||function(e){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,n=function(){return e.URL||e.webkitURL||e},i=t.createElementNS("http://www.w3.org/1999/xhtml","a"),s="download"in i,r=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),o=e.webkitRequestFileSystem,a=e.requestFileSystem||o||e.mozRequestFileSystem,l=function(t){(e.setImmediate||e.setTimeout)((function(){throw t}),0)},c="application/octet-stream",d=0,u=function(e){setTimeout((function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()}),4e4)},h=function(e,t,n){for(var i=(t=[].concat(t)).length;i--;){var s=e["on"+t[i]];if("function"==typeof s)try{s.call(e,n||e)}catch(e){l(e)}}},f=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["ï»¿",e],{type:e.type}):e},m=function(t,l,m){m||(t=f(t));var p,g,b,v=this,w=t.type,y=!1,_=function(){h(v,"writestart progress write writeend".split(" "))},k=function(){if(g&&r&&"undefined"!=typeof FileReader){var i=new FileReader;return i.onloadend=function(){var e=i.result;g.location.href="data:attachment/file"+e.slice(e.search(/[,;]/)),v.readyState=v.DONE,_()},i.readAsDataURL(t),void(v.readyState=v.INIT)}(!y&&p||(p=n().createObjectURL(t)),g)?g.location.href=p:void 0===e.open(p,"_blank")&&r&&(e.location.href=p);v.readyState=v.DONE,_(),u(p)},I=function(e){return function(){if(v.readyState!==v.DONE)return e.apply(this,arguments)}},C={create:!0,exclusive:!1};if(v.readyState=v.INIT,l||(l="download"),s)return p=n().createObjectURL(t),void setTimeout((function(){var e,t;i.href=p,i.download=l,e=i,t=new MouseEvent("click"),e.dispatchEvent(t),_(),u(p),v.readyState=v.DONE}));e.chrome&&w&&w!==c&&(b=t.slice||t.webkitSlice,t=b.call(t,0,t.size,c),y=!0),o&&"download"!==l&&(l+=".download"),(w===c||o)&&(g=e),a?(d+=t.size,a(e.TEMPORARY,d,I((function(e){e.root.getDirectory("saved",C,I((function(e){var n=function(){e.getFile(l,C,I((function(e){e.createWriter(I((function(n){n.onwriteend=function(t){g.location.href=e.toURL(),v.readyState=v.DONE,h(v,"writeend",t),u(e)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&k()},"writestart progress write abort".split(" ").forEach((function(e){n["on"+e]=v["on"+e]})),n.write(t),v.abort=function(){n.abort(),v.readyState=v.DONE},v.readyState=v.WRITING})),k)})),k)};e.getFile(l,{create:!1},I((function(e){e.remove(),n()})),I((function(e){e.code===e.NOT_FOUND_ERR?n():k()})))})),k)})),k)):k()},p=m.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return n||(e=f(e)),navigator.msSaveOrOpenBlob(e,t||"download")}:(p.abort=function(){var e=this;e.readyState=e.DONE,h(e,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,function(e,t,n){return new m(e,t,n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define([],(function(){return saveAs})),function(){var e=Ibles.pageContext.ibleData;e&&window.LogHit&&window.LogHit(e.id,"Step by Step"===e.type?"E":"O",e.author.id)}(),Ibles.package("Ibles.views"),Ibles.views.BaseInstructableView=Backbone.View.extend({events:{"click .favorite-btn":"attemptFave","click .follow-btn":"attemptFollow","click .download-pdf, .pdf-btn":"downloadPDF","click .facebook-share-button, .fb-btn":"shareOnFacebook","click .pinterest-share-button, .pin-btn":"shareOnPinterest","click .twittr-share-button, .twit-btn":"shareOnTwitter","click .google-classroom-btn":"shareOnGoogleClassroom"},initialize:function(e){this.opts=_.clone(e||{}),this.renderPostedDate(),this.setUpCategoryTracking(),this.updateFollowingState(),this.updateFavoriteState(),this.listenTo(this.model,"change:favorite",this.updateFavoriteState),this.listenTo(this.model.author,"change:following",this.updateFollowingState),this.listenTo(this.model,"change:favorites change:views",this.updateStats)},renderPostedDate:function(){if(Ibles.session.authenticated()){var e=dayjs(this.model.get("publishDate")),t="Unpublished";this.model.get("isPreview")||(t="Published "+e.format("MMM Do, YYYY")),this.$(".posted-date").text(" "+t).show()}},downloadPDF:function(){var e=this;Ibles.requireLogin((function(){Ibles.featureFlagEnabled("zippable_project")?e.downloadZipBundle():e.downloadPdfOnly()}))},downloadPdfOnly:function(){Ibles.locationAssign(this.model.getPdfUrl())},downloadZipBundle:function(){var e=this.$(".download-pdf, .pdf-btn").button("loading");this.model.downloadZipBundle().always((function(){e.button("reset")})).fail((function(){alert(Ibles.text.errors.somethingImportantWentWrong)}))},attemptFave:function(e){var t=this;e.preventDefault(),Ibles.requireLogin((function(){Ibles.alertWhenError(t.model.favoriteAction())}),{sourcea:"favorite"})},attemptFollow:function(e){var t=this;e.preventDefault(),Ibles.requireLogin((function(){Ibles.alertWhenError(t.model.author.toggleFollowing())}),{sourcea:"follow"})},updateFavoriteState:function(){var e=$(".favorite-btn"),t=$(".favorite-txt");this.model.get("favorite")?(e.addClass("active"),t.text("Favorited")):(e.removeClass("active"),t.text("Favorite"))},updateFollowingState:function(){var e=this.model.author.get("following");$(".follow-btn").html(e?"Following":"Follow")},updateStats:function(){var e=this.model,t=e.get("favorites"),n=e.get("views");t>0&&this.$(".favorite-count").html(t.toLocaleString()),n>0&&this.$(".view-count").html(n.toLocaleString())},shareOnFacebook:function(e){e.preventDefault(),Ibles.fbShare(this.model.get("fullUrl"))},shareOnPinterest:function(e){e.preventDefault(),window.open(`https://www.pinterest.com/pin/create/button/?url=${encodeURIComponent(this.model.get("fullUrl"))}&description=${encodeURIComponent(this.model.get("title"))}&media=${this.model.get("shareImageUrl")}`,"_blank")},shareOnTwitter:function(e){e.preventDefault(),window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(this.model.get("title"))}&url=${encodeURIComponent(this.model.get("fullUrl"))}`,"_blank")},shareOnGoogleClassroom:function(e){e.preventDefault();var t=encodeURIComponent(this.model.get("fullUrl"));window.open(`https://classroom.google.com/share?url=${t}`,"_blank")},setupSyntaxHighlighting:function(){var e=[];$("pre").each((function(t,n){if($(n).attr("data-src")&&""!=$(n).attr("data-src")){var i=$.ajax({url:$(n).attr("data-src"),type:"GET",success:function(e){$(n).append($("<code></code>").text(e))}});e.push(i)}})),e.length>0&&($("head").append('<link rel="stylesheet" href="'+Ibles.staticUrl("css/prism.css")+'" type="text/css" />'),$.when.apply($,e).always((function(){sessionReady([Ibles.staticUrl("js/libs/prism.js")],(function(){Prism.highlightAll(!0)}))})))},setUpCategoryTracking:function(){var e={},t={},n=this.model.get("category"),i=this.model.get("channel");if(_.isUndefined(Ibles.getCookie("categoryTimer"))){var s=dayjs().add(30,"m"),r=Ibles.reverseUrls.ibleUrl(this.model.get("urlString"));Ibles.setCookie("categoryTimer",this.model.get("id"),{path:r,expires:s.toDate()});try{_.isUndefined(localStorage.ibleCategories)||(e=JSON.parse(localStorage.ibleCategories)),_.isUndefined(e[n])?e[n]=1:e[n]=e[n]+1,localStorage.ibleCategories=JSON.stringify(e),_.isUndefined(i)||(_.isUndefined(localStorage.ibleChannels)||(t=JSON.parse(localStorage.ibleChannels)),_.isUndefined(t[i])?t[i]=1:t[i]=t[i]+1,localStorage.ibleChannels=JSON.stringify(t))}catch(e){try{localStorage.clear()}catch(e){}}}},setupAdminPanel:function(){if(!Ibles.isMobile()&&this.model.isEditableByCurrentUser()){var e=this,t=$("#admin-container");t.length&&Ibles.loadJsBundle("ible_admin_js",(function(){e.adminPanel=new Ibles.views.Admin({el:t,model:e.model,collapsible:!0})}))}}}),Ibles.package("Ibles.views"),Ibles.views.InstructableView=Ibles.views.BaseInstructableView.fullExtend({events:{"click .license-btn":"showLicense","click .finalized-contests, .contest-entry, .view-btn":"viewContest","click .step-tip":"showTipPoster","click .step-question":"showQuestionPoster","click .step-comment":"showCommentPoster","click .view-comments-btn, .comment-count":"scrollToComments","click .imadeit-btn":"scrollToIMadeIts"},initialize:function(e){this._super(e),this.setupStickyHeader(),this.setupImadeIts(),this.setupComments(),this.listenTo(this.model,"userDataSynced",this.afterUserDataSynced)},afterUserDataSynced:function(){},setupStickyHeader:function(){this.stickyHeader=new Ibles.views.StickyHeader({el:this.$el,model:this.model})},setupImadeIts:function(){this.IMadeItsManager=new Ibles.views.ImadeItsManager({el:"#imadeits",model:this.model})},setupComments:function(){var e=this,t=e.model;t.get("disableComments")||sessionReady((function(){e.commentsManager=new Ibles.views.CommentsManager({el:"#comments",model:t,fetchRatings:!0,additionalCommentContext:function(t){var n=t.get("stepId");return n?e.getStepProps(n):{}}}),e.commentTypeSelector=new Ibles.views.CommentTypeSelector({el:"#discuss",manager:e.commentsManager}).render()}))},showLicense:function(){var e=this.$(".license-btn").data("url");window.open(e,"LICENSE","status=yes,scrollbars=yes,resizable=yes,width=800,height=400")},viewContest:function(e){var t=$(e.target).closest(".contest-entry").find("a").attr("href");window.location=t},getTitleForPhotoset:function(e){var t=$(e).prev(".step-title").text();return t.substring(t.indexOf(":")+1).trim()},getStepId:function(e){return $(e.target).closest(".step").data("stepid")},getStepProps:function(e){var t,n=$('.step[data-stepid="'+e+'"]'),i={};return n.length&&(t=n.find(".step-title").text(),_.extend(i,{stepId:e,stepAnchorId:n.attr("id"),stepIndexLabel:t.substring(0,t.indexOf(":")).trim()})),i},showTipPoster:function(e){this.showStepCommentPoster(e,"tip")},showQuestionPoster:function(e){this.showStepCommentPoster(e,"question")},showCommentPoster:function(e){this.showStepCommentPoster(e,"comment")},showStepCommentPoster:function(e,t){var n=this,i=n.commentTypeSelector;i.renderPoster({designation:t,modelProps:{stepId:$(e.target).closest(".step").data("stepid"),designations:[t]},callback:function(){i.scrollToMe(),n.stickyHeader.hide()}})},scrollToComments:function(){window.location.hash="#discuss"},scrollToIMadeIts:function(e){this.IMadeItsManager.renderPoster(e),window.location.hash="#imadeits"}}),Ibles.package("Ibles.views"),Ibles.views.MobileInstructableView=Ibles.views.InstructableView.fullExtend({events:{"click .show-more-link":"showAuthorContent"},initialize:function(e){this._super(e),this.setupPhotoset()},afterUserDataSynced:function(){this._super()},setupPhotoset:function(){var e=this;this.model.getPhotosetFiles().done((function(t){_.each(e.$(".mediaset"),(function(n,i){new Ibles.views.ScrollablePhotosetView({el:n,fileCollection:t[i],title:e.getTitleForPhotoset(n)})}));var n=Ibles.pageContext.ibleData.suppliesFiles;if(n&&n.length){var i=e.$(".mediaset-supplies");new Ibles.views.ScrollablePhotosetView({el:i,fileCollection:new Ibles.collections.FileCollection(n),title:"Supplies"})}}))},showAuthorContent:function(){$(".promoted-content").removeClass("hide"),$(".about").removeClass("hide"),$(".show-more-link").addClass("hide")}});